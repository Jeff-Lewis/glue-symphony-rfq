(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
module.exports=function(e){"use strict";function t(){var e=p();return{appConfigFacadeConfig:s?s.appConfigFacade.config:{identity:{}},application:r(e),metrics:n(e),agm:{presenceInterval:3e3},gateway:i()}}function n(e){var t="undefined"!=typeof document?document.title:"nknown";return t=t||"none",{system:s?"HtmlContainer."+s.containerName:"Browser",service:s?"JS."+s.browserWindowName:t,instance:s?"~"+s.machineName:"~"+e}}function i(){var e="localhost:22037",t=o();return{ws:t?"wss://"+e:"ws://"+e,http:t?"https:"+e:"http://"+e,protocolVersion:1}}function o(){return"undefined"==typeof window||!window.location||"http:"!==window.location.protocol}function r(e){return s?s.containerName+"."+s.browserWindowName:"undefined"!=typeof window&&"undefined"!=typeof document?(window.agm_application||document.title)+e:"NodeJS"+e}function a(e){var t={};return Object.keys(e.identity).forEach(function(n){t[n]=c(e.identity[n])}),w({},e,{identity:t})}function c(e,t){var n=t||/\{([^{}]*)\}/g;return e.replace(n,function(e,t){var n=this;return t.split(".").forEach(function(e){n&&(n=n[e])}),"string"==typeof n||"number"==typeof n?n:e})}var s,p=require("cuid"),w=require("object-assign");"undefined"!=typeof window&&(s=window.htmlContainer);var d=t(),u=w({},d,e);u.gateway.ws=u.gateway.ws||d.gateway.ws,u.gateway.http=u.gateway.ws||d.gateway.http;var f={};return f=void 0!==s?void 0:require("detect-node")||"WebSocket"in window&&2===window.WebSocket.CLOSING?{ws:u.gateway.ws,protocolVersion:u.gateway.protocolVersion}:{http:u.gateway.http,protocolVersion:u.gateway.protocolVersion},f&&(f.application=u.application,f.gwTokenProvider=u.gwTokenProvider),{connection:f,appConfig:a(d.appConfigFacadeConfig),logger:{identity:{system:u.metrics.system,service:u.metrics.service,instance:u.metrics.instance}},metrics:{identity:{system:u.metrics.system,service:u.metrics.service,instance:u.metrics.instance}},agm:{instance:{application:u.application},server:{hearbeat_interval:d.agm.heartbeatInterval,presence_interval:u.agm.presenceInterval}}}};
},{"cuid":6,"detect-node":7,"object-assign":9}],2:[function(require,module,exports){
module.exports=function(e){"use strict";var n=require("tick42-metrics"),i=require("tick42-agm"),t=require("tick42-gateway-connection"),o=require("tick42-logger"),r=require("tick42-appconfig"),c=require("tick42-windows"),a=require("tick42-app-manager"),s=require("tick42-activity"),g=require("tick42-contexts"),u=require("es6-promise").Promise,f=require("../package.json"),m=require("./config.js"),p="undefined"!=typeof window&&window.htmlContainer;return new u(function(v,l){function h(e){return new u(function(t,u){var m,v,l,h,w,k,y,q,L,S,j;k=o(e.logger),e.metrics.logger=k.subLogger("metrics"),y=n(e.metrics),q=y.subSystem("App"),k.metricsLevel("warn",q.parent.subSystem("LogEvents")),e.agm.metrics=y.subSystem("AGM"),e.agm.logger=k.subLogger("agm"),e.agm.logger.consoleLevel("debug"),i(e.agm).then(function(e){if(m=e,v=c(m),l=a(m,v),p&&(p.appConfigFacade&&p.appConfigFacade.config&&(h=r().init(d.appConfig)),p.activityFacade)){var n=k.subLogger("activity");n.publishLevel("debug"),n.consoleLevel("info"),n.metricsLevel("off"),w=s({agm:m,logger:n})}j=g(),L={glueVersion:f.version,activities:w?w.version:"unknown",metrics:q.repo.version,agm:m.version,windows:v.version,logger:k.version,appManager:l.version,connection:b.version,contexts:j.version},S=function(){m&&m.invoke("T42.ACS.Feedback",{},"best")},t({activities:w,agm:m,appConfig:h,appManager:l,connection:b,contexts:j,feedback:S,info:L,logger:k,metrics:q,version:f.version,windows:v})}).catch(function(e){u(e)})})}!e.auth&&e.gateway.protocolVersion>1&&l("You need to provide auth information");var d=m(e),b=t(d.connection);if(d.agm.connection=b,d.logger.connection=b,d.metrics.connection=b,e.auth){var w;if("string"==typeof e.auth||e.auth instanceof String||"number"==typeof e.auth||e.auth instanceof Number)w={token:e.auth};else{if("[object Object]"!==Object.prototype.toString.call(e.auth))throw new Error("Invalid auth object - "+JSON.stringify(w));w=e.auth}b.login(w).then(function(e){e&&(d.agm.instance.machine=e.ipAddress,d.agm.instance.user=e.username),h(d).then(function(e){v(e)}).catch(function(e){l(e)})}).catch(function(e){l(e)})}else v(h(d))})};
},{"../package.json":108,"./config.js":1,"es6-promise":8,"tick42-activity":15,"tick42-agm":41,"tick42-app-manager":58,"tick42-appconfig":64,"tick42-contexts":72,"tick42-gateway-connection":75,"tick42-logger":84,"tick42-metrics":100,"tick42-windows":103}],3:[function(require,module,exports){
(function(){"use strict";function t(t,i){this.options=i||{},this.reset(t)}var i=Array.prototype.slice,e=Object.prototype.toString;t.VERSION="0.0.8",t.LEFT=0,t.CENTER=1,t.RIGHT=2,t.factory=function(i,e){return new t(i,e)},t.align=function(i,e,r,n){return i===t.LEFT?t.alignLeft(e,r,n):i===t.RIGHT?t.alignRight(e,r,n):i===t.CENTER?t.alignCenter(e,r,n):t.alignAuto(e,r,n)},t.alignLeft=function(t,i,e){if(!i||i<0)return"";void 0!==t&&null!==t||(t=""),"undefined"==typeof e&&(e=" "),"string"!=typeof t&&(t=t.toString());var r=i+1-t.length;return r<=0?t:t+Array(i+1-t.length).join(e)},t.alignCenter=function(i,e,r){if(!e||e<0)return"";void 0!==i&&null!==i||(i=""),"undefined"==typeof r&&(r=" "),"string"!=typeof i&&(i=i.toString());var n=i.length,o=Math.floor(e/2-n/2),s=Math.abs(n%2-e%2),e=i.length;return t.alignRight("",o,r)+i+t.alignLeft("",o+s,r)},t.alignRight=function(t,i,e){if(!i||i<0)return"";void 0!==t&&null!==t||(t=""),"undefined"==typeof e&&(e=" "),"string"!=typeof t&&(t=t.toString());var r=i+1-t.length;return r<=0?t:Array(i+1-t.length).join(e)+t},t.alignAuto=function(i,r,n){void 0!==i&&null!==i||(i="");var o=e.call(i);if(n||(n=" "),r=+r,"[object String]"!==o&&(i=i.toString()),i.length<r)switch(o){case"[object Number]":return t.alignRight(i,r,n);default:return t.alignLeft(i,r,n)}return i},t.arrayFill=function(t,i){for(var e=new Array(t),r=0;r!==t;r++)e[r]=i;return e},t.prototype.reset=t.prototype.clear=function(i){return this.__name="",this.__nameAlign=t.CENTER,this.__rows=[],this.__maxCells=0,this.__aligns=[],this.__colMaxes=[],this.__spacing=1,this.__heading=null,this.__headingAlign=t.CENTER,this.setBorder(),"[object String]"===e.call(i)?this.__name=i:"[object Object]"===e.call(i)&&this.fromJSON(i),this},t.prototype.setBorder=function(t,i,e,r){return this.__border=!0,1===arguments.length&&(i=e=r=t),this.__edge=t||"|",this.__fill=i||"-",this.__top=e||".",this.__bottom=r||"'",this},t.prototype.removeBorder=function(){return this.__border=!1,this.__edge=" ",this.__fill=" ",this},t.prototype.setAlign=function(t,i){return this.__aligns[t]=i,this},t.prototype.setTitle=function(t){return this.__name=t,this},t.prototype.getTitle=function(){return this.__name},t.prototype.setTitleAlign=function(t){return this.__nameAlign=t,this},t.prototype.sort=function(t){return this.__rows.sort(t),this},t.prototype.sortColumn=function(t,i){return this.__rows.sort(function(e,r){return i(e[t],r[t])}),this},t.prototype.setHeading=function(t){return(arguments.length>1||"[object Array]"!==e.call(t))&&(t=i.call(arguments)),this.__heading=t,this},t.prototype.getHeading=function(){return this.__heading.slice()},t.prototype.setHeadingAlign=function(t){return this.__headingAlign=t,this},t.prototype.addRow=function(t){return(arguments.length>1||"[object Array]"!==e.call(t))&&(t=i.call(arguments)),this.__maxCells=Math.max(this.__maxCells,t.length),this.__rows.push(t),this},t.prototype.getRows=function(){return this.__rows.slice().map(function(t){return t.slice()})},t.prototype.addRowMatrix=function(t){for(var i=0;i<t.length;i++)this.addRow(t[i]);return this},t.prototype.addData=function(t,i,r){if("[object Array]"!==e.call(t))return this;for(var n=0,o=t.length;n<o;n++){var s=i(t[n]);r?this.addRowMatrix(s):this.addRow(s)}return this},t.prototype.clearRows=function(){return this.__rows=[],this.__maxCells=0,this.__colMaxes=[],this},t.prototype.setJustify=function(t){return 0===arguments.length&&(t=!0),this.__justify=!!t,this},t.prototype.toJSON=function(){return{title:this.getTitle(),heading:this.getHeading(),rows:this.getRows()}},t.prototype.parse=t.prototype.fromJSON=function(t){return this.clear().setTitle(t.title).setHeading(t.heading).addRowMatrix(t.rows)},t.prototype.render=t.prototype.valueOf=t.prototype.toString=function(){for(var i,e=this,r=[],n=this.__maxCells,o=t.arrayFill(n,0),s=3*n,h=this.__rows,a=this.__border,l=this.__heading?[this.__heading].concat(h):h,_=0;_<l.length;_++)for(var u=l[_],p=0;p<n;p++){var g=u[p];o[p]=Math.max(o[p],g?g.toString().length:0)}this.__colMaxes=o,i=this.__justify?Math.max.apply(null,o):0,o.forEach(function(t){s+=i?i:t+e.__spacing}),i&&(s+=o.length),s-=this.__spacing,a&&r.push(this._seperator(s-n+1,this.__top)),this.__name&&(r.push(this._renderTitle(s-n+1)),a&&r.push(this._seperator(s-n+1))),this.__heading&&(r.push(this._renderRow(this.__heading," ",this.__headingAlign)),r.push(this._rowSeperator(n,this.__fill)));for(var _=0;_<this.__rows.length;_++)r.push(this._renderRow(this.__rows[_]," "));a&&r.push(this._seperator(s-n+1,this.__bottom));var f=this.options.prefix||"";return f+r.join("\n"+f)},t.prototype._seperator=function(i,e){return e||(e=this.__edge),e+t.alignRight(e,i,this.__fill)},t.prototype._rowSeperator=function(){var i=t.arrayFill(this.__maxCells,this.__fill);return this._renderRow(i,this.__fill)},t.prototype._renderTitle=function(i){var e=" "+this.__name+" ",r=t.align(this.__nameAlign,e,i-1," ");return this.__edge+r+this.__edge},t.prototype._renderRow=function(i,e,r){for(var n=[""],o=this.__colMaxes,s=0;s<this.__maxCells;s++){var h=i[s],a=this.__justify?Math.max.apply(null,o):o[s],l=a,_=this.__aligns[s],u=r,p="alignAuto";"undefined"==typeof r&&(u=_),u===t.LEFT&&(p="alignLeft"),u===t.CENTER&&(p="alignCenter"),u===t.RIGHT&&(p="alignRight"),n.push(t[p](h,l,e))}var g=n.join(e+this.__edge+e);return g=g.substr(1,g.length),g+e+this.__edge},["Left","Right","Center"].forEach(function(e){var r=t[e.toUpperCase()];["setAlign","setTitleAlign","setHeadingAlign"].forEach(function(n){t.prototype[n+e]=function(){var t=i.call(arguments).concat(r);return this[n].apply(this,t)}})}),"undefined"!=typeof exports?module.exports=t:this.AsciiTable=t}).call(this);
},{}],4:[function(require,module,exports){
module.exports=require("./ascii-table");
},{"./ascii-table":3}],5:[function(require,module,exports){
module.exports=function(){"use strict";function e(e,r){var t=n[e];t||(t=[],n[e]=t);var u=t.push(r),a=u-1;return a+"_"+e}function r(e){var r=e.split("_");if(2!==r.length)return!1;var t=r[0],u=r[1],a=n[u];return!(!a||0===a.length)&&(delete a[t],!0)}function t(e,r){var t=n[e];if(t&&0!==t.length){var u=[].splice.call(arguments,1);t.forEach(function(e){e.apply(void 0,u)})}}var n={};return{add:e,remove:r,execute:t}};
},{}],6:[function(require,module,exports){
!function(t){"use strict";var n="cuid",r=0,e=4,i=36,o=Math.pow(i,e),u=function(t,n){var r="000000000"+t;return r.substr(r.length-n)},g=function(){return u((Math.random()*o<<0).toString(i),e)},a=function(){return r=r<o?r:0,r++,r-1},c=function(){var t,n="c",r=(new Date).getTime().toString(i),o=c.fingerprint(),l=g()+g();return t=u(a().toString(i),e),n+r+t+o+l};c.slug=function(){var t,n=(new Date).getTime().toString(36),r=c.fingerprint().slice(0,1)+c.fingerprint().slice(-1),e=g().slice(-2);return t=a().toString(36).slice(-4),n.slice(-2)+t+r+e},c.globalCount=function(){var t=function(){var t,n=0;for(t in window)n++;return n}();return c.globalCount=function(){return t},t},c.fingerprint=function(){return u((navigator.mimeTypes.length+navigator.userAgent.length).toString(36)+c.globalCount().toString(36),4)},t.register?t.register(n,c):"undefined"!=typeof module?module.exports=c:t[n]=c}(this.applitude||this);
},{}],7:[function(require,module,exports){
(function (global){
module.exports=!1;try{module.exports="[object process]"===Object.prototype.toString.call(global.process)}catch(o){}
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],8:[function(require,module,exports){
(function (process,global){
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.ES6Promise=e()}(this,function(){"use strict";function t(t){return"function"==typeof t||"object"==typeof t&&null!==t}function e(t){return"function"==typeof t}function n(t){I=t}function r(t){J=t}function o(){return function(){return process.nextTick(a)}}function i(){return function(){H(a)}}function s(){var t=0,e=new V(a),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}function u(){var t=new MessageChannel;return t.port1.onmessage=a,function(){return t.port2.postMessage(0)}}function c(){var t=setTimeout;return function(){return t(a,1)}}function a(){for(var t=0;t<G;t+=2){var e=$[t],n=$[t+1];e(n),$[t]=void 0,$[t+1]=void 0}G=0}function f(){try{var t=require,e=t("vertx");return H=e.runOnLoop||e.runOnContext,i()}catch(t){return c()}}function l(t,e){var n=arguments,r=this,o=new this.constructor(p);void 0===o[et]&&k(o);var i=r._state;return i?!function(){var t=n[i-1];J(function(){return x(i,o,t,r._result)})}():E(r,o,t,e),o}function h(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var n=new e(p);return g(n,t),n}function p(){}function v(){return new TypeError("You cannot resolve a promise with itself")}function d(){return new TypeError("A promises callback cannot return that same promise.")}function _(t){try{return t.then}catch(t){return it.error=t,it}}function y(t,e,n,r){try{t.call(e,n,r)}catch(t){return t}}function m(t,e,n){J(function(t){var r=!1,o=y(n,e,function(n){r||(r=!0,e!==n?g(t,n):S(t,n))},function(e){r||(r=!0,j(t,e))},"Settle: "+(t._label||" unknown promise"));!r&&o&&(r=!0,j(t,o))},t)}function b(t,e){e._state===rt?S(t,e._result):e._state===ot?j(t,e._result):E(e,void 0,function(e){return g(t,e)},function(e){return j(t,e)})}function w(t,n,r){n.constructor===t.constructor&&r===l&&n.constructor.resolve===h?b(t,n):r===it?j(t,it.error):void 0===r?S(t,n):e(r)?m(t,n,r):S(t,n)}function g(e,n){e===n?j(e,v()):t(n)?w(e,n,_(n)):S(e,n)}function A(t){t._onerror&&t._onerror(t._result),T(t)}function S(t,e){t._state===nt&&(t._result=e,t._state=rt,0!==t._subscribers.length&&J(T,t))}function j(t,e){t._state===nt&&(t._state=ot,t._result=e,J(A,t))}function E(t,e,n,r){var o=t._subscribers,i=o.length;t._onerror=null,o[i]=e,o[i+rt]=n,o[i+ot]=r,0===i&&t._state&&J(T,t)}function T(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r=void 0,o=void 0,i=t._result,s=0;s<e.length;s+=3)r=e[s],o=e[s+n],r?x(n,r,o,i):o(i);t._subscribers.length=0}}function M(){this.error=null}function P(t,e){try{return t(e)}catch(t){return st.error=t,st}}function x(t,n,r,o){var i=e(r),s=void 0,u=void 0,c=void 0,a=void 0;if(i){if(s=P(r,o),s===st?(a=!0,u=s.error,s=null):c=!0,n===s)return void j(n,d())}else s=o,c=!0;n._state!==nt||(i&&c?g(n,s):a?j(n,u):t===rt?S(n,s):t===ot&&j(n,s))}function C(t,e){try{e(function(e){g(t,e)},function(e){j(t,e)})}catch(e){j(t,e)}}function O(){return ut++}function k(t){t[et]=ut++,t._state=void 0,t._result=void 0,t._subscribers=[]}function Y(t,e){this._instanceConstructor=t,this.promise=new t(p),this.promise[et]||k(this.promise),B(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?S(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&S(this.promise,this._result))):j(this.promise,q())}function q(){return new Error("Array Methods must be provided an Array")}function F(t){return new Y(this,t).promise}function D(t){var e=this;return new e(B(t)?function(n,r){for(var o=t.length,i=0;i<o;i++)e.resolve(t[i]).then(n,r)}:function(t,e){return e(new TypeError("You must pass an array to race."))})}function K(t){var e=this,n=new e(p);return j(n,t),n}function L(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function N(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function U(t){this[et]=O(),this._result=this._state=void 0,this._subscribers=[],p!==t&&("function"!=typeof t&&L(),this instanceof U?C(this,t):N())}function W(){var t=void 0;if("undefined"!=typeof global)t=global;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=U}var z=void 0;z=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var B=z,G=0,H=void 0,I=void 0,J=function(t,e){$[G]=t,$[G+1]=e,G+=2,2===G&&(I?I(a):tt())},Q="undefined"!=typeof window?window:void 0,R=Q||{},V=R.MutationObserver||R.WebKitMutationObserver,X="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),Z="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,$=new Array(1e3),tt=void 0;tt=X?o():V?s():Z?u():void 0===Q&&"function"==typeof require?f():c();var et=Math.random().toString(36).substring(16),nt=void 0,rt=1,ot=2,it=new M,st=new M,ut=0;return Y.prototype._enumerate=function(){for(var t=this.length,e=this._input,n=0;this._state===nt&&n<t;n++)this._eachEntry(e[n],n)},Y.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,r=n.resolve;if(r===h){var o=_(t);if(o===l&&t._state!==nt)this._settledAt(t._state,e,t._result);else if("function"!=typeof o)this._remaining--,this._result[e]=t;else if(n===U){var i=new n(p);w(i,t,o),this._willSettleAt(i,e)}else this._willSettleAt(new n(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},Y.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===nt&&(this._remaining--,t===ot?j(r,n):this._result[e]=n),0===this._remaining&&S(r,this._result)},Y.prototype._willSettleAt=function(t,e){var n=this;E(t,void 0,function(t){return n._settledAt(rt,e,t)},function(t){return n._settledAt(ot,e,t)})},U.all=F,U.race=D,U.resolve=h,U.reject=K,U._setScheduler=n,U._setAsap=r,U._asap=J,U.prototype={constructor:U,then:l,catch:function(t){return this.then(null,t)}},W(),U.polyfill=W,U.Promise=U,U});
}).call(this,require('_process'),typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"_process":10}],9:[function(require,module,exports){
"use strict";function toObject(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function shouldUseNative(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var r={},t=0;t<10;t++)r["_"+String.fromCharCode(t)]=t;var n=Object.getOwnPropertyNames(r).map(function(e){return r[e]});if("0123456789"!==n.join(""))return!1;var o={};return"abcdefghijklmnopqrst".split("").forEach(function(e){o[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},o)).join("")}catch(e){return!1}}var hasOwnProperty=Object.prototype.hasOwnProperty,propIsEnumerable=Object.prototype.propertyIsEnumerable;module.exports=shouldUseNative()?Object.assign:function(e,r){for(var t,n,o=toObject(e),a=1;a<arguments.length;a++){t=Object(arguments[a]);for(var c in t)hasOwnProperty.call(t,c)&&(o[c]=t[c]);if(Object.getOwnPropertySymbols){n=Object.getOwnPropertySymbols(t);for(var s=0;s<n.length;s++)propIsEnumerable.call(t,n[s])&&(o[n[s]]=t[n[s]])}}return o};
},{}],10:[function(require,module,exports){
function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(e){if(cachedSetTimeout===setTimeout)return setTimeout(e,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(e,0);try{return cachedSetTimeout(e,0)}catch(t){try{return cachedSetTimeout.call(null,e,0)}catch(t){return cachedSetTimeout.call(this,e,0)}}}function runClearTimeout(e){if(cachedClearTimeout===clearTimeout)return clearTimeout(e);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(e);try{return cachedClearTimeout(e)}catch(t){try{return cachedClearTimeout.call(null,e)}catch(t){return cachedClearTimeout.call(this,e)}}}function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var e=runTimeout(cleanUpNextTick);draining=!0;for(var t=queue.length;t;){for(currentQueue=queue,queue=[];++queueIndex<t;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,t=queue.length}currentQueue=null,draining=!1,runClearTimeout(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}var process=module.exports={},cachedSetTimeout,cachedClearTimeout;!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var queue=[],draining=!1,currentQueue,queueIndex=-1;process.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var u=1;u<arguments.length;u++)t[u-1]=arguments[u];queue.push(new Item(e,t)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(e){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(e){throw new Error("process.chdir is not supported")},process.umask=function(){return 0};
},{}],11:[function(require,module,exports){
"use strict";var promiseExtensions_1=require("./../helpers/promiseExtensions"),activityManagementAPI_1=require("./activityManagementAPI"),activityAGM_1=require("../core/activityAGM"),ActivityAPI=function(){function t(t,e){this.version="2.4.1",this.__mgr=t,this._my=e,this.all=new activityManagementAPI_1.ActivityManagementAPI(t,e)}return t.prototype.ready=function(t){var e=this,i=new Promise(function(t,i){e.__mgr.ready().then(function(){t(e)}).catch(function(t){i(t)})});return promiseExtensions_1.nodeify(i,t)},Object.defineProperty(t.prototype,"my",{get:function(){return this._my},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aware",{get:function(){return void 0!==this._my.window},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inActivity",{get:function(){return this.aware&&void 0!==this._my.activity},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"agm",{get:function(){if(this.aware)return this.inActivity?this._my.activity.agm:new activityAGM_1.ActivityAGM(null)},enumerable:!0,configurable:!0}),t}();exports.ActivityAPI=ActivityAPI;
},{"../core/activityAGM":19,"./../helpers/promiseExtensions":30,"./activityManagementAPI":12}],12:[function(require,module,exports){
"use strict";var util=require("./../helpers/util"),ActivityManagementAPI=function(){function i(i,t){this._m=i,this._my=t,this.activityTypes={get:this._getActivityTypesWrapper.bind(this),register:this._m.registerActivityType.bind(this._m),unregister:this._m.unregisterActivityType.bind(this._m),subscribe:this._m.subscribeActivityTypeEvents.bind(this._m),unsubscribe:void 0,initiate:this._m.initiate.bind(this._m)},this.windowTypes={get:this._getWindowTypesWrapper.bind(this),registerFactory:this._m.registerWindowFactory.bind(this._m),unregisterFactory:this._m.unregisterWindowFactory.bind(this._m),subscribe:this._m.subscribeWindowTypeEvents.bind(this._m),unsubscribe:void 0},this.windows={get:this._m.getWindows.bind(this._m),subscribe:this._m.subscribeWindowEvents.bind(this._m),announce:this._m.announceWindow.bind(this._m),unsubscribe:void 0,create:this._m.createWindow.bind(this._m)},this.instances={get:this._m.getActivities.bind(this._m),subscribe:this._m.subscribeActivityEvents.bind(this._m),unsubscribe:void 0}}return i.prototype._getActivityTypesWrapper=function(i){return util.isUndefined(i)?this._m.getActivityTypes():this._m.getActivityType(i)},i.prototype._getWindowTypesWrapper=function(i){return util.isUndefined(i)?this._m.getWindowTypes():this._m.getWindowType(i)},i}();exports.ActivityManagementAPI=ActivityManagementAPI;
},{"./../helpers/util":32}],13:[function(require,module,exports){
"use strict";var logger_1=require("./../helpers/logger"),util=require("./../helpers/util"),ActivityMy=function(){function t(t){var i=this;this._myActivityJoinedCallbacks=[],this._myActivityRemovedCallbacks=[],this._myContextUpdateCallbacks=[],this._logger=logger_1.Logger.Get(this),this._m=t,t.ready().then(function(t){t.subscribeActivityContextChanged(i._subscribeMyContextChanged.bind(i)),t.subscribeWindowEvents(i._subscribeMyWindowEvent.bind(i))})}return Object.defineProperty(t.prototype,"window",{get:function(){if(util.isUndefinedOrNull(this._w)){var t=this._m.announcedWindows;t.length>0&&(this._w=t[0])}return this._w},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activity",{get:function(){var t=this.window;if(!util.isUndefinedOrNull(t))return t.activity},enumerable:!0,configurable:!0}),t.prototype.createWindow=function(t){return this._m.createWindow(this.activity,t)},t.prototype.createStackedWindows=function(t,i){return this._m.createStackedWindows(this.activity,t,i)},Object.defineProperty(t.prototype,"context",{get:function(){var t=this.activity;return util.isUndefined(t)?{}:t.context},enumerable:!0,configurable:!0}),t.prototype.onActivityJoined=function(t){this._myActivityJoinedCallbacks.push(t);var i=this.window;util.isUndefinedOrNull(i)||util.isUndefinedOrNull(i.activity)||t(i.activity)},t.prototype.onActivityLeft=function(t){this._myActivityRemovedCallbacks.push(t)},t.prototype.onContextChanged=function(t){this._myContextUpdateCallbacks.push(t);var i=this.window;if(!util.isUndefinedOrNull(i)){var e=i.activity;util.isUndefinedOrNull(e)||t(e.context,e.context,[],e)}},t.prototype._subscribeMyContextChanged=function(t,i,e,n){var o=this.window;if(!util.isUndefinedOrNull(o)){var r=o.activity;util.isUndefinedOrNull(r)||t.id===r.id&&this._notifyMyContextChanged(t,i,e,n)}},t.prototype._subscribeMyWindowEvent=function(t,i,e){util.isUndefinedOrNull(this.window)||this.window.id===i.id&&("joined"===e?this._notifyOnJoined(t):this._notifyMyWindowEvent(t,this._myActivityRemovedCallbacks))},t.prototype._notifyMyWindowEvent=function(t,i){for(var e=0;e<i.length;e++){var n=i[e];try{n(t,event)}catch(t){this._logger.warn("error in user callback "+t)}}},t.prototype._notifyMyContextChanged=function(t,i,e,n){e=e||{},n=n||[];for(var o=0;o<this._myContextUpdateCallbacks.length;o++){var r=this._myContextUpdateCallbacks[o];try{r(i,e,n,t)}catch(t){this._logger.warn("error in user callback "+t)}}},t.prototype._notifyOnJoined=function(t){this._notifyMyWindowEvent(t,this._myActivityJoinedCallbacks),this._notifyMyContextChanged(t,t.context)},t}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ActivityMy;
},{"./../helpers/logger":29,"./../helpers/util":32}],14:[function(require,module,exports){
"use strict";var ActivityConfig=function(){function i(){}return i}();exports.ActivityConfig=ActivityConfig;
},{}],15:[function(require,module,exports){
"use strict";require("es6-promise");var hcBridge_1=require("./bridges/hcBridge"),activityManager_1=require("./core/activityManager"),activityMyAPI_1=require("./API/activityMyAPI"),logger_1=require("./helpers/logger"),util=require("./helpers/util"),activityConfig_1=require("./activityConfig"),activityAPI_1=require("./API/activityAPI"),activityAGM_1=require("./core/activityAGM"),activity=function(i){i=i||new activityConfig_1.ActivityConfig,util.isUndefined(i.logLevel)||(logger_1.Logger.Level=i.logLevel),util.isUndefinedOrNull(i.logger)||(logger_1.Logger.GlueLogger=i.logger);var e;if(util.isUndefined(window.htmlContainer))throw new Error("Activity not supported in in browser");if(e=new hcBridge_1.default,!e)throw new Error("A bridge to native activity is needed to create activity lib.");activityAGM_1.ActivityAGM.AGM=i.agm;var t=new activityManager_1.default(e,!i.disableAutoAnnounce),r=new activityMyAPI_1.default(t);return new activityAPI_1.ActivityAPI(t,r)};module.exports=activity;
},{"./API/activityAPI":11,"./API/activityMyAPI":13,"./activityConfig":14,"./bridges/hcBridge":16,"./core/activityAGM":19,"./core/activityManager":20,"./helpers/logger":29,"./helpers/util":32,"es6-promise":8}],16:[function(require,module,exports){
"use strict";var entityEvent_1=require("../contracts/entityEvent"),activityStatus_1=require("../contracts/activityStatus"),activityType_1=require("../entities/activityType"),windowType_1=require("../entities/windowType"),activity_1=require("../entities/activity"),activityWindow_1=require("../entities/activityWindow"),proxyWindowFactory_1=require("../core/proxyWindowFactory"),logger_1=require("../helpers/logger"),entityEvent_2=require("../contracts/entityEvent"),readyMarker_1=require("../helpers/readyMarker"),util=require("../helpers/util"),entityEvent_3=require("../contracts/entityEvent"),HCBridge=function(){function t(t){this._activityTypeEntityName="activityType",this._windowTypeEntityName="windowType",this._activityEntityName="activity",this._windowEntityName="activityWindow",this._logger=logger_1.Logger.Get(this),this._lastSeq=0,this._eventQueue=[],this._activityTypeCallbacks=[],this._windowTypeCallbacks=[],this._activityCallbacks=[],this._windowCallbacks=[],this._agm=t}return t.prototype.init=function(){var t=this;this._readyMarker=new readyMarker_1.ReadyMarker("HC Bridge",1),this._htmlContainer=window.htmlContainer.activityFacade,this._htmlContainer.init(this._agm?this._agm.instance:void 0,this._hcEventHandler.bind(this),function(){t._readyMarker.signal("Init done from HC")},function(i){t._readyMarker.error(i)})},t.prototype.ready=function(){var t=this;return new Promise(function(i,n){t._readyMarker.setCallback(function(e){e?(t._logger.error("Error initializing HC bridge - "+e),n(t._readyMarker.getError())):i(t)})})},t.prototype._hcEventHandler=function(t){this._logger.trace(t);var i=JSON.parse(t);this._processEventBySeq(i)},t.prototype._processEventBySeq=function(t){var i=t.sequence;if(i===this._lastSeq+1){this._processEvent(t),this._lastSeq++;var n=this._eventQueue[i+1];util.isUndefined(n)||(this._logger.debug("replaying message number "+i),this._processEventBySeq(n),delete this._eventQueue[i+1])}else this._eventQueue[i]=t,this._logger.debug("Got out of order event with number "+i+". Will wait for previous event(s) before replaying.")},t.prototype._processEvent=function(i){var n,e=i.entityType,o=this._convertContext(i.context);switch(e){case this._activityTypeEntityName:n=t._hcToJsActivityType(i.entity),this._publishActivityTypeStatusChange(n,o);break;case this._windowTypeEntityName:n=this._hcToJsWindowType(i.entity),this._publishWindowTypeStatusChange(n,o);break;case this._activityEntityName:n=this._hcToJsActivity(i.entity),this._publishActivityStatusChange(n,o);break;case this._windowEntityName:n=t._hcToJsWindow(i.entity),this._publishActivityWindowEvent(n,o)}},t.prototype._convertContext=function(t){if(t.type===entityEvent_1.EntityEventType.StatusChange){var i=new activityStatus_1.ActivityStatus(t.oldStatus.state,t.oldStatus.statusMessage,t.oldStatus.statusTime),n=new activityStatus_1.ActivityStatus(t.newStatus.state,t.newStatus.statusMessage,t.newStatus.statusTime);return new entityEvent_1.EntityStatusChangeEventContext(n,i)}if(t.type===entityEvent_1.EntityEventType.ActivityWindowEvent){var e=this._hcToJsActivity(t.activity);return new entityEvent_1.EntityActivityWindowEventContext(e,t.event)}return t.type===entityEvent_1.EntityEventType.ActivityContextChange?new entityEvent_3.ActivityContextChangedContext(t.newContext,t.updated,t.removed):new entityEvent_1.EntityEventContext(t.type)},t._hcToJsWindow=function(t){return new activityWindow_1.default(t.id,t.name,t.type,t.activityId,t.instance,t.isIndependent)},t.prototype._hcToJsActivity=function(i){var n=i.owner?t._hcToJsWindow(i.owner):null,e=n?n.id:null,o=new activityStatus_1.ActivityStatus(i.status.state,i.status.statusMessage,i.status.statusTime),r=JSON.parse(i.context);return new activity_1.default(i.id,i.type.name,o,r,e)},t._hcToJsActivityType=function(t){return new activityType_1.default(t.name,t.ownerWindowType,t.helperWindowTypes,t.description)},t.prototype._hcToJsWindowType=function(i){util.isUndefined(i.factories)&&(i.factories=[]);var n=i.factories.map(function(i){return t._hcToJsWindowTypeFactory(i)});return new windowType_1.default(i.name,n)},t._hcToJsWindowTypeFactory=function(t){return new proxyWindowFactory_1.ProxyWindowFactory(t.description)},t._getURLParameter=function(t){return decodeURIComponent((new RegExp("[?|&]"+t+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null},t.prototype.getActivityTypes=function(){var i=this;return new Promise(function(n,e){i._htmlContainer.getActivityTypes(function(i){for(var e=[],o=0;o<i.length;o++){var r=i[o],a=t._hcToJsActivityType(r);e.push(a)}n(e)},function(t){e(t)})})},t.prototype.registerActivityType=function(i,n,e,o,r){var a=this;return new Promise(function(s,c){void 0===e&&(e=[]);var u={name:i,ownerWindowType:n,helperWindowTypes:e,description:r,layoutConfig:JSON.stringify(o)};a._htmlContainer.registerActivityType(JSON.stringify(u),function(i){var n=t._hcToJsActivityType(i);s(n)},function(t){c(t)})})},t.prototype.unregisterActivityType=function(t){var i=this;return new Promise(function(n,e){i._htmlContainer.unregisterActivityType(t,function(t){n(!0)},function(t){e(t)})})},t.prototype.getWindowTypes=function(){var t=this;return new Promise(function(i,n){t._htmlContainer.getWindowTypes(function(n){for(var e=[],o=0;o<n.length;o++){var r=n[o],a=t._hcToJsWindowType(r);e.push(a)}i(e)},function(t){n(t)})})},t.prototype.registerWindowFactory=function(t,i){var n=this;return new Promise(function(e,o){return util.isUndefinedOrNull(t)?void o("windowTypeName should be provided"):void n._htmlContainer.registerWindowFactory(t,i.create.bind(i),function(t){e(!0)},function(t){o(t)})})},t.prototype.initiateActivity=function(t,i,n){var e=this;return new Promise(function(n,o){return util.isUndefinedOrNull(t)?void o("windowTypeName should be provided"):(util.isUndefinedOrNull(i)&&(i={}),void e._htmlContainer.initiate(t,JSON.stringify(i),function(t){n(t)},function(t){o(t)}))})},t.prototype.getAnnouncementInfo=function(){var i=window.htmlContainer,n=i.getContext(),e={activityWindowId:"",activityWindowType:"",activityWindowIndependent:!1,activityWindowName:""};return e.activityWindowType=n.activityWindowType,util.isUndefined(e.activityWindowType)&&(e.activityWindowType=t._getURLParameter("activityWindowType")),e.activityWindowId=n.activityWindowId,util.isUndefined(e.activityWindowId)&&(e.activityWindowId=t._getURLParameter("activityWindowId")),e.activityWindowIndependent=n.activityWindowIndependent,util.isUndefined(e.activityWindowIndependent),e.activityWindowName=n.activityWindowName,util.isUndefined(e.activityWindowName)&&(e.activityWindowName=t._getURLParameter("activityWindowName")),e},t.prototype.announceWindow=function(t,i){var n=this;if(util.isUndefined(t))throw new Error("can not determine window type");if(util.isUndefined(t))throw new Error("can not determine window activityWindowId");this._htmlContainer.announceWindow(t,i,function(t){n._logger.error("Error announcing activity window with id '"+i+"'. "+t)})},t.prototype.getActivities=function(){var t=this;return new Promise(function(i,n){t._logger.trace("Executing getActivities()"),t._htmlContainer.getActivities(function(n){t._logger.trace("Got getActivities() :"+n);var e=JSON.parse(n),o=e.map(function(i){return t._hcToJsActivity(i)});i(o)},function(i){t._logger.trace("Error in getActivities() :"+i),n(i)})})},t.prototype.updateActivityContext=function(t,i,n,e){var o=this;return new Promise(function(r,a){util.isUndefined(e)&&(e=[]);var s={fullReplace:n,removedKeys:e};o._htmlContainer.setActivityContext(t.id,JSON.stringify(i),JSON.stringify(s),function(t){var i=JSON.parse(t);r(i)},function(t){return a(t)})})},t.prototype.getActivityWindows=function(){var i=this;return new Promise(function(n,e){i._htmlContainer.getWindows(function(i){var e=i.map(function(i){return t._hcToJsWindow(i)});n(e)},function(t){e(t)})})},t.prototype.stopActivity=function(t){var i=this;return new Promise(function(n,e){i._htmlContainer.stopActivity(t.id,function(t){n(t)},function(t){e(t)})})},t.prototype.unregisterWindowFactory=function(t){var i=this;return new Promise(function(n,e){i._htmlContainer.registerWindowFactory(t,function(t){n(!0)},function(t){e(t)})})},t.prototype.createWindow=function(t,i){var n=this;return new Promise(function(e,o){n._htmlContainer.createWindow(t,JSON.stringify(i),function(t){e(t)},function(t){o(t)})})},t.prototype.createStackedWindows=function(t,i,n){var e=this;return new Promise(function(o,r){e._htmlContainer.createStackedWindows(t,JSON.stringify(i),n,function(t){o(t)},function(t){r(t)})})},t.prototype.onActivityTypeStatusChange=function(t){this._activityTypeCallbacks.push(t)},t.prototype.onWindowTypeStatusChange=function(t){this._windowTypeCallbacks.push(t)},t.prototype.onActivityStatusChange=function(t){this._activityCallbacks.push(t)},t.prototype.onActivityWindowChange=function(t){this._windowCallbacks.push(t)},t.prototype.getWindowBounds=function(t){var i=this;return new Promise(function(n,e){i._htmlContainer.getWindowBounds(t,function(t){n(t)},function(t){e(t)})})},t.prototype.setWindowBounds=function(t,i){var n=this;return new Promise(function(e,o){n._htmlContainer.setWindowBounds(t,JSON.stringify(i),function(){e()},function(t){o(t)})})},t.prototype.registerWindow=function(t,i,n){var e=this;return new Promise(function(o,r){e._htmlContainer.registerWindow(t,i,n,function(t){o(t)},function(t){r(t)})})},t.prototype.closeWindow=function(t){var i=this;return new Promise(function(n,e){i._htmlContainer.closeWindow(t,function(){n()},function(t){e(t)})})},t.prototype.activateWindow=function(t,i){var n=this;return new Promise(function(e,o){n._htmlContainer.activateWindow(t,i,function(){e()},function(t){o(t)})})},t.prototype._publishStatusChange=function(t,i,n){var e=new entityEvent_2.EntityEvent(t,i);n.forEach(function(t){t(e)})},t.prototype._publishActivityTypeStatusChange=function(t,i){this._publishStatusChange(t,i,this._activityTypeCallbacks)},t.prototype._publishWindowTypeStatusChange=function(t,i){this._publishStatusChange(t,i,this._windowTypeCallbacks)},t.prototype._publishActivityStatusChange=function(t,i){this._publishStatusChange(t,i,this._activityCallbacks)},t.prototype._publishActivityWindowEvent=function(t,i){this._publishStatusChange(t,i,this._windowCallbacks)},t}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=HCBridge;
},{"../contracts/activityStatus":17,"../contracts/entityEvent":18,"../core/proxyWindowFactory":22,"../entities/activity":23,"../entities/activityType":25,"../entities/activityWindow":26,"../entities/windowType":27,"../helpers/logger":29,"../helpers/readyMarker":31,"../helpers/util":32}],17:[function(require,module,exports){
"use strict";var ActivityStatus=function(){function t(t,e,i){this.state=t,this.message=e,this.time=i}return t.prototype.getState=function(){return this.state},t.prototype.getMessage=function(){return this.message},t.prototype.getTime=function(){return this.time},t}();exports.ActivityStatus=ActivityStatus;
},{}],18:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(t,n){function e(){this.constructor=t}for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i]);t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)},EntityEvent=function(){function t(t,n){this.entity=t,this.context=n}return t}();exports.EntityEvent=EntityEvent;var EntityEventContext=function(){function t(t){this.type=t}return t}();exports.EntityEventContext=EntityEventContext;var EntityStatusChangeEventContext=function(t){function n(n,e){t.call(this,EntityEventType.StatusChange),this.newStatus=n,this.oldStatus=e}return __extends(n,t),n}(EntityEventContext);exports.EntityStatusChangeEventContext=EntityStatusChangeEventContext;var EntityActivityWindowEventContext=function(t){function n(n,e){t.call(this,EntityEventType.ActivityWindowEvent),this.activity=n,this.event=e}return __extends(n,t),n}(EntityEventContext);exports.EntityActivityWindowEventContext=EntityActivityWindowEventContext;var ActivityContextChangedContext=function(t){function n(n,e,i){t.call(this,EntityEventType.ActivityContextChange),this.updated=e,this.removed=i,this.context=JSON.parse(n)}return __extends(n,t),n}(EntityEventContext);exports.ActivityContextChangedContext=ActivityContextChangedContext;var EntityEventType=function(){function t(){}return t.Added="added",t.Removed="removed",t.Updated="updated",t.FactoryRegistered="factoryRegistered",t.FactoryUnregistered="factoryUnregistered",t.StatusChange="statusChange",t.ActivityContextChange="activityContextUpdate",t.ActivityWindowEvent="activityWindowEvent",t}();exports.EntityEventType=EntityEventType;
},{}],19:[function(require,module,exports){
"use strict";var util=require("../helpers/util"),ActivityAGM=function(){function t(t){this._activity=t}return t.prototype.register=function(i,e){this._ensureHasAgm(),t.AGM.register(i,e)},t.prototype.servers=function(){return this._ensureHasAgm(),util.isUndefinedOrNull(this._activity)?[]:this._activity.windows.map(function(t){return t.instance})},t.prototype.methods=function(){if(this._ensureHasAgm(),util.isUndefinedOrNull(this._activity))return[];for(var t=this._activity.windows,i=[],e=[],n=0;n<t.length;n++)for(var r=t[n],s=this.methodsForWindow(r),o=0;o<s.length;o++){var u=s[o];i.indexOf(u.name)===-1&&(i.push(u.name),e.push(u))}return e},t.prototype.methodsForWindow=function(i){return this._ensureHasAgm(),i.instance?t.AGM.methodsForInstance(i.instance):[]},t.prototype.invoke=function(i,e,n,r,s,o){this._ensureHasAgm();var u=this.servers(),a=[];if(util.isUndefinedOrNull(n)&&(n="activity.all"),util.isString(n))if("activity.all"===n)a=u;else{if("activity.best"!==n){if("all"===n||"best"===n)return t.AGM.invoke(i,e,n,r,s,o);throw new Error("Invalid invoke target "+n)}var c=u.filter(function(e){var n=t.AGM.methodsForInstance(e);return n.filter(function(t){return t.name===i}).length>0});c.length>0&&(a=[c[0]])}else if(util.isArray(n)){if(n.length>=0){var f=n[0];if(this._isAgmInstance(f))a=n.map(function(t){return t});else{if(!this._isActivityWindow(f))throw new Error("Unknown target object");a=n.map(function(t){return t.instance})}}}else if(this._isAgmInstance(n))a=[n];else{if(!this._isActivityWindow(n))throw new Error("Unknown target object");a=[n.instance]}return t.AGM.invoke(i,e,a,r,s,o)},t.prototype.unregister=function(i){return this._ensureHasAgm(),t.AGM.unregister(i)},t.prototype.createStream=function(i,e,n){this._ensureHasAgm(),t.AGM.createStream(i,e,n)},t.prototype.subscribe=function(i,e,n){this._ensureHasAgm();var r=this.servers();return t.AGM.subscribe(i,e,r)},t.prototype._ensureHasAgm=function(){if(util.isUndefinedOrNull(t.AGM))throw new Error("Agm should be configured to be used in activity")},t.prototype._isAgmInstance=function(t){return void 0!=t.application},t.prototype._isActivityWindow=function(t){return void 0!==t.instance},t}();exports.ActivityAGM=ActivityAGM;
},{"../helpers/util":32}],20:[function(require,module,exports){
"use strict";var entityEvent_1=require("../contracts/entityEvent"),activityType_1=require("../entities/activityType"),promiseExtensions_1=require("../helpers/promiseExtensions"),readyMarker_1=require("../helpers/readyMarker"),entityObservableCollection_1=require("../helpers/entityObservableCollection"),logger_1=require("../helpers/logger"),util=require("../helpers/util"),localWindowFactory_1=require("./localWindowFactory"),ActivityManager=function(){function i(i,t){var e=this;if(this._logger=logger_1.Logger.Get(this),this._announcedWindows=[],this._bridge=i,this._activityTypes=new entityObservableCollection_1.EntityObservableCollection(function(i){return e._grabEntity(i)}),this._windowTypes=new entityObservableCollection_1.EntityObservableCollection(function(i){return e._grabEntity(i)}),this._activities=new entityObservableCollection_1.EntityObservableCollection(function(i){return e._grabEntity(i)}),this._windows=new entityObservableCollection_1.EntityObservableCollection(function(i){return e._grabEntity(i)}),this._dataReadyMarker=new readyMarker_1.ReadyMarker("Activity Manager Data",["GetActivityTypes","GetWindowTypes","GetActivities","GetWindows"].length),t){var n=new readyMarker_1.ReadyMarker("Activity Manager Announce",["Announcement"].length);this._readyMarker=n,this._dataReadyMarker.setCallback(function(i){i&&e._readyMarker.error(i),e._logger.debug("Auto announcing window"),e.announceWindow().then(function(i){e._announcedWindows.push(i),e._readyMarker.signal("Successfully announced window with id '"+i.id+"'")}).catch(function(i){e._logger.debug("Will not announce window - "+i),e._readyMarker.signal()})})}else this._readyMarker=this._dataReadyMarker;this._bridge.init(),this._bridge.ready().then(function(i){e._subscribeForData()}).catch(function(i){console.log(i)})}return Object.defineProperty(i.prototype,"announcedWindows",{get:function(){return this._announcedWindows},set:function(i){throw new Error("not allowed")},enumerable:!0,configurable:!0}),i.prototype.ready=function(i){var t=this,e=new Promise(function(i,e){t._readyMarker.setCallback(function(n){n?e(t._readyMarker.getError()):i(t)})});return promiseExtensions_1.nodeify(e,i)},i.prototype.getActivityTypes=function(){return this._activityTypes.get()},i.prototype.getActivityType=function(i){return this._activityTypes.getByName(i)},i.prototype.registerActivityType=function(i,t,e,n,r,o){var s=this,a=new Promise(function(o,a){util.isUndefinedOrNull(i)&&a("activityTypeName argument can not be undefined"),util.isString(i)||a("activityTypeName should be string");var d=s.getActivityType(i);util.isUndefinedOrNull(d)||a("Activity type '"+i+"' already exists");var u;util.isUndefined(t)&&a("Owner window type can not be undefined"),u=util.isString(t)?{type:t,name:"",isIndependent:!1,arguments:{}}:t;var c=[];if(!util.isUndefined(e)&&util.isArray(e))for(var y in e){var l=e[y];if(util.isString(l)){var f={type:l,name:"",isIndependent:!1,arguments:{},relativeTo:"",relativeDirection:"",windowStyleAttributes:{}};c.push(f)}else c.push(l)}s._bridge.registerActivityType(i,u,c,n,r).then(function(i){s._grabEntity(i),o(i)}).catch(function(i){a(i)})});return promiseExtensions_1.nodeify(a,o)},i.prototype.unregisterActivityType=function(i,t){var e=this,n=new Promise(function(t,n){var r=e.getActivityType(i);return util.isUndefined(r)&&n("Activity type '"+i+"' does not exists"),e._bridge.unregisterActivityType(i)});return promiseExtensions_1.nodeify(n,t)},i.prototype.initiate=function(i,t,e){var n=this,r=new Promise(function(e,r){var o=n.getActivityType(i);util.isUndefined(o)&&r("Activity type '"+i+"' does not exists"),n._bridge.initiateActivity(i,t).then(function(i){n._activities.getOrWait(i).then(function(i){e(i)}).catch(function(i){return r(i)})}).catch(function(i){r(i)})});return promiseExtensions_1.nodeify(r,e)},i.prototype.subscribeActivityTypeEvents=function(i){this._activityTypes.subscribe(function(t,e){i(t,e.type)})},i.prototype.getWindowTypes=function(){return this._windowTypes.get()},i.prototype.getWindowType=function(i){return this._windowTypes.getByName(i)},i.prototype.registerWindowFactory=function(i,t,e,n){var r=this,o=new Promise(function(n,o){if(util.isUndefinedOrNull(i))return void o("no windowType specified");if(util.isObject(i))i=i.getName();else if(!util.isString(i))return void o("windowType should be string or object that has getName method");var s=new localWindowFactory_1.LocalWindowFactory(t,e);r._bridge.registerWindowFactory(i,s).then(function(i){n(i)}).catch(function(i){o(i)})});return promiseExtensions_1.nodeify(o,n)},i.prototype.unregisterWindowFactory=function(i,t){var e=this,n=new Promise(function(t,n){return util.isUndefinedOrNull(i)?void n("no windowType specified"):util.isString(i)?void e._bridge.unregisterWindowFactory(i).then(function(i){t(i)}).catch(function(i){n(i)}):void n("windowType should be a string")});return promiseExtensions_1.nodeify(n,t)},i.prototype.getActivities=function(i){var t=this._activities.get();if(!i)return t;var e=i;if(util.isString(i))e=[i];else if(i instanceof activityType_1.default)e=[i.name];else if(!(i instanceof Array))throw new Error("Invalid input argument 'activityType' = "+i);return t.filter(function(i){var t=i.type;return util.some(e,function(i){return t.id==i.id})})},i.prototype.getActivityById=function(i){return this._activities.getByName(i)},i.prototype.announceWindow=function(i,t){var e=this,n=new Promise(function(n,r){var o=e._bridge.getAnnouncementInfo();if(util.isUndefined(i)&&(i=o.activityWindowId),util.isUndefined(t)&&(t=o.activityWindowType),util.isUndefinedOrNull(t))throw new Error("Can not announce - unknown windowType");if(util.isUndefinedOrNull(i))e._logger.debug("Registering window with type:'"+t+"', name:'"+o.activityWindowName+"', ind.:'"+o.activityWindowIndependent+"'"),e._bridge.registerWindow(t,o.activityWindowName,o.activityWindowIndependent).then(e._windows.getOrWait.bind(e._windows)).then(function(i){n(i)}).catch(function(i){e._logger.error(i)});else{e._logger.debug("Announcing window with id '"+i+"' and type '"+t+"'");var s=e._windows.getByName(i);if(!util.isUndefinedOrNull(s))return e._logger.debug("Window with id '"+i+"' already announced - reusing the window"),void n(s);var a=function(t,o,s){if(i===o.id&&"joined"===s){var d=o.activity;util.isUndefined(d)&&r("UNDEFINED ACTIVITY"),e._logger.trace("Got joined event for id '"+i+"'"),n(o),e.unsubscribeWindowEvents(a)}};e.subscribeWindowEvents(a),e._logger.trace("Waiting for joined event for id '"+i+"'"),e._bridge.announceWindow(t,i)}});return n},i.prototype.subscribeWindowTypeEvents=function(i){this._windowTypes.subscribe(function(t,e){i(t,e.type)})},i.prototype.subscribeActivityEvents=function(i){this._activities.subscribe(function(t,e){if(e.type===entityEvent_1.EntityEventType.StatusChange){var n=e;i(t,n.newStatus,n.oldStatus)}})},i.prototype.subscribeWindowEvents=function(i){this._windows.subscribe(function(t,e){if(e.type===entityEvent_1.EntityEventType.ActivityWindowEvent){var n=e;i(t.activity,t,n.event)}else"removed"===e.type&&i(t.activity,t,e.type)})},i.prototype.unsubscribeWindowEvents=function(i){},i.prototype.createWindow=function(i,t,e){var n=this,r=new Promise(function(e,r){util.isUndefinedOrNull(i)&&r("activity is undefined"),util.isUndefinedOrNull(t)&&r("windowType is undefined");var o;o=util.isString(t)?{type:t,name:"",isIndependent:!1,arguments:{}}:t;var s;if(!util.isUndefinedOrNull(o.relativeTo))if(s=o.relativeTo,util.isString(s)){var a=n.getWindows({type:s});!util.isUndefinedOrNull(a)&&a.length>0&&(o.relativeTo=a[0].id)}else if(util.isUndefinedOrNull(s.type))util.isUndefinedOrNull(s.windowId)||(o.relativeTo=s.windowId);else{var a=n.getWindows({type:s.type});!util.isUndefinedOrNull(a)&&a.length>0&&(o.relativeTo=a[0].id)}n._bridge.createWindow(i.id,o).then(function(i){n._logger.debug("Window created, waiting for window entity with id "+i);var t=function(n,r){n.id===i&&n.activity&&(this._logger.debug("Got entity window with id "+i),e(n),this._windows.unsubscribe(t))}.bind(n);n._windows.subscribe(t)}).catch(function(i){r(i)})});return promiseExtensions_1.nodeify(r,e)},i.prototype.createStackedWindows=function(i,t,e,n){var r=this,o=new Promise(function(n,o){util.isUndefinedOrNull(i)&&o("activity is undefined"),util.isUndefinedOrNull(t)&&o("relativeWindowTypes is undefined"),Array.isArray(t)||o("relativeWindowTypes has to be array"),util.isUndefinedOrNull(e)&&(e=2e4);var s=[];t.forEach(function(i){var t;t=util.isString(i)?{type:i,name:"",isIndependent:!1,arguments:{}}:i;var e;if(!util.isUndefinedOrNull(t.relativeTo))if(e=t.relativeTo,util.isUndefinedOrNull(e.type)){if(!util.isUndefinedOrNull(e.windowId)){var n=r.getWindows({id:e.windowId});!util.isUndefinedOrNull(n)&&n.length>0&&(t.relativeTo=n[0].type.name,t.useExisting=!0)}}else t.relativeTo=e.type;s.push(t)}),r._bridge.createStackedWindows(i.id,s,e).then(function(i){var t=[],e=[],o=function(r,s){i.indexOf(r.id)>=0&&e.indexOf(r.id)<0&&r.activity&&(this._logger.debug("Got entity window with id "+i),t.push(r),e.push(r.id),t.length==i.length&&(n(t),this._windows.unsubscribe(o)))}.bind(r);r._windows.subscribe(o)}).catch(function(i){o(i)})});return promiseExtensions_1.nodeify(o,n)},i.prototype.joinWindowToActivity=function(i,t,e){},i.prototype.leaveWindowFromActivity=function(i,t,e){},i.prototype.setActivityContext=function(i,t,e){var n=this,r=new Promise(function(e,r){util.isUndefinedOrNull(i)&&r("activity can not be null"),n._bridge.updateActivityContext(i,t,!0).then(function(i){e(i)}).catch(function(i){r(i)})});return promiseExtensions_1.nodeify(r,e)},i.prototype.updateActivityContext=function(i,t,e){var n=this,r=new Promise(function(e,r){util.isUndefinedOrNull(i)&&r("activity can not be null");var o=[];for(var s in t)t.hasOwnProperty(s)&&null===t[s]&&o.push(s);n._bridge.updateActivityContext(i,t,!1,o).then(function(i){e(i)}).catch(function(i){r(i)})});return promiseExtensions_1.nodeify(r,e)},i.prototype.subscribeActivityContextChanged=function(i){this._activities.subscribe(function(t,e){if(e.type===entityEvent_1.EntityEventType.ActivityContextChange){var n=e;i(t,n.context,n.updated,n.removed)}})},i.prototype.stopActivity=function(i,t){var e=this._bridge.stopActivity(i);return promiseExtensions_1.nodeify(e,t)},i.prototype.getWindows=function(i){if(util.isUndefined(i))return this._windows.get();if(!util.isUndefined(i.id))return[this._windows.getByName(i.id)];var t=this._windows.get();return t.filter(function(t){if(!util.isUndefined(i.type)&&t.type.id!==i.type)return!1;if(!util.isUndefined(i.name)&&t.name!==i.name)return!1;if(!util.isUndefined(i.activityId)){if(util.isUndefinedOrNull(t.activity))return!1;if(t.activity.id!==i.activityId)return!1}return!0})},i.prototype._grabEntity=function(i){i.manager=this},i.prototype._subscribeForData=function(){var i=this;this._logger.debug("Start getting initial data..."),this._bridge.onActivityTypeStatusChange(function(t){i._activityTypes.process(t)}),this._bridge.getActivityTypes().then(function(t){i._activityTypes.add(t),i._dataReadyMarker.signal("Got act types")}).catch(function(t){i._logger.error(t),i._dataReadyMarker.error("Can not initialize ActivityManager - error getting activity types -"+t)}),this._bridge.onWindowTypeStatusChange(function(t){i._windowTypes.process(t)}),this._bridge.getWindowTypes().then(function(t){i._windowTypes.add(t),i._dataReadyMarker.signal("Got window types")}).catch(function(t){i._logger.error(t),i._dataReadyMarker.error("Can not initialize ActivityManager - error getting window types  "+t)}),this._bridge.onActivityStatusChange(function(t){i._activities.process(t)}),this._bridge.getActivities().then(function(t){i._activities.add(t),i._dataReadyMarker.signal("Got activities")}).catch(function(t){i._logger.error(t),i._dataReadyMarker.error("Can not initialize ActivityManager - error getting activity instances -"+t)}),this._bridge.onActivityWindowChange(function(t){i._windows.process(t)}),this._bridge.getActivityWindows().then(function(t){i._windows.add(t),i._dataReadyMarker.signal("Got windows")}).catch(function(t){i._logger.error(t),i._dataReadyMarker.error("Can not initialize ActivityManager - error getting activity windows -"+t)})},i.prototype.getWindowBounds=function(i){return this._bridge.getWindowBounds(i)},i.prototype.setWindowBounds=function(i,t,e){var n=this,r=new Promise(function(e,r){n._bridge.setWindowBounds(i,t).then(function(){return e()}).catch(function(i){return r(i)})});return promiseExtensions_1.nodeify(r,e)},i.prototype.closeWindow=function(i){return this._bridge.closeWindow(i)},i.prototype.activateWindow=function(i,t){return this._bridge.activateWindow(i,t)},i}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ActivityManager;
},{"../contracts/entityEvent":18,"../entities/activityType":25,"../helpers/entityObservableCollection":28,"../helpers/logger":29,"../helpers/promiseExtensions":30,"../helpers/readyMarker":31,"../helpers/util":32,"./localWindowFactory":21}],21:[function(require,module,exports){
"use strict";var LocalWindowFactory=function(){function t(t,o){this._createFunction=t,this._description=o}return t.prototype.create=function(t,o,n){return this._createFunction(t,o,n)},t.prototype.description=function(){return this._description},t}();exports.LocalWindowFactory=LocalWindowFactory;
},{}],22:[function(require,module,exports){
"use strict";var ProxyWindowFactory=function(){function t(t){this._description=t}return t.prototype.create=function(t,o){},t.prototype.description=function(){return this._description},t}();exports.ProxyWindowFactory=ProxyWindowFactory;
},{}],23:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},activityEntity_1=require("./activityEntity"),activityAGM_1=require("../core/activityAGM"),Activity=function(t){function e(e,i,n,o,r){t.call(this,e),this._id=e,this._actType=i,this._status=n,this._context=o,this._ownerId=r,this._agm=new activityAGM_1.ActivityAGM(this)}return __extends(e,t),Object.defineProperty(e.prototype,"type",{get:function(){if(this.manager)return this.manager.getActivityType(this._actType)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"context",{get:function(){return this._context},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"owner",{get:function(){return this._ownerId?this.manager.getWindows({id:this._ownerId})[0]:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"windows",{get:function(){return this.manager.getWindows({activityId:this._id})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"agm",{get:function(){return this._agm},enumerable:!0,configurable:!0}),e.prototype.join=function(t,e){return this.manager.joinWindowToActivity(this,t,e)},e.prototype.createWindow=function(t,e){return this.manager.createWindow(this,t,e)},e.prototype.createStackedWindows=function(t,e,i){return this.manager.createStackedWindows(this,t,e,i)},e.prototype.leave=function(t,e){return this.manager.leaveWindowFromActivity(this,t,e)},e.prototype.getWindowsByType=function(t){var e={activityId:this._id,type:t};return this.manager.getWindows(e)},e.prototype.setContext=function(t,e){return this.manager.setActivityContext(this,t,e)},e.prototype.updateContext=function(t,e){return this.manager.updateActivityContext(this,t,e)},e.prototype.onStatusChange=function(t){var e=this;this.manager.subscribeActivityEvents(function(i,n,o){i.id===e.id&&t(i,n,o)})},e.prototype.onWindowEvent=function(t){var e=this;this.manager.subscribeWindowEvents(function(i,n,o){i.id===e.id&&t(i,n,o)})},e.prototype.onContextChanged=function(t){var e=this;this.manager.subscribeActivityContextChanged(function(i,n,o,r){i.id===e.id&&t(n,o,r,i)});try{t(this.context,this.context,[],this)}catch(t){}},e.prototype.stop=function(){this.manager.stopActivity(this)},e.prototype.updateCore=function(e){t.prototype.updateCore.call(this,e),this._actType=e._actType,this._context=e._context,this._status=e._status,this._ownerId=e._ownerId},e}(activityEntity_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Activity;
},{"../core/activityAGM":19,"./activityEntity":24}],24:[function(require,module,exports){
"use strict";var ActivityEntity=function(){function t(t){this.listeners=[],this._id=t}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),t.prototype.onUpdated=function(t){this.listeners.push(t)},t.prototype.update=function(t){if(t._id!=this._id)throw Error("Can not update from entity with different id.");this.updateCore(t),this.notify()},t.prototype.updateCore=function(t){},t.prototype.notify=function(){for(var t=0;t<this.listeners.length;t++){var e=this.listeners[t];e(this)}},t}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ActivityEntity;
},{}],25:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},activityEntity_1=require("./activityEntity"),ActivityType=function(t){function e(e,i,n,r){t.call(this,e),this._name=e,this._description=r,this._ownerWindow=i,this._helperWindows=n||[]}return __extends(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){return this._description},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"helperWindows",{get:function(){return this._helperWindows},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ownerWindow",{get:function(){return this._ownerWindow},enumerable:!0,configurable:!0}),e.prototype.subscribeActivityStatusChange=function(t){},e.prototype.initiate=function(t,e){return this.manager.initiate(this._name,t,e)},e.prototype.updateCore=function(e){t.prototype.updateCore.call(this,e),this._description=e._description,this._ownerWindow=e._ownerWindow,this._helperWindows=e._helperWindows},e}(activityEntity_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ActivityType;
},{"./activityEntity":24}],26:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},activityEntity_1=require("./activityEntity"),logger_1=require("../helpers/logger"),util=require("../helpers/util"),ActivityWindow=function(t){function e(e,i,n,o,r,s){t.call(this,e),this._logger=logger_1.Logger.Get(this),this._type=n,this._activityId=o,this._name=i,this._instance=r,this._isIndependent=s}return __extends(e,t),e.prototype.getBounds=function(){return this.manager.getWindowBounds(this.id)},Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isIndependent",{get:function(){return this._isIndependent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){if(this.manager)return this.manager.getWindowType(this._type)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activity",{get:function(){if(!util.isUndefined(this._activityId))return this.manager.getActivityById(this._activityId)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isOwner",{get:function(){var t=this.activity;return!util.isUndefined(t)&&t.owner.id===this.id},enumerable:!0,configurable:!0}),e.prototype.setVisible=function(t,e){},e.prototype.activate=function(t){return this.manager.activateWindow(this.id,t)},e.prototype.setTitle=function(t,e){},e.prototype.setBounds=function(t,e){return this.manager.setWindowBounds(this.id,t,e)},e.prototype.setState=function(t,e){},e.prototype.close=function(){return this.manager.closeWindow(this.id)},Object.defineProperty(e.prototype,"instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),e.prototype.onActivityJoined=function(t){this._subscribeForActivityWindowEvent("joined",t)},e.prototype.onActivityRemoved=function(t){this._subscribeForActivityWindowEvent("removed",t)},e.prototype.updateCore=function(t){this._activityId=t._activityId,this._isIndependent=t._isIndependent,util.isUndefinedOrNull(t._instance)||(this._instance=t._instance)},e.prototype._subscribeForActivityWindowEvent=function(t,e){var i=this;this.manager.subscribeWindowEvents(function(n,o,r){o.id===i.id&&r===t&&e(n)})},e}(activityEntity_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ActivityWindow;
},{"../helpers/logger":29,"../helpers/util":32,"./activityEntity":24}],27:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},activityEntity_1=require("./activityEntity"),WindowType=function(t){function e(e,r){t.call(this,e),this._name=e,this._factories=r}return __extends(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"factories",{get:function(){return this._factories},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"windows",{get:function(){return this.manager.getWindows({type:this._name})},enumerable:!0,configurable:!0}),e.prototype.registerFactory=function(t,e,r,n){return this.manager.registerWindowFactory(this,e,r)},e}(activityEntity_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=WindowType;
},{"./activityEntity":24}],28:[function(require,module,exports){
"use strict";var entityEvent_1=require("../contracts/entityEvent"),EntityObservableCollection=function(){function t(t){this._items={},this._listeners=[],this._processNew=t}return t.prototype.addOne=function(t){this.add([t])},t.prototype.add=function(t){for(var e=0;e<t.length;e++){var i=t[e];this.process(new entityEvent_1.EntityEvent(i,new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.Added)))}},t.prototype.process=function(t){var e=t.context,i=e.type,n=t.entity,s=this._updateInternalCollections(n,i);this._notifyListeners(s,e)},t.prototype.get=function(){var t=[];for(var e in this._items)if(this._items.hasOwnProperty(e)){var i=this._items[e];t.push(i)}return t},t.prototype.getByName=function(t){for(var e in this._items)if(e===t)return this._items[e]},t.prototype.getOrWait=function(t){var e=this;return new Promise(function(i){var n=function(s){s.id===t&&(i(s),e.unsubscribe(n))};e.subscribe(n);var s=e.getByName(t);if(s)return void i(s)})},t.prototype.subscribe=function(t){this._listeners.push(t);for(var e in this._items){var i=this._items[e];t(i,new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.Added.toString()))}},t.prototype.unsubscribe=function(t){var e=this._listeners.indexOf(t);e!=-1&&this._listeners.splice(e,1)},t.prototype._notifyListeners=function(t,e){for(var i=0;i<this._listeners.length;i++){var n=this._listeners[i];try{n(t,e)}catch(t){}}},t.prototype._updateInternalCollections=function(t,e){if(e===entityEvent_1.EntityEventType.Removed)return delete this._items[t.id],this._processNew(t),t;var i=t.id;return this._items.hasOwnProperty(i)?this._items[t.id].update(t):(this._processNew(t),this._items[t.id]=t),this._items[t.id]},t}();exports.EntityObservableCollection=EntityObservableCollection;
},{"../contracts/entityEvent":18}],29:[function(require,module,exports){
"use strict";var util=require("./util"),LogLevel=function(){function e(){}return e.Trace="trace",e.Debug="debug",e.Info="info",e.Warn="warn",e.Error="error",e}();exports.LogLevel=LogLevel;var Logger=function(){function e(o){this._name=o,util.isUndefinedOrNull(e.GlueLogger)||(this._glueLogger=e.GlueLogger.subLogger(o))}return e.GetNamed=function(o){return new e(o)},e.Get=function(o){return new e(e.GetTypeName(o))},e.prototype.trace=function(o){util.isUndefinedOrNull(this._glueLogger)?e.Level===LogLevel.Trace&&console.info(this._getMessage(o,LogLevel.Trace)):this._glueLogger.trace(o)},e.prototype.debug=function(o){util.isUndefinedOrNull(this._glueLogger)?e.Level!==LogLevel.Debug&&e.Level!==LogLevel.Trace||console.info(this._getMessage(o,LogLevel.Debug)):this._glueLogger.debug(o)},e.prototype.info=function(o){util.isUndefinedOrNull(this._glueLogger)?e.Level!==LogLevel.Debug&&e.Level!==LogLevel.Trace&&e.Level!==LogLevel.Info||console.info(this._getMessage(o,LogLevel.Info)):this._glueLogger.info(o)},e.prototype.warn=function(o){util.isUndefinedOrNull(this._glueLogger)?e.Level!==LogLevel.Debug&&e.Level!==LogLevel.Trace&&e.Level!==LogLevel.Info&&e.Level!==LogLevel.Warn||console.info(this._getMessage(o,LogLevel.Info)):this._glueLogger.warn(o)},e.prototype.error=function(e){util.isUndefinedOrNull(this._glueLogger)?(console.error(this._getMessage(e,LogLevel.Error)),console.trace()):this._glueLogger.error(e)},e.prototype._getMessage=function(e,o){return"["+o+"] "+this._name+" - "+e},e.GetTypeName=function(e){var o=/function (.{1,})\(/,g=o.exec(e.constructor.toString());return g&&g.length>1?g[1]:""},e.Level=LogLevel.Info,e}();exports.Logger=Logger;
},{"./util":32}],30:[function(require,module,exports){
"use strict";function nodeify(n,i){return util.isFunction(i)?void n.then(function(n){nextTick(function(){i(null,n)})},function(n){nextTick(function(){i(n,null)})}):n}var util=require("../helpers/util"),nextTick=function(n){setTimeout(n,0)};exports.nodeify=nodeify;
},{"../helpers/util":32}],31:[function(require,module,exports){
"use strict";var logger_1=require("./logger"),util=require("../helpers/util"),ReadyMarker=function(){function r(r,i){if(this._logger=logger_1.Logger.GetNamed("ReadyMarker ["+r+"]"),this._logger.debug("Initializing ready marker for '"+r+"' with "+i+" signals to wait"),i<=0)throw new Error("Invalid signal number. Should be > 0");this._signals=i,this._callbacks=[],this._name=r}return r.prototype.setCallback=function(r){return this.isSet()?void r(void 0):this.isError()?void r(this._error):void this._callbacks.push(r)},r.prototype.signal=function(r){if(this._logger.debug("Signaled - "+r+" - signals left "+(this._signals-1)),this._signals--,this._signals<0)throw new Error("Error in ready marker '"+this._name+" - signals are "+this._signals);this.isSet()&&this._callbacks.forEach(function(r){r(void 0)})},r.prototype.error=function(r){this._error=r,this._callbacks.forEach(function(i){i(r)})},r.prototype.isSet=function(){return!this.isError()&&0===this._signals},r.prototype.isError=function(){return!util.isUndefined(this._error)},r.prototype.getError=function(){return this._error},r}();exports.ReadyMarker=ReadyMarker;
},{"../helpers/util":32,"./logger":29}],32:[function(require,module,exports){
"use strict";function isNumber(r){return"number"==typeof r}function isString(r){return"string"==typeof r}function isObject(r){return"object"==typeof r&&null!==r}function isArray(r){return Array.isArray?Array.isArray(r):"[object Array]"===toString.call(r)}function isUndefined(r){return"undefined"==typeof r}function isUndefinedOrNull(r){return!r||"undefined"==typeof r}function isEmpty(r){for(var n in r)if(r.hasOwnProperty(n))return!1;return!0}function isFunction(r){return!!(r&&r.constructor&&r.call&&r.apply)}function some(r,n){for(var t=0;t<r.length;t++)if(n(r[t],t))return!0;return!1}function first(r,n){for(var t=0;t<r.length;t++)if(n(r[t],t))return r[t]}exports.isNumber=isNumber,exports.isString=isString,exports.isObject=isObject,exports.isArray=isArray,exports.isUndefined=isUndefined,exports.isUndefinedOrNull=isUndefinedOrNull,exports.isEmpty=isEmpty,exports.isFunction=isFunction,exports.some=some,exports.first=first;
},{}],33:[function(require,module,exports){
var random=require("./helpers/random");module.exports=function(e){"use strict";function o(o,s,n,r,d,i){var c=random();t(c,{method:o,calledWith:s},d,i,r.method_response_timeout),e.invoke(c,o,s,n,r)}function t(e,o,t,s,r){n[e]={response:o,success:t,error:s},setTimeout(function(){void 0!==n[e]&&(s({method:o.method,called_with:o.calledWith,message:"Timeout reached"}),delete n[e])},r)}function s(e,o,t,s,r){var d=n[e];void 0!==d&&(0===t&&"function"==typeof d.success?d.success({method:d.response.method.info,called_with:d.response.calledWith,executed_by:o,returned:s,message:r}):"function"==typeof d.error&&d.error({method:d.response.method.info,called_with:d.response.calledWith,executed_by:o,message:r,status:t}),delete n[e])}var n={};return e.onInvocationResult(s),{invoke:o}};
},{"./helpers/random":43}],34:[function(require,module,exports){
(function (global){
var Promise=require("es6-promise").Promise,ClientInvocationsState=require("./agm-client-invoke"),promisify=require("./helpers/promisify");module.exports=function(e,t,r,n){"use strict";function o(e){return void 0===e?t.getMethods():("string"==typeof e&&(e={name:e}),t.getMethods().filter(function(t){return h(e,t.info)}))}function i(e){var r=t.getServers(),n=r.filter(function(t){return m(e,t.info)});if(0===n.length)return[];var o={};return 1===n.length?o=n[0].methods:n.forEach(function(e){Object.keys(e.methods).forEach(function(t){var r=e.methods[t];o[r.id]=r.getInfoForUser()})}),Object.keys(o).map(function(e){return o[e]})}function s(e){var r=t.getServers();if(void 0===e)return r.map(function(e){return{server:e}});var n=o(e);return void 0===n?[]:r.reduce(function(r,n){var o=t.getServerMethodsById(n.id),i=o.filter(function(t){return h(e,t.info)});return i.length>0&&r.push({server:n,methods:i}),r},[])}function u(e,t){var r=s(e);return c(t,r)}function a(e,t,r,o,i,s){var a=new Promise(function(i,s){var a,c;a=function(e){i(e)},c=function(e){s(e)},t||(t={}),r||(r="best"),"string"==typeof r&&"all"!==r&&"best"!==r&&s({message:'"'+r+'" is not a valid target. Valid targets are "all" and "best".'}),o||(o={}),void 0===o.method_response_timeout&&(o.method_response_timeout=n.method_response_timeout),void 0===o.wait_for_method_timeout&&(o.wait_for_method_timeout=n.wait_for_method_timeout),"object"!=typeof t&&s({message:"The method arguments must be an object."}),"string"==typeof e&&(e={name:e});var m=u(e,r);if(0===m.length)f(e,t,r,o,a,c);else if(1===m.length){var h=m[0];g.invoke(h.methods[0],t,h.server,o,a,c)}else d(m,t,o,a,c)});return promisify(a,i,s)}function f(e,t,r,n,o,i){function s(){i({method:e,called_with:t,message:'Can not find a method matching "'+JSON.stringify(e)+'" with server filter "'+JSON.stringify(r)+'"'})}0===n.wait_for_method_timeout?s():setTimeout(function(){var f=u(e,r);f.length>0?a(e,t,r,n,o,i):s()},n.wait_for_method_timeout)}function d(e,t,r,n,o){function i(){if(!(s.length+u.length<e.length))if(0!==s.length){var t=s.reduce(function(e,t){return e.method=t.method,e.called_with=t.called_with,e.returned=t.returned,e.all_return_values.push({executed_by:t.executed_by,returned:t.returned}),e.executed_by=t.executed_by,e},{all_return_values:[]});0!==u.length&&(t.all_errors=[],u.forEach(function(e){t.all_errors.push({name:e.method.name,message:e.message})})),n(t)}else 0!==u.length&&o(u.reduce(function(e,t){return e.method=t.method,e.called_with=t.called_with,e.message=t.message,e.all_errors.push({executed_by:t.executed_by,message:t.message}),e},{all_errors:[]}))}var s=[],u=[],a=function(e){s.push(e),i(s,u)},f=function(e){u.push(e),i(s,u)};e.forEach(function(e){g.invoke(e.methods[0],t,e.server,r,a,f)})}function c(e,t){return"string"==typeof e?"all"===e?e=t:"best"===e&&(e=void 0!==t[0]?[t[0]]:[]):(Array.isArray(e)||(e=[e]),e=e.reduce(function(e,r){var n=t.filter(function(e){return m(r,e.server.info)});return e.concat(n)},[])),e}function m(e,t){return l(e,t)}function h(e,t){return l(e,t)}function l(e,t){return Object.keys(e).reduce(function(r,n){return e[n]?e[n].constructor===RegExp?!!e[n].test(t[n])&&r:String(e[n]).toLowerCase()===String(t[n]).toLowerCase()&&r:r},!0)}function v(t,r,o,i){function s(r,o,i,s,u){void 0!==global.console&&n.debug===!0&&console.log('>>> Subscribing to "'+t+'" on '+r.length+" servers"),e.subscribe(o,i.arguments,r,{method_response_timeout:i.waitTimeoutMs},s,u)}var a=new Promise(function(e,o){var i=function(t){e(t)},a=function(e){o(e)};void 0===r&&(r={});var f=r.target;void 0===f&&(f="best"),"string"==typeof f&&"all"!==f&&"best"!==f&&o({message:'"'+f+'" is not a valid target. Valid targets are "all", "best", or an instance.'}),"number"==typeof r.waitTimeoutMs&&r.waitTimeoutMs===r.waitTimeoutMs||(r.waitTimeoutMs=n.wait_for_method_timeout);var d=u({name:t},f);0===d.length?setTimeout(function(){var e=u({name:t},f),n=e.length>0?e[0].methods[0]:{name:t};s(e,n,r,i,a)},r.waitTimeoutMs):s(d,d[0].methods[0],r,i,a)});return promisify(a,o,i)}var g=new ClientInvocationsState(e);return{subscribe:v,invoke:a,servers:function(e){return s(e).map(function(e){return e.server.getInfoForUser()})},methods:function(e){return o(e).map(function(e){return e.getInfoForUser()})},methodsForInstance:function(e){return i(e).map(function(e){return e.getInfoForUser()})},methodAdded:function(e){t.onMethodAdded(function(t){e(t.getInfoForUser())})},methodRemoved:function(e){t.onMethodRemoved(function(t){e(t.getInfoForUser())})},serverAdded:function(e){t.onServerAdded(function(t){e(t.getInfoForUser())})},serverRemoved:function(e){t.onServerRemoved(function(t,r){e(t.getInfoForUser(),r)})},serverMethodAdded:function(e){t.onServerMethodAdded(function(t,r){e({server:t.getInfoForUser(),method:r.getInfoForUser()})})},serverMethodRemoved:function(e){t.onServerMethodRemoved(function(t,r){e({server:t.getInfoForUser(),method:r.getInfoForUser()})})}}};
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./agm-client-invoke":33,"./helpers/promisify":42,"es6-promise":8}],35:[function(require,module,exports){
(function (global){
var document=global.document||global.process,random=require("./helpers/random");module.exports=function(e){"use strict";function n(e){a||(void 0===i.MachineName&&(i.MachineName=e.MachineName),void 0===i.UserName&&(i.UserName=e.UserName),void 0===i.Environment&&(i.Environment=e.Environment),void 0===i.Region&&(i.Region=e.Region),void 0===i.State&&(i.State=e.State),void 0!==global.console&&void 0!==global.console.table&&agm.debug===!0&&console.log("Received instance with info from Gateway."),a=!0)}function t(e){return i[e]}function o(){return i}var i={};i.ApplicationName=document.title+random(),i.ProcessId=Math.floor(1e10*Math.random()),i.ProcessStartTime=(new Date).getTime(),"object"==typeof e&&(void 0!==e.application&&(i.ApplicationName=e.application),i.MachineName=e.machine,i.UserName=e.user,i.Environment=e.environment,i.Region=e.region,i.State=1);var a=!1;return{_updateIdentity:n,info:o,get application(){return t("ApplicationName")},get pid(){return t("ProcessId")},get user(){return t("UserName")},get machine(){return t("MachineName")}}};
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./helpers/random":43}],36:[function(require,module,exports){
(function (global){
var Promise=require("es6-promise").Promise,promisify=require("./helpers/promisify"),pjson=require("../package.json");module.exports=function(e){"use strict";function r(e,r){if("string"==typeof e){var t={};return t[r]=e,t}return e}function t(e){return JSON.parse(e,function(e,r){if("string"!=typeof r)return r;if(r[0]!==a[0])return r;if(0!==r.indexOf(a))return r;var t=r.substr(o);return new Date(parseFloat(t))})}function i(e){if(e=e||"best","string"==typeof e){if("all"!==e&&"best"!==e)throw new Error('"'+e+'" is not a valid target. Valid targets are "all" and "best".');return{target:e}}return Array.isArray(e)||(e=[e]),e=e.map(function(e){return n(e)}),{serverFilter:e}}function n(e){var r={};return Object.keys(e).forEach(function(t){var i=e[t];r[t]=i,"undefined"!=typeof i&&null!==i&&("string"==typeof i?r[t]="^"+e[t]+"$":e[t].constructor===RegExp?r[t]=e[t].source:r[t]=e[t])}),r}var s=global.htmlContainer.jsAgmFacade,a=s.jsonValueDatePrefix,o=a.length;return new Promise(function(n){var a={version:pjson.version,register:function(e,t){var i=this.agmFacade.protocolVersion;i&&i>=3?this.agmFacade.register(JSON.stringify(r(e,"name")),t,!0):this.agmFacade.register(JSON.stringify(r(e,"name")),function(e){var r=t(JSON.parse(e),arguments[1]);return JSON.stringify(r)})},registerAsync:function(e,t){if(!this.agmFacade.registerAsync)throw new Error("not supported in that version of HtmlContainer");this.agmFacade.registerAsync(r(e,"name"),function(e,r,i){t(e,r,function(e){i.success(e)},function(e){i.error(e)})})},unregister:function(e){this.agmFacade.unregister(JSON.stringify(r(e,"name")))},invoke:function(e,t,n,s,a,o){var d=new Promise(function(a,o){if(void 0===t&&(t={}),"object"!=typeof t&&o({message:"The method arguments must be an object."}),void 0===s&&(s={}),n=i(n),this.agmFacade.invoke2)this.agmFacade.invoke2(JSON.stringify(r(e,"name")),t,JSON.stringify(n),JSON.stringify(s),function(e){a(e)},function(e){o(e)});else{var d,c;d=function(e){var r=JSON.parse(e);a(r)},c=function(e){var r=JSON.parse(e);o(r)},this.agmFacade.invoke(JSON.stringify(r(e,"name")),JSON.stringify(t),JSON.stringify(n),JSON.stringify(s),d,c)}}.bind(this));return promisify(d,a,o)},methodAdded:function(e){this.agmFacade.methodAdded(e)},methodRemoved:function(e){this.agmFacade.methodRemoved(e)},serverAdded:function(e){this.agmFacade.serverAdded(e)},serverRemoved:function(e){this.agmFacade.serverRemoved(e)},serverMethodAdded:function(e){this.agmFacade.serverMethodAdded(e)},serverMethodRemoved:function(e){this.agmFacade.serverMethodRemoved(e)},servers:function(e){var r=this.agmFacade.servers(JSON.stringify(e));return t(r)},methods:function(e){var r=this.agmFacade.methods(JSON.stringify(e));return t(r)},methodsForInstance:function(e){var r=this.agmFacade.methodsForInstance(JSON.stringify(e));return t(r)},subscribe:function(e,r,t,n){var s=new Promise(function(t,n){void 0===r&&(r={}),r.args=JSON.stringify(r.arguments||{}),r.target=i(r.target),this.agmFacade.subscribe2(e,JSON.stringify(r),function(e){t(e)},function(e){n(e)})}.bind(this));return promisify(s,t,n)},createStream:function(e,r,t,i){var n=new Promise(function(t,i){"string"==typeof e&&(e={name:e}),r||(r={}),this.agmFacade.createStream2(JSON.stringify(e),r.subscriptionRequestHandler,r.subscriptionAddedHandler,r.subscriptionRemovedHandler,function(e){t(e)},function(e){i(e)})}.bind(this));return promisify(n,t,i)}};if(void 0!==e&&void 0!==e.metrics){e.metrics.metricsIdentity=e.metrics.identity;var o={metricsIdentity:e.metrics.metricsIdentity,path:e.metrics.path};e.metrics=o}delete e.logger,a.instance=s.init(JSON.stringify(e)),a.agmFacade=s,a.create_stream=a.createStream,a.methods_for_instance=a.methodsForInstance,a.method_added=a.methodAdded,a.method_removed=a.methodRemoved,a.server_added=a.serverAdded,a.server_removed=a.serverRemoved,a.server_method_added=a.serverMethodAdded,a.server_method_removed=a.serverMethodRemoved,n(a)})};
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../package.json":57,"./helpers/promisify":42,"es6-promise":8}],37:[function(require,module,exports){
var Callbacks=require("callback-registry");module.exports=function(){"use strict";function e(e,r){var n=m[r];if(n)return n.id;var o={id:r,info:e,methods:{}};return o.getInfoForUser=function(){return f(o.info)},m[r]=o,S.execute("onServerAdded",o),r}function r(e,r){var n=m[e];Object.keys(n.methods).forEach(function(r){t(e,r)}),delete m[e],S.execute("onServerRemoved",n,r)}function n(e,r){var n=m[e];if(!n)throw new Error("server does not exists");var t=o(r);if(!n.methods[t]){var d={id:t,info:r};d.getInfoForUser=function(){return h(d.info)},n.methods[t]=d,p[t]||(p[t]=0,S.execute("onMethodAdded",d)),p[t]=p[t]+1,S.execute("onServerMethodAdded",n,d)}}function o(e){var r=void 0!==e.accepts?e.accepts:"",n=void 0!==e.returns?e.returns:"",o=void 0!==e.version?e.version:0;return(e.name+r+n+o).toLowerCase()}function t(e,r){var n=m[e];if(!n)throw new Error("server does not exists");var o=n.methods[r];delete n.methods[r],p[r]=p[r]-1,0===p[r]&&S.execute("onMethodRemoved",o),S.execute("onServerMethodRemoved",n,o)}function d(){var e={};Object.keys(m).forEach(function(r){var n=m[r];Object.keys(n.methods).forEach(function(r){var o=n.methods[r];e[o.id]=o})});var r=Object.keys(e).map(function(r){return e[r]});return r}function i(){var e=[];return Object.keys(m).forEach(function(r){var n=m[r];e.push(n)}),e}function c(e){var r=m[e];return Object.keys(r.methods).map(function(e){return r.methods[e]})}function s(e){S.add("onServerAdded",e),i().forEach(function(r){e(r)})}function a(e){S.add("onMethodAdded",e),d().forEach(function(r){e(r)})}function u(e){S.add("onServerMethodAdded",e)}function v(e){return m[e]}function f(e){return{machine:e.machine,pid:e.pid,user:e.user,application:e.application,environment:e.environment,region:e.region,instance:e.instance}}function h(e){return{name:e.name,accepts:e.accepts,returns:e.returns,description:e.description,displayName:e.displayName,version:e.version,objectTypes:e.objectTypes,supportsStreaming:e.supportsStreaming}}var m={},p={},S=new Callbacks;return{getServerById:v,getServers:i,getMethods:d,getServerMethodsById:c,getMethodId:o,addServer:e,addServerMethod:n,removeServerById:r,removeServerMethod:t,onServerAdded:s,onServerRemoved:function(e){S.add("onServerRemoved",e)},onMethodAdded:a,onMethodRemoved:function(e){S.add("onMethodRemoved",e)},onServerMethodAdded:u,onServerMethodRemoved:function(e){S.add("onServerMethodRemoved",e)}}};
},{"callback-registry":5}],38:[function(require,module,exports){
module.exports=function(n,t){"use strict";function e(e){var i=e.definition;return{branches:function(){var t=n.getBranchList(e);return t.map(function(n){return s(e,n)})},close:function(){n.closeAllSubscriptions(e),t(e.definition)},definition:{accepts:i.accepts,description:i.description,displayName:i.displayName,name:i.name,objectTypes:i.objectTypes,returns:i.returns,supportsStreaming:i.supportsStreaming},name:i.name,push:function(t,r){if("string"!=typeof r&&!Array.isArray(r)&&void 0!==r)throw new Error("invalid branches should be string or string array");if("object"!=typeof t)throw new Error("Invalid arguments. Data must be an object.");n.pushData(e,t,r)},subscriptions:function(){var t=n.getSubscriptionList(e);return t.map(function(n){return r(e,n)})}}}function r(t,e){return{arguments:e.arguments||{},branchKey:e.branchKey,close:function(){n.closeSingleSubscription(t,e)},instance:e.instance,push:function(r){n.pushDataToSingle(t,e,r)},stream:t.definition}}function s(t,e){return{key:e,subscriptions:function(){var s=n.getSubscriptionList(t,e);return s.map(function(n){return r(t,n)})},close:function(){n.closeAllSubscriptions(t,e)},push:function(r){n.pushToBranch(t,r,e)}}}return n.onSubRequest(function(t,e){e&&e.streamCallbacks&&"function"==typeof e.streamCallbacks.subscriptionRequestHandler&&e.streamCallbacks.subscriptionRequestHandler({accept:function(){n.acceptRequestOnBranch(t,e,"")},acceptOnBranch:function(r){n.acceptRequestOnBranch(t,e,r)},arguments:t.arguments,instance:t.instance,reject:function(r){n.rejectRequest(t,e,r)}})}),n.onSubAdded(function(n,t){t&&t.streamCallbacks&&"function"==typeof t.streamCallbacks.subscriptionAddedHandler&&t.streamCallbacks.subscriptionAddedHandler(r(t,n))}),n.onSubRemoved(function(n,t){t&&t.streamCallbacks&&"function"==typeof t.streamCallbacks.subscriptionRemovedHandler&&t.streamCallbacks.subscriptionRemovedHandler(n)}),{streamFrontObj:e}};
},{}],39:[function(require,module,exports){
module.exports=function(){"use strict";function e(e){if("object"==typeof e&&void 0===e._repoId)return e._repoId=o,o+=1,i.push(e),e}function r(e){return"number"!=typeof e?new TypeError("Expecting a number"):void(i=i.filter(function(r){return r._repoId!==e}))}function n(e){return"number"!=typeof e?new TypeError("Expecting a number"):i.filter(function(r){return r._repoId===e})[0]}function t(){return i.map(function(e){return e})}function u(){return i.length}var o=0,i=[];return{add:e,remove:r,getById:n,getList:t,length:u}};
},{}],40:[function(require,module,exports){
var Promise=require("es6-promise").Promise,Promisify=require("./helpers/promisify"),Streaming=require("./agm-server-streaming");module.exports=function(e,n,t,r){"use strict";function i(n,t,r){m("Invocations count",g++),n&&n.theFunction(r,function(r,i){r&&("string"==typeof r.message?r=r.message:"string"!=typeof r&&(r="")),i&&"object"==typeof i&&i.constructor!==Array||(i={_result:i}),e.methodInvocationResult(n,t,r,i)})}function o(e,n){u(e,function(e,t){try{var r=n(e.args,e.instance);t(null,r)}catch(e){t(e,null)}})}function s(e,n){u(e,function(e,t){try{n(e.args,e.instance,function(e){t(null,e)},function(e){t(e,null)})}catch(e){t(e,null)}})}function c(t,r,i,o){var s=new Promise(function(i,o){"string"==typeof t&&(""===t&&o("Invalid stream name."),t={name:t}),t.supportsStreaming=!0,r||(r={}),"function"!=typeof r.subscriptionRequestHandler&&(r.subscriptionRequestHandler=function(e){e.accept()});var s={method:void 0,definition:t,streamCallbacks:r};n.add(s),e.createStream(s,t,function(){m("Registered methods",n.length());var e=d.streamFrontObj(s);i(e)},function(e){n.remove(s._repoId),o(e)})});return new Promisify(s,i,o)}function u(t,r){"string"==typeof t&&(t={name:t});var i=n.add({definition:t,theFunction:r});e.register(i,function(){m("Registered methods",n.length())},function(){n.remove(i._repoId)})}function a(e,n){var t=!0;return Object.keys(e).forEach(function(r){e[r]!==n[r]&&(t=!1)}),t}function f(t){"string"==typeof t&&(t={name:t});var r=n.getList().filter(function(e){return a(t,e.definition)});r.forEach(function(t){n.remove(t._repoId),e.unregister(t)}),m("Registered methods",n.length())}var m=void 0!==r.metrics?r.metrics.numberMetric.bind(r.metrics):function(){},d=new Streaming(e,f);e.onInvoked(i);var g=0;return{register:o,registerAsync:s,unregister:f,createStream:c}};
},{"./agm-server-streaming":38,"./helpers/promisify":42,"es6-promise":8}],41:[function(require,module,exports){
(function (global){
var connection=require("tick42-gateway-connection"),instance=require("./agm-instance"),nativeAgm=require("./agm-native"),deprecate=require("util-deprecate"),pjson=require("../package.json"),client=require("./agm-client"),server=require("./agm-server"),gW1Protocol=require("./protocols/gw1/protocol"),gW3Protocol=require("./protocols/gw3/protocol"),repository=require("./agm-repository"),vault=require("./agm-server-vault"),Promise=require("es6-promise").Promise;agm=function(e){"use strict";var r={};r.version=pjson.version,"object"!=typeof e&&(e={});var t=["connection","client","server"];t.forEach(function(r){"object"!=typeof e[r]&&(e[r]={}),e.debug&&(e[r].debug=!0)}),"number"!=typeof e.client.remove_server_on_n_missing_heartbeats&&(e.client.remove_server_on_n_missing_heartbeats=3),"number"!=typeof e.client.method_response_timeout&&(e.client.method_response_timeout=3e3),"number"!=typeof e.client.wait_for_method_timeout&&(e.client.wait_for_method_timeout=3e3),"number"!=typeof e.server.heartbeat_interval&&(e.server.heartbeat_interval=5e3),"number"!=typeof e.server.presence_interval&&(e.server.presence_interval=1e4);var o=e.connection;r.connection="object"==typeof o&&"function"==typeof o.send&&"function"==typeof o.on?o:connection(e.connection);var n="agm",d={send:function(e,t){r.connection.send(n,e,t)},on:function(e,t){r.connection.on(n,e,t)},connected:r.connection.connected,getPeerId:function(){return r.connection.peerId}},i=e.metrics;void 0!==i&&(e.client.metrics=i.subSystem("Client"),e.server.metrics=i.subSystem("Server")),r.instance=instance(e.instance);var s,c=repository(),m=vault(),a=o.protocolVersion;return s=3===a?gW3Protocol(r.instance,d,c,m,e):gW1Protocol(r.instance,d,c,m,e),new Promise(function(t,o){s.then(function(o){r.client=client(o,c,r.instance,e.client),r.server=server(o,m,r.instance,e.server),r.invoke=r.client.invoke,r.register=r.server.register,r.registerAsync=r.server.registerAsync,r.unregister=r.server.unregister,r.createStream=r.server.createStream,r.subscribe=r.client.subscribe,r.servers=r.client.servers,r.methods=r.client.methods,r.methodsForInstance=r.client.methodsForInstance,r.method=r.client.method,r.methodAdded=r.client.methodAdded,r.methodRemoved=r.client.methodRemoved,r.serverMethodAdded=r.client.serverMethodAdded,r.serverMethodRemoved=r.client.serverMethodRemoved,r.serverAdded=r.client.serverAdded,r.serverRemoved=r.client.serverRemoved,r.methods_for_instance=deprecate(r.client.methodsForInstance,"glue.agm.client.methods_for_instance() is deprecated and might be removed from future versions of glue. Use glue.agm.client.methodsForInstance() instead"),r.method_added=deprecate(r.client.methodAdded,"glue.agm.method_added() is deprecated and might be removed from future versions of glue. Use glue.agm.methodAdded() instead"),r.method_removed=deprecate(r.client.methodRemoved,"glue.agm.method_removed() is deprecated and might be removed from future versions of glue. Use glue.agm.methodRemoved() instead"),r.server_method_added=deprecate(r.client.serverMethodAdded,"glue.agm.server_method_added() is deprecated and might be removed from future versions of glue. Use glue.agm.serverMethodAdded() instead"),r.server_method_removed=deprecate(r.client.serverMethodRemoved,"glue.agm.server_method_removed() is deprecated and might be removed from future versions of glue. Use glue.agm.serverMethodRemoved() instead"),r.server_added=deprecate(r.client.serverAdded,"glue.agm.server_added() is deprecated and might be removed from future versions of glue. Use glue.agm.serverAdded() instead"),r.server_removed=deprecate(r.client.serverRemoved,"glue.agm.server_removed() is deprecated and might be removed from future versions of glue. Use glue.agm.serverRemoved() instead"),t(r)}).catch(function(e){o(e)})})},agm=void 0!==global.htmlContainer?nativeAgm:agm,void 0===global.tick42&&(global.tick42={}),global.tick42.agm=agm,module.exports=agm;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../package.json":57,"./agm-client":34,"./agm-instance":35,"./agm-native":36,"./agm-repository":37,"./agm-server":40,"./agm-server-vault":39,"./protocols/gw1/protocol":47,"./protocols/gw3/protocol":53,"es6-promise":8,"tick42-gateway-connection":75,"util-deprecate":106}],42:[function(require,module,exports){
(function (global){
module.exports=function(o,n,e){"use strict";return"function"!=typeof n&&"function"!=typeof e?o:("function"!=typeof n?n=function(){void 0!==global.console&&agm.debug===!0&&console.log("Success!")}:"function"!=typeof e&&(e=function(){void 0!==global.console&&agm.debug===!0&&console.log("An error occurred.")}),void o.then(n,e))};
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],43:[function(require,module,exports){
var cuid=require("cuid");module.exports=function(){"use strict";return cuid()};
},{"cuid":6}],44:[function(require,module,exports){
(function (global){
var random=require("./../../helpers/random"),helpers=require("./helpers");module.exports=function(e,t,r,n){"use strict";function s(s,a,u,c,i,d){if(0===u.length)return void d(f+" No available servers matched the target params.");var m="subscriptionId_"+random(),v=o(m,s,a,i,d,c.method_response_timeout);return"object"!=typeof v?void d(f+" Unable to register the user callbacks."):void u.forEach(function(o){var u=n();v.trackedServers.push({server:void 0,streamId:void 0,streamSubjects:{global:void 0,private:void 0},methodRequestSubject:s.info.requestSubject,methodResponseSubject:u});var i={EventStreamAction:1,MethodRequestSubject:s.info.requestSubject,MethodResponseSubject:u,Client:t.info(),Context:{ArgumentsJson:a,InvocationId:m,ObjectType:c.object_type,DisplayContext:c.display_context,MethodName:s.info.name,ExecutionServer:o.server,Timeout:c.method_response_timeout}};r(i),void 0!==global.console&&e.debug===!0&&(console.debug("%c>>> sending MethodInvocationRequestMessage","background-color:hsla(198, 51%, 79%, 0.5)"),console.debug("%c"+JSON.stringify(i),"background-color:hsla(198, 51%, 79%, 0.5)"))})}function o(e,t,r,n,s,o){return p[e]={status:v,method:t,arguments:r,success:n,error:s,trackedServers:[],handlers:{onData:[],onClosed:[]},queued:{data:[],closers:[]},timeoutId:void 0},p[e].timeoutId=setTimeout(function(){if(void 0!==p[e]){var n=p[e];if(n.status===v)s({method:t,called_with:r,message:f+" Subscription attempt timed out after "+o+"ms."}),delete p[e];else if(n.status===l&&n.trackedServers.length>0&&(n.trackedServers=n.trackedServers.filter(function(e){return"string"==typeof e.streamId&&""!==e.streamId}),n.timeoutId=void 0,0===n.trackedServers.length)){var a=n.queued.closers.length,u=a>0?n.queued.closers[a-1]:null;n.handlers.onClosed.forEach(function(e){"function"==typeof e&&e({message:S,requestArguments:n.arguments,server:u,stream:n.method})}),delete p[e]}}},o),p[e]}function a(e){e&&e.EventStreamAction&&0!==e.EventStreamAction&&(2===e.EventStreamAction?u(e):3===e.EventStreamAction?c(e):5===e.EventStreamAction&&i(e))}function u(e){var t=Object.keys(p);"string"==typeof e.InvocationId&&""!==e.InvocationId&&(t=t.filter(function(t){return t===e.InvocationId}));var r=[];t.forEach(function(t){"object"==typeof p[t]&&(p[t].trackedServers=p[t].trackedServers.filter(function(t){var r=t.methodRequestSubject===e.MethodRequestSubject&&t.methodResponseSubject===e.MethodResponseSubject,n=t.streamId===e.StreamId&&(t.streamSubjects.global===e.EventStreamSubject||t.streamSubjects.private===e.EventStreamSubject),s=r||n;return!s}),0===p[t].trackedServers.length&&r.push(t))}),r.forEach(function(t){if("object"==typeof p[t]){if(p[t].status===v&&"number"==typeof p[t].timeoutId){var r="string"==typeof e.ResultMessage&&""!==e.ResultMessage?' Publisher said "'+e.ResultMessage+'".':" No reason given.",n="object"==typeof p[t].arguments?JSON.stringify(p[t].arguments):"{}";p[t].error(h+r+" Called with:"+n),clearTimeout(p[t].timeoutId)}else p[t].handlers.onClosed.forEach(function(r){"function"==typeof r&&r({message:S,requestArguments:p[t].arguments,server:helpers.convertInfoToInstance(e.Server),stream:p[t].method})});delete p[t]}})}function c(e){var n=e.InvocationId,s=p[n];if("object"==typeof s){var o=s.trackedServers.filter(function(t){return t.methodRequestSubject===e.MethodRequestSubject&&t.methodResponseSubject===e.MethodResponseSubject})[0];if("object"==typeof o){var a=s.status===v;s.status=l;var u=m(s.method.name);if("string"!=typeof o.streamId||""===o.streamId){o.server=helpers.convertInfoToInstance(e.Server),o.streamId=e.StreamId,o.streamSubjects.global=e.EventStreamSubject,o.streamSubjects.private=u;var c={EventStreamAction:3,EventStreamSubject:u,StreamId:e.StreamId,MethodRequestSubject:e.MethodRequestSubject,MethodResponseSubject:o.methodResponseSubject,Client:t.info(),Context:{ArgumentsJson:s.arguments,MethodName:s.method.name}};r(c),a&&s.success({onData:function(e){if("function"!=typeof e)throw new TypeError("The data callback must be a function.");this.handlers.onData.push(e),1===this.handlers.onData.length&&this.queued.data.length>0&&this.queued.data.forEach(function(t){e(t)})}.bind(s),onClosed:function(e){if("function"!=typeof e)throw new TypeError("The callback must be a function.");this.handlers.onClosed.push(e)}.bind(s),onFailed:function(){},close:d.bind(s,n),requestArguments:s.arguments,serverInstance:helpers.convertInfoToInstance(e.Server),stream:s.method})}}}}function i(e){for(var t in p)if(p.hasOwnProperty(t)&&"object"==typeof p[t]){var r,n=p[t].trackedServers.filter(function(t){return t.streamId===e.StreamId&&(t.streamSubjects.global===e.EventStreamSubject||t.streamSubjects.private===e.EventStreamSubject)});if(0===n.length?r=void 0:n[0].streamSubjects.global===e.EventStreamSubject?r=!1:n[0].streamSubjects.private===e.EventStreamSubject&&(r=!0),void 0!==r){var s={data:e.ResultContextJson,server:helpers.convertInfoToInstance(e.Server),requestArguments:p[t].arguments||{},message:e.ResultMessage,private:r},o=p[t].handlers.onData,a=p[t].queued.data;Array.isArray(o)&&(o.length>0?o.forEach(function(e){"function"==typeof e&&e(s)}):a.push(s))}}}function d(e){var s=n();this.trackedServers.forEach(function(e){r({EventStreamAction:2,Client:t.info(),MethodRequestSubject:e.methodRequestSubject,MethodResponseSubject:s,StreamId:e.streamId,EventStreamSubject:e.streamSubjects.private})});var o=this;this.handlers.onClosed.forEach(function(e){"function"==typeof e&&e({message:b,requestArguments:o.arguments||{},server:o.trackedServers[o.trackedServers.length-1].server,stream:o.method})}),delete p[e]}function m(e){var r=t.info(),n="ESSpriv-jsb_"+r.ApplicationName+"_on_"+e+"_"+random();return n}var v="awaitingAccept",l="subscribed",f="Subscription failed.",h="Subscription rejected.",S="ServerInitiated",b="ClientInitiated",p={};return{subscribe:s,processPublisherMsg:a}};
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./../../helpers/random":43,"./helpers":46}],45:[function(require,module,exports){
var random=require("./../../helpers/random"),callbackRegistry=require("callback-registry"),Streaming=require("./client-streaming"),helpers=require("./helpers");module.exports=function(e,t,n,r){"use strict";function i(){return"resp_"+h++ +"_"+random()}function o(e){return{machine:e.MachineName,pid:e.ProcessId,started:e.ProcessStartTime,user:e.UserName,application:e.ApplicationName,environment:e.Environment,region:e.Region,service_name:e.ServiceName,metrics_repository_id:e.MetricsRepositoryId,state:e.State}}function s(e){var t=e.Method;return{name:t.Name,accepts:t.InputSignature,returns:t.ResultSignature,requestSubject:e.MethodRequestSubject,description:t.Description,displayName:t.DisplayName,version:t.Version,objectTypes:t.ObjectTypeRestrictions,supportsStreaming:helpers.isStreamingFlagSet(t.Flags)}}function a(e){if(void 0!==e)return[e.application,e.user,e.machine,e.started,e.pid].join("/").toLowerCase()}function c(e,t){var n=e.Instance,i=o(n),s=a(i);t&&(s=r.addServer(i,s),e.PublishingInterval&&u(s,e.PublishingInterval)),void 0!==e.MethodDefinitions&&d(s,e.MethodDefinitions)}function u(e,t){if(t!==-1){var i=f[e];void 0!==i&&clearTimeout(i),f[e]=setTimeout(function(){r.removeServerById(e)},t*(n.client.remove_server_on_n_missing_heartbeats+1))}}function d(e,t){var n=r.getServerMethodsById(e);t=t.map(s).reduce(function(e,t){var n=r.getMethodId(t);return e[n]=t,e},{}),Object.keys(n).forEach(function(i){var o=n[i];void 0===t[o.id]?r.removeServerMethod(e,o.id):delete t[o.id]}),Object.keys(t).forEach(function(n){var i=t[n];r.addServerMethod(e,i)})}function v(n,r,o,s,a){var c=r.info,u={MethodRequestSubject:c.requestSubject,MethodResponseSubject:i(),Client:t.info(),Context:{ArgumentsJson:o,InvocationId:n,ObjectType:a.object_type,DisplayContext:a.display_context,MethodName:c.name,ExecutionServer:s.info,Timeout:a.method_response_timeout}};e.send("MethodInvocationRequestMessage",u)}function m(e){if(e&&e.EventStreamAction&&0!==e.EventStreamAction)return void S.processPublisherMsg(e);var t=e.Server?o(e.Server):void 0,n=e.ResultContextJson;n&&0===Object.keys(n).length&&(n=void 0),g.execute("onResult",e.InvocationId,t,e.Status,n,e.ResultMessage)}function l(e){g.add("onResult",e)}function p(){e.on("ServerPresenceMessage",function(e){c(e,!0)}),e.on("ServerHeartbeatMessage",function(e){c(e,!1)}),e.on("MethodInvocationResultMessage",m)}var f={},h=0,g=callbackRegistry(),S=new Streaming(n,t,function(t){e.send("MethodInvocationRequestMessage",t)},i);return p(),{invoke:v,onInvocationResult:l,subscribe:S.subscribe}};
},{"./../../helpers/random":43,"./client-streaming":44,"./helpers":46,"callback-registry":5}],46:[function(require,module,exports){
function convertInfoToInstance(e){"use strict";return"object"!=typeof e&&(e={}),{application:e.ApplicationName,environment:e.Environment,machine:e.MachineName,pid:e.ProcessId,region:e.Region,service:e.ServiceName,user:e.UserName,started:e.ProcessStartTime}}function isStreamingFlagSet(e){"use strict";if("number"!=typeof e||isNaN(e))return!1;var n=32,t=e&n;return t===n}module.exports={isStreamingFlagSet:isStreamingFlagSet,convertInfoToInstance:convertInfoToInstance};
},{}],47:[function(require,module,exports){
var ServerProtocol=require("./server.js"),ClientProtocol=require("./client.js"),Promise=require("es6-promise").Promise;module.exports=function(e,t,o,n,r){"use strict";t.on("Instance",e._updateIdentity);var s=new ServerProtocol(t,e,r,n),i=new ClientProtocol(t,e,r,o);return new Promise(function(e){e({invoke:i.invoke,onInvocationResult:i.onInvocationResult,register:s.register,unregister:s.unregister,onInvoked:s.onInvoked,methodInvocationResult:s.methodInvocationResult,subscribe:i.subscribe,createStream:s.createStream,getBranchList:s.getBranchList,getSubscriptionList:s.getSubscriptionList,closeAllSubscriptions:s.closeAllSubscriptions,closeSingleSubscription:s.closeSingleSubscription,pushData:s.pushData,pushDataToSingle:s.pushDataToSingle,onSubRequest:s.onSubRequest,acceptRequestOnBranch:s.acceptRequestOnBranch,rejectRequest:s.rejectRequest,onSubAdded:s.onSubAdded,onSubRemoved:s.onSubRemoved})})};
},{"./client.js":45,"./server.js":49,"es6-promise":8}],48:[function(require,module,exports){
var random=require("./../../helpers/random"),helpers=require("./helpers");module.exports=function(e,t){"use strict";function n(t){if("object"!=typeof t)throw new Error("Invalid message.");"number"!=typeof t.Status&&(t.Status=0),e.send("MethodInvocationResultMessage",t)}function r(e,t){return e&&e.EventStreamAction&&0!==e.EventStreamAction&&"object"==typeof t&&t.definition.supportsStreaming===!0}function o(e,t){e&&e.EventStreamAction&&0!==e.EventStreamAction&&(1===e.EventStreamAction?a(e,t):2===e.EventStreamAction?s(e,t):3===e.EventStreamAction?i(e,t):4===e.EventStreamAction&&u(e))}function a(e,t){var n={msg:e,arguments:e.Context.ArgumentsJson||{},instance:helpers.convertInfoToInstance(e.Client)};"function"==typeof A&&A(n,t)}function s(e,t){t&&Array.isArray(t.subscriptions)&&t.subscriptions.length>0&&b(t,e.StreamId,e.EventStreamSubject,!1)}function i(e,t){if("string"==typeof e.StreamId&&""!==e.StreamId){var n=m(t,e.StreamId);if("string"==typeof n&&Array.isArray(t.subscriptions)){var r={branchKey:n,instance:helpers.convertInfoToInstance(e.Client),arguments:e.Context.ArgumentsJson,streamId:e.StreamId,privateEventStreamSubject:e.EventStreamSubject,methodResponseSubject:e.MethodResponseSubject};t.subscriptions.push(r),"function"==typeof R&&R(r,t)}}}function u(){}function c(e,r,o){"string"!=typeof o&&(o="");var a=f(r,o),s=e.msg;n({EventStreamAction:3,EventStreamSubject:r.globalEventStreamSubject,InvocationId:s.Context.InvocationId,MethodName:r.method.Method.Name,MethodRequestSubject:r.method.MethodRequestSubject,MethodResponseSubject:s.MethodResponseSubject,MethodVersion:r.method.Method.Version,ResultMessage:"Accepted",Server:t.info(),StreamId:a})}function m(e,t){if("string"==typeof t&&"object"==typeof e){var n=e.branchKeyToStreamIdMap.filter(function(e){return e.streamId===t})[0];if("object"==typeof n&&"string"==typeof n.key)return n.key}}function f(e,t){"string"!=typeof t&&(t="");var n=e.branchKeyToStreamIdMap.filter(function(e){return e.key===t})[0],r=n?n.streamId:void 0;return"string"==typeof r&&""!==r||(r=S(e.method.Method.Name),e.branchKeyToStreamIdMap.push({key:t,streamId:r})),r}function S(e){var n=t.info(),r="streamId-jsb_of_"+e+"__by_"+n.ApplicationName+"_"+random();return r}function d(e,r,o){"string"!=typeof o&&(o="");var a=e.msg;n({EventStreamAction:2,EventStreamSubject:r.globalEventStreamSubject,MethodName:r.method.Method.Name,MethodRequestSubject:r.method.MethodRequestSubject,MethodResponseSubject:a.MethodResponseSubject,MethodVersion:r.method.Method.Version,ResultMessage:o,Server:t.info(),StreamId:"default_rejection_streamId"})}function b(e,r,o,a){var s=e.subscriptions.filter(function(e){return e.privateEventStreamSubject===o&&e.streamId===r})[0];if("object"==typeof s){var i=e.subscriptions.length;e.subscriptions=e.subscriptions.filter(function(e){return!(e.privateEventStreamSubject===s.privateEventStreamSubject&&e.streamId===s.streamId)});var u=e.subscriptions.length;if(u===i-1&&(a===!0&&n({EventStreamAction:2,EventStreamSubject:o,MethodName:e.method.Method.Name,MethodRequestSubject:e.method.MethodRequestSubject,MethodResponseSubject:s.methodResponseSubject,MethodVersion:e.method.Method.Version,ResponseContextJson:{},Server:t.info(),StreamId:s.streamId,Status:0}),"function"==typeof q)){var c=s.instance;q(c,e)}}}function p(e,r){if("object"==typeof e&&Array.isArray(e.branchKeyToStreamIdMap)){var o=e.branchKeyToStreamIdMap;"string"==typeof r&&(o=e.branchKeyToStreamIdMap.filter(function(e){return"object"==typeof e&&e.key===r})),o.forEach(function(r){var o=r.streamId;n({EventStreamAction:2,EventStreamSubject:e.globalEventStreamSubject,MethodName:e.method.Method.Name,MethodRequestSubject:e.method.MethodRequestSubject,Server:t.info(),StreamId:o,Status:0})})}}function h(e,t){b(e,t.streamId,t.privateEventStreamSubject,!0)}function v(e,r,o){if("object"!=typeof o)throw new Error("Invalid arguments. Data must be an object.");n({EventStreamAction:5,EventStreamSubject:r.privateEventStreamSubject,MethodName:e.method.Method.Name,MethodRequestSubject:e.method.MethodRequestSubject,ResultContextJson:o,Server:t.info(),StreamId:r.streamId})}function y(e,r,o){if("object"==typeof e&&Array.isArray(e.branchKeyToStreamIdMap)){if("object"!=typeof r)throw new Error("Invalid arguments. Data must be an object.");"string"==typeof o?o=[o]:(!Array.isArray(o)||o.length<=0)&&(o=null);var a=e.branchKeyToStreamIdMap.filter(function(e){return null===o||Boolean(e)&&"string"==typeof e.key&&o.indexOf(e.key)>=0}).map(function(e){return e.streamId});a.forEach(function(o){n({EventStreamAction:5,EventStreamSubject:e.globalEventStreamSubject,MethodName:e.method.Method.Name,MethodRequestSubject:e.method.MethodRequestSubject,ResultContextJson:r,Server:t.info(),StreamId:o})})}}function l(e,t){if("object"!=typeof e)return[];var n=[];return n="string"!=typeof t?e.subscriptions:e.subscriptions.filter(function(e){return e.branchKey===t})}function j(e){return"object"!=typeof e?[]:M(e)}function M(e){var t=e.subscriptions.map(function(e){var t=null;return"object"==typeof e&&"string"==typeof e.branchKey&&(t=e.branchKey),t}),n=[],r=t.filter(function(e){return!(null===e||n.indexOf(e)>=0)&&(n.push(e),!0)});return r}function I(e){"function"==typeof e&&(A=e)}function g(e){"function"==typeof e&&(R=e)}function E(e){"function"==typeof e&&(q=e)}var A=null,R=null,q=null;return{isStreamMsg:r,processSubscriberMsg:o,pushData:y,pushDataToSingle:v,closeAllSubscriptions:p,closeSingleSubscription:h,getSubscriptionList:l,getBranchList:j,onSubRequest:I,acceptRequestOnBranch:c,rejectRequest:d,onSubAdded:g,onSubRemoved:E,generateNewStreamId:S}};
},{"./../../helpers/random":43,"./helpers":46}],49:[function(require,module,exports){
var random=require("./../../helpers/random"),callbackRegistry=require("callback-registry"),Streaming=require("./server-streaming"),helpers=require("./helpers");module.exports=function(e,t,n,r){"use strict";function s(){return"req_"+R++ +"_"+random()}function o(){return{PublishingInterval:n.server.heartbeat_interval,Instance:t.info()}}function i(){var e=r.getList();return{PublishingInterval:n.server.presence_interval,Instance:t.info(),MethodDefinitions:e.map(function(e){return e.method})}}function a(){e.send("ServerPresenceMessage",i())}function u(){e.send("ServerHeartbeatMessage",o())}function c(e,t){return"string"==typeof e&&(e={name:e}),"number"!=typeof e.version&&(e.version=0),{Method:{Name:e.name,InputSignature:e.accepts,ResultSignature:e.returns,Description:e.description,DisplayName:e.displayName,Version:e.version,ObjectTypeRestrictions:e.objectTypes},MethodRequestSubject:t}}function d(e,t){var n=s();e.method=c(e.definition,n),v(),t()}function l(e,t,n){var r=s(),o=c(t,r);o.Method.Flags=32,e.method=o,e.globalEventStreamSubject=t.name+".jsStream."+random(),e.subscriptions=[],e.branchKeyToStreamIdMap=[],v(),n()}function v(){a(),void 0===g&&(g=setInterval(a,n.server.presence_interval))}function S(e){var t=e.MethodRequestSubject,n=r.getList(),s=n.filter(function(e){return e.method.MethodRequestSubject===t})[0];if(void 0!==s){if(I.isStreamMsg(e,s))return void I.processSubscriberMsg(e,s);var o=e.Context.InvocationId;f[o]=e;var i={args:e.Context.ArgumentsJson,instance:helpers.convertInfoToInstance(e.Client)};M.execute("onInvoked",s,o,i)}}function h(e){M.add("onInvoked",e)}function b(n,r,s,o){var i=f[r];if(i&&"null"!==i.MethodResponseSubject&&void 0!==n){var a={MethodRequestSubject:i.MethodRequestSubject,MethodResponseSubject:i.MethodResponseSubject,MethodName:n.method.Method.Name,InvocationId:r,ResultContextJson:o,Server:t.info(),ResultMessage:s,Status:s?1:0};e.send("MethodInvocationResultMessage",a),delete f[r]}}function p(){a()}var g,m,f={},R=0,M=callbackRegistry(),I=new Streaming(e,t);return e.on("MethodInvocationRequestMessage",S),void 0===m&&(m=setInterval(u,n.server.heartbeat_interval)),{register:d,onInvoked:h,methodInvocationResult:b,unregister:p,createStream:l,getBranchList:I.getBranchList,getSubscriptionList:I.getSubscriptionList,closeAllSubscriptions:I.closeAllSubscriptions,closeSingleSubscription:I.closeSingleSubscription,pushDataToSingle:I.pushDataToSingle,pushData:I.pushData,onSubRequest:I.onSubRequest,acceptRequestOnBranch:I.acceptRequestOnBranch,rejectRequest:I.rejectRequest,onSubAdded:I.onSubAdded,onSubRemoved:I.onSubRemoved}};
},{"./../../helpers/random":43,"./helpers":46,"./server-streaming":48,"callback-registry":5}],50:[function(require,module,exports){
module.exports=function(e,t,r,s,n){"use strict";function i(){var e=_;return _+=1,e}function o(e,r,s,o,c,f){if(0===s.length)return void f(g+" No available servers matched the target params.");n.debug("subscribe to target servers: ",s);var l=i(),v=a(l,e,r,c,f,o.method_response_timeout);return"object"!=typeof v?void f(g+" Unable to register the user callbacks."):void s.forEach(function(s){var n=s.server.id;v.trackedServers.push({serverId:n,subscriptionId:void 0});var i={type:b,server_id:n,method_id:e.info.id,arguments_kv:r};t.send(i,{serverId:n,subLocalKey:l}).then(d).catch(u)})}function a(e,t,r,s,n,i){return y[e]={status:p,method:t,arguments:r,success:s,error:n,trackedServers:[],handlers:{onData:[],onClosed:[]},queued:{data:[],closers:[]},timeoutId:void 0},y[e].timeoutId=setTimeout(function(){if(void 0!==y[e]){var s=y[e];s.status===p?(n({method:t,called_with:r,message:g+" Subscription attempt timed out after "+i+"ms."}),delete y[e]):s.status===h&&s.trackedServers.length>0&&(s.trackedServers=s.trackedServers.filter(function(e){return"undefined"!=typeof e.streamId}),delete s.timeoutId,s.trackedServers.length<=0&&(l(s),delete y[e]))}},i),y[e]}function u(e){n.debug("Subscription attempt failed",e);var t=e._tag,r=t.subLocalKey,s=y[r];if("object"==typeof s&&(s.trackedServers=s.trackedServers.filter(function(e){return e.serverId!==t.serverId}),s.trackedServers.length<=0)){if(clearTimeout(s.timeoutId),s.status===p){var i="string"==typeof e.reason&&""!==e.reason?' Publisher said "'+e.reason+'".':" No reason given.",o="object"==typeof s.arguments?JSON.stringify(s.arguments):"{}";s.error(m+i+" Called with:"+o)}else s.status===h&&l(s);delete y[r]}}function d(e){n.debug("handleSubscribed",e);var t=e._tag.subLocalKey,s=y[t];if("object"==typeof s){var i=e._tag.serverId,o=s.trackedServers.filter(function(e){return e.serverId===i})[0];if("object"==typeof o){o.subscriptionId=e.subscription_id,k[e.subscription_id]=t;var a=s.status===p;s.status=h,a&&s.success({onData:function(e){if("function"!=typeof e)throw new TypeError("The data callback must be a function.");this.handlers.onData.push(e),1===this.handlers.onData.length&&this.queued.data.length>0&&this.queued.data.forEach(function(t){e(t)})}.bind(s),onClosed:function(e){if("function"!=typeof e)throw new TypeError("The callback must be a function.");this.handlers.onClosed.push(e)}.bind(s),onFailed:function(){},close:v.bind(t),requestArguments:s.arguments,serverInstance:r.getServerById(i).getInfoForUser(),stream:s.method})}}}function c(e){function t(){return{data:e.data,server:r.getServerById(u).getInfoForUser(),requestArguments:i.arguments||{},message:null,private:a}}n.debug("handleEventData",e);var s=k[e.subscription_id];if("undefined"!=typeof s){var i=y[s];if("object"==typeof i){var o=i.trackedServers.filter(function(t){return t.subscriptionId===e.subscription_id});if(1===o.length){var a=e.oob&&e.snapshot,u=o[0].serverId,d=i.handlers.onData,c=i.queued.data;d.length>0?d.forEach(function(e){"function"==typeof e&&e(t())}):c.push(t())}}}}function f(e){n.debug("handleSubscriptionCancelled",e);var t=k[e.subscription_id];if("undefined"!=typeof t){var r=y[t];if("object"==typeof r){var s=r.trackedServers.length-1;r.trackedServers=r.trackedServers.filter(function(t){return t.subscriptionId!==e.subscription_id||(r.queued.closers.push(t.serverId),!1)}),r.trackedServers.length===s&&(r.trackedServers.length<=0&&(clearTimeout(r.timeoutId),l(r),delete y[t]),delete k[e.subscription_id])}}}function l(e,t){var s=e.queued.closers.length,n=s>0?e.queued.closers[s-1]:null,i=null;"number"==typeof n&&(i=r.getServerById(n).getInfoForUser()),e.handlers.onClosed.forEach(function(r){"function"==typeof r&&r({message:t||I,requestArguments:e.arguments,server:i,stream:e.method})})}function v(e){n.debug("closeSubscription",e);var r=y[e];"object"==typeof r&&(r.trackedServers.forEach(function(e){"undefined"!=typeof e.subscriptionId&&(t.sendFireAndForget({type:"unsubscribe",subscription_id:e.subscriptionId,reason_uri:"",reason:S}),delete k[e.subscriptionId])}),r.trackedServers=[],l(r,S),delete y[e])}t.on("subscribed",d),t.on("event",c),t.on("subscription-cancelled",f);var b="subscribe",p="awaitingAccept",h="subscribed",g="Subscription failed.",m="Subscription rejected.",I="ServerInitiated",S="ClientInitiated",y={},k={},_=0;return{subscribe:o}};
},{}],51:[function(require,module,exports){
var callbackRegistry=require("callback-registry"),Streaming=require("./client-streaming");module.exports=function(e,r,n,i,t){"use strict";function o(e){var r=e.new_peer_id,i=e.identity,t={machine:i.machine,pid:i.process,instance:i.instance,application:i.application,environment:i.environment,region:i.region,user:i.user};n.addServer(t,r)}function d(e){var r=e.removed_id,i=e.reason;n.removeServerById(r,i)}function a(e){var r=e.server_id,i=e.methods;i.forEach(function(e){var i={id:e.id,name:e.name,displayName:e.display_name,description:e.description,version:e.version,objectTypes:e.object_types,accepts:e.input_signature,returns:e.result_signature};n.addServerMethod(r,i)})}function s(e){var r=e.server_id,i=e.methods,t=n.getServerById(r),o=Object.keys(t.methods);o.forEach(function(e){var o=t.methods[e];i.indexOf(o.info.id)>-1&&n.removeServerMethod(r,e)})}function c(e,n,i,o){var d=o.id,a=n.info.id;t.debug("sending call ("+e+") for method id "+a+" to server "+d);var s={type:"call",server_id:d,method_id:a,arguments_kv:i};r.send(s,{invocationId:e,serverId:d}).then(u)}function v(e){m.add("onResult",e)}function u(e){t.debug("handle result message "+e);var r=e._tag.invocationId,i=e.result,o=e._tag.serverId,d=n.getServerById(o);m.execute("onResult",r,d.getInfoForUser(),0,i,"")}r.on("peer-added",o),r.on("peer-removed",d),r.on("methods-added",a),r.on("methods-removed",s);var m=callbackRegistry(),l=new Streaming(e,r,n,i,t);return{invoke:c,onInvocationResult:v,subscribe:l.subscribe}};
},{"./client-streaming":50,"callback-registry":5}],52:[function(require,module,exports){
var random=require("./../../helpers/random"),Promise=require("es6-promise").Promise,promisify=require("./../../helpers/promisify");module.exports=function(e,r){"use strict";function i(e){var i=e.request_id,n=c[i];n&&(r.error("error message "+JSON.stringify(e)),n.error(e))}function n(e){var r=e.request_id,i=c[r];i&&i.success(e)}function s(e){n(e)}function o(){return random()}function t(r,i,n,s){var t=o();r.request_id=r.request_id?r.request_id:t,r.peer_id=d;var u=new Promise(function(n,s){c[t]={success:function(e){delete c[t],e._tag=i,n(e)},error:function(e){delete c[t],e._tag=i,s(e)}},e.send("tick42-agm",r)});return promisify(u,n,s)}function u(r){r.request_id=r.request_id?r.request_id:o(),r.peer_id=d,e.send("tick42-agm",r)}var d=e.getPeerId();e.on("welcome",s),e.on("error",i),e.on("success",n),e.on("result",n),e.on("subscribed",n);var c={};return{send:t,sendFireAndForget:u,on:e.on,peerId:d}};
},{"./../../helpers/promisify":42,"./../../helpers/random":43,"es6-promise":8}],53:[function(require,module,exports){
var sessionFactory=require("./session"),serverFactory=require("./server"),clientFactory=require("./client"),connectionWrapperFactory=require("./conwrap"),Promise=require("es6-promise").Promise;module.exports=function(e,o,r,t,n){"use strict";var s=n.logger.subLogger("gw2-protocol");if(!o.getPeerId())throw new Error("Not logged in! Can not continue");var i=connectionWrapperFactory(o,s),c=sessionFactory(e,i,r,s.subLogger("session")),u=serverFactory(e,i,r,t,c,s.subLogger("server")),a=clientFactory(e,i,r,c,s.subLogger("client"));return new Promise(function(e,o){c.onConnected(function(r){return r?void o(r):void e({invoke:a.invoke,onInvocationResult:a.onInvocationResult,register:u.register,unregister:u.unregister,onInvoked:u.onInvoked,methodInvocationResult:u.methodInvocationResult,subscribe:a.subscribe,createStream:u.createStream,getBranchList:u.getBranchList,getSubscriptionList:u.getSubscriptionList,closeAllSubscriptions:u.closeAllSubscriptions,closeSingleSubscription:u.closeSingleSubscription,pushData:u.pushData,pushDataToSingle:u.pushDataToSingle,onSubRequest:u.onSubRequest,acceptRequestOnBranch:u.acceptRequestOnBranch,rejectRequest:u.rejectRequest,onSubAdded:u.onSubAdded,onSubRemoved:u.onSubRemoved})}),c.start()})};
},{"./client":51,"./conwrap":52,"./server":55,"./session":56,"es6-promise":8}],54:[function(require,module,exports){
var callbackRegistry=require("callback-registry");module.exports=function(e,t,r,i,n,s){"use strict";function o(){var e=A;return A+=1,e}function c(e){s.debug("server_AddInterest ",e);var t=r.getServerById(e.caller_id),n="function"==typeof t.getInfoForUser?t.getInfoForUser():null,o={msg:e,arguments:e.arguments_kv||{},instance:n},c=i.getById(e.method_id);return void 0===c?void u("No method with id "+e.method_id+" on this server.",e.subscription_id):c.subscriptionsMap&&c.subscriptionsMap[e.subscription_id]?void u("A subscription with id "+e.subscription_id+" already exists.",e.subscription_id):void j.execute(_,o,c)}function u(e,r){var i={type:"error",reason_uri:I,reason:e,request_id:r};t.sendFireAndForget(i)}function a(e,r,i){if(console.log("requestContext",e),"string"!=typeof i&&(i="",console.log("empty branch",i)),"object"!=typeof r.subscriptionsMap)throw new TypeError("The streaming method is missing its subscriptions.");if(!Array.isArray(r.branchKeyToStreamIdMap))throw new TypeError("The streaming method is missing its branches.");var n=p(r,i),s=e.msg.subscription_id,o={id:s,arguments:e.arguments,instance:e.instance,branchKey:i,streamId:n,subscribeMsg:e.msg};r.subscriptionsMap[s]=o,t.sendFireAndForget({type:"accepted",subscription_id:s,stream_id:n}),j.execute(M,o,r)}function p(e,t){"string"!=typeof t&&(t="");var r=e.branchKeyToStreamIdMap.filter(function(e){return e.key===t})[0],i=r?r.streamId:void 0;return"string"==typeof i&&""!==i||(i=o(),e.branchKeyToStreamIdMap.push({key:t,streamId:i})),i}function d(e,t,r){"string"!=typeof r&&(r=""),u("Subscription rejected by user. "+r,e.msg.subscription_id)}function b(e,t){j.add(e,t)}function f(e,r,i){if("object"==typeof e&&Array.isArray(e.branchKeyToStreamIdMap)){if("object"!=typeof r)throw new Error("Invalid arguments. Data must be an object.");"string"==typeof i?i=[i]:(!Array.isArray(i)||i.length<=0)&&(i=null);var n=e.branchKeyToStreamIdMap.filter(function(e){return null===i||Boolean(e)&&"string"==typeof e.key&&i.indexOf(e.key)>=0}).map(function(e){return e.streamId});n.forEach(function(e){t.sendFireAndForget({type:"publish",stream_id:e,data:r})})}}function y(e,r,i){if("object"!=typeof i)throw new Error("Invalid arguments. Data must be an object.");t.sendFireAndForget({type:"post",subscription_id:r.id,data:i})}function l(e,r){delete e.subscriptionsMap[r.id],t.sendFireAndForget({type:"drop-subscription",subscription_id:r.id,reason:"Server dropping a single subscription"});var i=r.instance;j.execute(S,i,e)}function g(e,r){if("object"==typeof e&&"object"==typeof e.subscriptionsMap){var i=Object.keys(e.subscriptionsMap).map(function(t){return e.subscriptionsMap[t]});"string"==typeof r&&(i=i.filter(function(e){return e.branchKey===r})),i.forEach(function(r){delete e.subscriptionsMap[r.id],t.sendFireAndForget({type:"drop-subscription",subscription_id:r.id,reason:"Server dropping all subscriptions on stream_id: "+r.streamId})})}}function m(e,t){if("object"!=typeof e)return[];var r=[],i=Object.keys(e.subscriptionsMap).map(function(t){return e.subscriptionsMap[t]});return r="string"!=typeof t?i:i.filter(function(e){return e.branchKey===t})}function h(e){if("object"!=typeof e)return[];var t=Object.keys(e.subscriptionsMap).map(function(t){return e.subscriptionsMap[t]}),r=t.map(function(e){var t=null;return"object"==typeof e&&"string"==typeof e.branchKey&&(t=e.branchKey),t}),i=[],n=r.filter(function(e){return!(null===e||i.indexOf(e)>=0)&&(i.push(e),!0)});return n}function v(e){s.debug("handleRemoveInterest",e);var t=i.getById(e.method_id);if("string"==typeof e.subscription_id&&"object"==typeof t&&"object"==typeof t.subscriptionsMap[e.subscription_id]){var r=t.subscriptionsMap[e.subscription_id].instance;delete t.subscriptionsMap[e.subscription_id],j.execute(S,r,t)}}t.on("add-interest",c),t.on("remove-interest",v);var _="onSubscriptionRequest",M="onSubscriptionAdded",S="onSubscriptionRemoved",I="com.tick42.agm.errors.subscription.failure",j=callbackRegistry(),A=0;return{pushData:f,pushDataToSingle:y,onSubRequest:b.bind(null,_),onSubAdded:b.bind(null,M),onSubRemoved:b.bind(null,S),acceptRequestOnBranch:a,rejectRequest:d,getSubscriptionList:m,getBranchList:h,closeSingleSubscription:l,closeMultipleSubscriptions:g}};
},{"callback-registry":5}],55:[function(require,module,exports){
var callbackRegistry=require("callback-registry"),Streaming=require("./server-streaming");module.exports=function(e,t,i,r,n,s){"use strict";function o(e){var t=e._tag.methodId,i=r.getById(t);i&&i.registrationCallbacks&&(s.debug("registered method "+i.definition.name+" with id "+t),i.registrationCallbacks.success())}function a(e){s.warn(e);var t=e._tag.methodId,i=r.getById(t);i&&i.registrationCallbacks&&(s.debug("failed to register method "+i.definition.name+" with id "+t),i.registrationCallbacks.fail())}function d(e){var t=e.invocation_id,n=e.peer_id,o=e.method_id,a=e.arguments_kv;s.debug('received invocation for method id "'+o+'"');var d=r.getList(),c=d.filter(function(e){return e._repoId===o})[0];if(void 0!==c){var u=i.getServerById(n),g={args:a,instance:u.getInfoForUser()};b.execute("onInvoked",c,t,g)}}function c(e,t,i,r){var n=!0;e.subscriptionsMap={},e.branchKeyToStreamIdMap=[],u(e,i,r,n)}function u(e,i,r,n){var d=e.definition;e.registrationCallbacks={success:i,fail:r};var c={};n===!0&&(c={supportsStreaming:!0}),s.debug('registering method "'+d.name+'"');var u={type:"register",methods:[{id:e._repoId,name:d.name,display_name:d.displayName,description:d.description,version:d.version,flags:c,object_types:d.objectTypes,input_signature:d.accepts,result_signature:d.returns,restrictions:void 0}]};t.send(u,{methodId:e._repoId}).then(o).catch(a)}function g(e){b.add("onInvoked",e)}function l(e,i,r,s){var o={type:"yield",invocation_id:i,peer_id:n.peerId(),result:s};t.sendFireAndForget(o)}function p(e){var i={type:"unregister",methods:[e._repoId]};t.send(i).then(v)}function v(e){var t=e.request_id;s.debug("unregistered by requestId "+t)}var b=callbackRegistry(),m=new Streaming(e,t,i,r,n,s);return t.on("invoke",d),{register:u,onInvoked:g,methodInvocationResult:l,unregister:p,createStream:c,getBranchList:m.getBranchList,getSubscriptionList:m.getSubscriptionList,closeAllSubscriptions:m.closeMultipleSubscriptions,closeSingleSubscription:m.closeSingleSubscription,pushData:m.pushData,pushDataToSingle:m.pushDataToSingle,onSubRequest:m.onSubRequest,acceptRequestOnBranch:m.acceptRequestOnBranch,rejectRequest:m.rejectRequest,onSubAdded:m.onSubAdded,onSubRemoved:m.onSubRemoved}};
},{"./server-streaming":54,"callback-registry":5}],56:[function(require,module,exports){
var callbackRegistry=require("callback-registry");module.exports=function(n,e,o,t){"use strict";function i(){t.debug("starting session ..."),t.debug('joining domain "'+s);var n={type:"join",domain:s};e.send(n).then(r)}function r(){f=!0,o.addServer(n,g),t.debug("joined to AGM domain!"),v.execute("onConnected")}function d(){t.debug("stopping session...");var n=["LEAVE",g,s];e.send(n)}function c(){f=!1,g=void 0}function a(n){return u()?void n():void v.add("onConnected",n)}function u(){return f}var s="com.tick42.agm";e.on("leave",c);var g=e.peerId,v=callbackRegistry(),f=!1;return{start:i,stop:d,connected:u,peerId:function(){return g},onConnected:a}};
},{"callback-registry":5}],57:[function(require,module,exports){
module.exports={"_args":[["tick42-agm@^3.2.0","C:\\work\\stash\\GLUE-dev\\js-glue"]],"_from":"tick42-agm@>=3.2.0 <4.0.0","_id":"tick42-agm@3.2.1","_inCache":true,"_installable":true,"_location":"/tick42-agm","_nodeVersion":"6.3.0","_npmUser":{},"_npmVersion":"3.8.5","_phantomChildren":{},"_requested":{"name":"tick42-agm","raw":"tick42-agm@^3.2.0","rawSpec":"^3.2.0","scope":null,"spec":">=3.2.0 <4.0.0","type":"range"},"_requiredBy":["/"],"_shasum":"8bbc835f300b81777591b455f04a3170ebb44182","_shrinkwrap":null,"_spec":"tick42-agm@^3.2.0","_where":"C:\\work\\stash\\GLUE-dev\\js-glue","author":{"name":"Tick42","url":"http://www.tick42.com"},"bin":{"build":"./bin/build.js","clean":"./bin/clean.js","file-versionify":"./bin/file-versionify.js","minify":"./bin/minify.js"},"bugs":{"url":"https://jira.tick42.com/browse/APPCTRL"},"dependencies":{"callback-registry":"^1.0.1","cuid":"^1.3.8","es6-promise":"^3.0.2","tick42-gateway-connection":"^2.0.0","util-deprecate":"^1.0.2"},"description":"JavaScript AGM","devDependencies":{"blanket":"^1.1.6","bluebird":"^2.9.30","browserify":"^13.0.0","browserify-replacify":"^0.0.4","browserify-versionify":"^1.0.4","eslint":"^3.1.1","eslint-config-standard":"^5.3.5","eslint-config-tick42":"^1.0.0","eslint-plugin-promise":"^2.0.0","eslint-plugin-standard":"^2.0.0","fs":"0.0.2","http-server":"^0.9.0","jsdom":"^8.1.0","minifyify":"^7.3.2","onchange":"^2.1.2","phantomjs":"^1.9.12","qunitjs":"^1.15.0","shelljs":"^0.6.0"},"dist":{"shasum":"8bbc835f300b81777591b455f04a3170ebb44182","tarball":"http://192.168.0.234:4873/tick42-agm/-/tick42-agm-3.2.1.tgz"},"gitHead":"b36517ac0a3bcb7a692be161bb2af4e48ee694af","keywords":["agm","javascript","library"],"main":"library/agm.js","name":"tick42-agm","optionalDependencies":{},"readme":"ERROR: No README data found!","scripts":{"build":"npm run eslint && node bin/clean.js && node bin/build.js && node bin/minify && node bin/file-versionify","eslint":"eslint library","eslint:fix":"eslint library --fix","prepublish":"npm update & npm run build","serve":"http-server -p 8000 -a 127.0.0.1","test":"npm run eslint && mocha --require ./test/test_helper \"test/**/*.js\"","watch":"onchange \"./library/**/*.js\" -iv -e \"./bin\" -- npm run build"},"title":"Tick42 AGM","version":"3.2.1"}
},{}],58:[function(require,module,exports){
(function (global){
var application=require("./application"),instance=require("./instance"),helpers=require("./helpers"),PackageJson=require("../package.json"),deprecate=require("util-deprecate");module.exports=global.app_manager=function(e,n){function a(e){"function"==typeof p&&p(helpers.vals(e))}function t(e){e.IsReady?d._trigger_app_event("available",e):d._trigger_app_event("unavailable",e)}function r(e){d._trigger_instance_event("error",e,e.Context.guid)}var i=application(e,function(){return o}),o=instance(e,i),d={applications:i.all,application:i.get_by_id,onAppAdded:helpers.add_callback("added").bind(i),onAppAvailable:helpers.add_callback("available").bind(i),onAppRemoved:helpers.add_callback("removed").bind(i),onAppUnavailable:helpers.add_callback("unavailable").bind(i),instances:o.all,onInstanceStarted:helpers.add_callback("started").bind(o),onInstanceStopped:helpers.add_callback("stopped").bind(o),onInstanceUpdated:helpers.add_callback("updated").bind(o),getBranches:function(n,a){e.invoke("T42.ACS.GetBranches",{},"best",{},function(e){n&&n(helpers.vals(e.returned.Branches))},a)},getCurrentBranch:function(n,a){e.invoke("T42.ACS.GetCurrentBranch",{},"best",{},function(e){n&&n(e.returned.Branch)},a)},setCurrentBranch:function(n,a,t){e.invoke("T42.ACS.SetCurrentBranch",{Branch:n},"best",{},a,t)},currentUser:function(n,a){e.invoke("T42.ACS.GetUser",{},"best",{},n,a)},getFunctionalEntitlement:function(n,a,t){e.invoke("T42.ACS.GetFunctionalEntitlement",{Function:n},"best",{},function(e){a&&a(e.returned.Entitlement)},t)},getFunctionalEntitlementBranch:function(n,a,t,r){e.invoke("T42.ACS.GetFunctionalEntitlement",{Function:n,Branch:a},"best",{},function(e){t&&t(e.returned.Entitlement)},r)},canI:function(n,a,t){e.invoke("T42.ACS.CanI",{Function:n},"best",{},a,t)},canIBranch:function(n,a,t,r){e.invoke("T42.ACS.CanI",{Function:n,Branch:a},"best",{},t,r)},exit:function(){e.invoke("T42.ACS.Shutdown",{},"all",{},function(e){console.log(e)},function(e){console.log(e)})},setRegion:function(n,a,t){e.invoke("T42.ACS.SetConfigurationRegion",{Region:n},"best",{},a,t)},getRegion:function(n,a){e.invoke("T42.ACS.GetConfigurationRegion",{},"best",{},function(e){n&&n(e.returned.Region)},a)},_trigger_app_event:i._trigger,_trigger_instance_event:o._trigger};d.onInstanceStarted(function(e){function a(e){var n=e.returned[Object.keys(e.returned)[0]],a=glue.windows._from_event(n.windowName,t,n.url,n.windowId,n.windowStyleAttributes,n.windowTitle);d._trigger_instance_event("windowAdded",a,r)}if(e.application){d._trigger_app_event("instanceStarted",e,e.application.name);var t;if(n&&glue){var r=e.context&&e.context.guid?e.context.guid:e.id;t=e.application.configuration.container,null!==t&&""!==t&&glue.agm.invoke("T42.Wnd.FindById",{windowId:e.id},{application:t},{},a,function(e){console.log(e)})}}}),d.onInstanceStopped(function(e){if(e.application){d._trigger_app_event("instanceStopped",e,e.application.name);var n=e.context&&e.context.guid?e.context.guid:e.id;d._trigger_instance_event("windowRemoved",{},n)}}),d.onInstanceUpdated(function(e){e.application}),d.onAppRemoved(function(e){e.instances.forEach(function(e){var n=e.context&&e.context.guid?e.context.guid:e.id;d._trigger_instance_event("stopped",{},n)})});var p;if(d.onBranchesChanged=function(e){p=e},d.can_i=deprecate(d.canI,"appManager.can_i is deprecated and might be removed from future versions of glue. Use appManager.canI() instead"),d.can_i_branch=deprecate(d.canIbranch,"appManager.can_i_branch is deprecated and might be removed from future versions of glue. Use appManager.canIbranch() instead"),d.current_user=deprecate(d.currentUser,"appManager.current_user is deprecated and might be removed from future versions of glue. Use appManager.currentUser() instead"),d.set_current_branch=deprecate(d.setCurrentBranch,"appManager.set_current_branch is deprecated and might be removed from future versions of glue. Use appManager.setCurrentBranch() instead"),d.get_current_branch=deprecate(d.getCurrentBranch,"appManager.get_current_branch is deprecated and might be removed from future versions of glue. Use appManager.getCurrentBranch() instead"),d.get_branches=deprecate(d.getBranches,"appManager.get_branches is deprecated and might be removed from future versions of glue. Use appManager.getBranches() instead"),d.get_functional_entitlement_branch=deprecate(d.getFunctionalEntitlementBranch,"appManager.get_functional_entitlement_branch is deprecated and might be removed from future versions of glue. Use appManager.getFunctionalEntitlementBranch() instead"),d.get_functional_entitlement=deprecate(d.getFunctionalEntitlement,"appManager.get_functional_entitlement is deprecated and might be removed from future versions of glue. Use appManager.getFunctionalEntitlement() instead"),d.get_region=deprecate(d.getRegion,"appManager.get_region is deprecated and might be removed from future versions of glue. Use appManager.getRegion() instead"),d.set_region=deprecate(d.setRegion,"appManager.set_region is deprecated and might be removed from future versions of glue. Use appManager.setRegion() instead"),d.on_app_unavailable=deprecate(d.onAppUnavailable,"appManager.on_app_unavailable is deprecated and might be removed from future versions of glue. Use appManager.onAppUnavailable() instead"),d.on_app_removed=deprecate(d.onAppRemoved,"appManager.on_app_removed is deprecated and might be removed from future versions of glue. Use appManager.onAppRemoved() instead"),d.on_app_added=deprecate(d.onAppAdded,"appManager.on_app_added is deprecated and might be removed from future versions of glue. Use appManager.onAppAdded() instead"),d.on_app_available=deprecate(d.onAppAvailable,"appManager.on_app_available is deprecated and might be removed from future versions of glue. Use appManager.onAppAvailable() instead"),d.on_branches_changed=deprecate(d.onBranchesChanged,"appManager.on_branches_changed  is deprecated and might be removed from future versions of glue. Use appManager.onBranchesChanged() instead"),d.on_instance_started=deprecate(d.onInstanceStarted,"appManager.on_instance_started is deprecated and might be removed from future versions of glue. Use appManager.onInstanceStarted() instead"),d.on_instance_stopped=deprecate(d.onInstanceStopped,"appManager.on_instance_stopped is deprecated and might be removed from future versions of glue. Use appManager.onInstanceStopped() instead"),d.on_instance_updated=deprecate(d.onInstanceUpdated,"appManager.on_instance_updated is deprecated and might be removed from future versions of glue. Use appManager.onInstanceUpdated() instead"),e&&e.subscribe){d.agm=e;var c=[{event:"OnApplicationAdded",trigger:"added",on:i},{event:"OnApplicationRemoved",trigger:"removed",on:i},{event:"OnApplicationChanged",trigger:"changed",on:i},{event:"OnApplicationStarted",trigger:"started",on:o},{event:"OnApplicationStopped",trigger:"stopped",on:o},{event:"OnApplicationUpdated",trigger:"updated",on:o},{event:"OnApplicationAgmServerReady",trigger:"agmReady",on:o},{event:"OnApplicationReady",func:t},{event:"OnBranchesModified",func:a},{event:"OnApplicationStartFailed",raw_func:r}];e.serverMethodAdded(function(n){n.server.application.indexOf("AppManager")!==-1&&n.method.name.indexOf("T42.ACS.OnEvent")!==-1&&e.subscribe("T42.ACS.OnEvent",{target:"all"}).then(function(e){e.onData(function(e){var n=e.data;c.forEach(function(e){var a=n[e.event];if(a){if(void 0!==e.raw_func)return void e.raw_func(a);helpers.vals(a).forEach(function(n){void 0!==e.on?e.on._trigger(e.trigger,n):e.func(n)})}})})})})}return d.version=PackageJson.version,d},global.tick42=global.tick42||{},global.tick42.app_manager=global.app_manager;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../package.json":63,"./application":59,"./helpers":61,"./instance":62,"util-deprecate":106}],59:[function(require,module,exports){
var event_manager=require("./event_manager"),helpers=require("./helpers"),deprecate=require("util-deprecate");module.exports=function(e,a){function n(e,a){return a.name=e.Name,a.title=e.Title,a.version=e.Version,a.instances=[],a.configuration={},a.configuration.auto_start=e.AutoStart,a.configuration.caption=e.Caption,a.configuration.hidden=e.IsHidden,a.configuration.container=e.ApplicationName,a.configuration.activityType=e.ActivityType,a.configuration.allow_multiple=e.AllowMultiple,a.available=e.IsReady||!1,a.icon=e.Icon,a.sortOrder=e.SortOrder,a.userProperties=e.UserProperties,a}var t=helpers.add_callbacks({start:function(n,t,i){return n=n||{},n.guid=n.guid||Math.floor(1e7*Math.random()),e&&e.invoke("T42.ACS.StartApplication",{Name:this.name,Context:n},"best",{},function(e){},i),a()._trigger("create",{Context:n})}},["Added","Removed","Available","Unavailable","InstanceStarted","InstanceStopped","Changed"],"on");t.on_added=deprecate(t.onAdded,"application.on_added is deprecated and might be removed from future versions of glue. Use application.onAdded() instead"),t.on_removed=deprecate(t.onRemoved,"application.on_removed is deprecated and might be removed from future versions of glue. Use application.onRemoved() instead"),t.on_available=deprecate(t.onAvailable,"application.on_available is deprecated and might be removed from future versions of glue. Use application.onAvailable() instead"),t.on_unavailable=deprecate(t.onUnavailable,"application.on_unavailable is deprecated and might be removed from future versions of glue. Use application.onUnavailable() instead"),t.on_instance_started=deprecate(t.onInstanceStarted,"application.on_instance_started is deprecated and might be removed from future versions of glue. Use application.onInstanceStarted() instead"),t.on_instance_stopped=deprecate(t.onInstanceStopped,"application.on_instance_stopped is deprecated and might be removed from future versions of glue. Use application.onInstanceStopped() instead"),t.on_changed=deprecate(t.onChanged,"application.on_changed is deprecated and might be removed from future versions of glue. Use application.onChanged() instead");var i={create:function(e){return n(e,Object.create(t))},update:n,init_event:"added",exit_event:"removed",id_field:"Name",callbacks:{available:function(){this.available=!0},changed:function(e){this.icon=e.Icon,this.title=e.Title,this.configuration.caption=e.Caption},unavailable:function(){this.available=!1},instanceStarted:function(e){this.instances.push(e)},instanceStopped:function(e){this.instances=this.instances.filter(function(a){return a!==e})}}};return i.callbacks.instance_started=deprecate(i.callbacks.instanceStarted,"application.instance_started is deprecated and might be removed from future versions of glue. Use application.instanceStarted() instead"),i.callbacks.instance_stopped=deprecate(i.callbacks.instanceStopped,"application.instance_stopped is deprecated and might be removed from future versions of glue. Use application.instanceStopped() instead"),event_manager(i)};
},{"./event_manager":60,"./helpers":61,"util-deprecate":106}],60:[function(require,module,exports){
function exec_callbacks(e,t,c){void 0!==t&&t.forEach(function(t){t.call(e,c)})}function init_object(e){return e.callbacks={},e.active=!1,e}var helpers=require("./helpers");module.exports=function(e){var t={},c={};return{all:function(){return helpers.vals(t)},get_by_id:function(e){return t[e]},_trigger:function(i,a,l){if(l=l||("function"==typeof e.id_field?e.id_field(a):a[e.id_field]),void 0!==t[l]||i===e.init_event||i===e.create_event){var n=t[l]=t[l]||init_object(e.create(a));if(i===e.init_event){if(n.active)return;n.active=!0,e.update(a,n)}else if(i===e.exit_event)n.active=!1;else{if(i===e.create_event)return n;i===e.update_event&&e.update(a,n)}void 0!==e.callbacks[i]&&e.callbacks[i].call(n,a);try{exec_callbacks(void 0,c[i],n),exec_callbacks(n,n.callbacks[i],a)}catch(e){console.error(e)}return i===e.exit_event&&(n.callbacks={}),n}},callbacks:c}};
},{"./helpers":61}],61:[function(require,module,exports){
function noop(){}function exec_if(n){return function(e,t){n(e)&&t.call(e)}}exports.add_callbacks=function(n,e,t){return e.forEach(function(e){"string"==typeof e&&(e={name:e,trigger_when:noop}),n[t+e.name]=exports.add_callback(e.name,exec_if(e.trigger_when))}),n},exports.add_callback=function(n,e){return function(t){var c=this.callbacks;return"undefined"!=typeof n&&(n=n.charAt(0).toLowerCase()+n.slice(1)),void 0===c[n]?c[n]=[t]:c[n].push(t),"function"==typeof e&&e(this,t),this}},exports.vals=function(n){return Object.keys(n).reduce(function(e,t){return e.push(n[t]),e},[])};
},{}],62:[function(require,module,exports){
function convert_agm_instance(e){return{machine:e.machineName,user:e.userName,environment:e.environment,application:e.applicationName}}var event_manager=require("./event_manager"),helpers=require("./helpers"),deprecate=require("util-deprecate");module.exports=function(e,n){function t(e,t){return t.id=e.Id,t.application=n.get_by_id(e.Name),t.context=e.Context,t.title=e.Title,t.activityId=e.ActivityId,t}var i=helpers.add_callbacks({stop:function(n,t,i){e.invoke("T42.ACS.StopApplication",{Name:this.application.name,Id:this.id},"best",{},function(e){console.log(e)},i)},activate:function(n,t,i){e.invoke("T42.ACS.ActivateApplication",{Name:this.application.name,Id:this.id},"best",{},function(e){console.log(e)},i)}},[{name:"WindowAdded",trigger_when:function(e){return e.active&&void 0!==e.main_window}},{name:"WindowRemoved",trigger_when:function(e){return void 0===e.main_window}},{name:"Started",trigger_when:function(e){return void 0!==e.id&&e.active}},{name:"Stopped",trigger_when:function(e){return void 0!==e.id&&!e.active}},{name:"AgmReady",trigger_when:function(e){return e.active&&void 0!==e.agm}},{name:"Error",trigger_when:function(e){return void 0!==e.error}}],"on");i.on_window_added=deprecate(i.onWindowAdded,"instance.on_window_added is deprecated and might be removed from future versions of glue. Use instance.onWindowAdded() instead"),i.on_window_removed=deprecate(i.onWindowRemoved,"instance.on_window_removed is deprecated and might be removed from future versions of glue. Use instance.onWindowRemoved() instead"),i.on_started=deprecate(i.onStarted,"instance.on_started is deprecated and might be removed from future versions of glue. Use instance.onStarted() instead"),i.on_stopped=deprecate(i.onStopped,"instance.on_stopped is deprecated and might be removed from future versions of glue. Use instance.onStopped() instead"),i.on_agm_ready=deprecate(i.onAgmReady,"instance.on_agm_ready is deprecated and might be removed from future versions of glue. Use instance.onAgmReady() instead"),i.on_error=deprecate(i.onError,"instance.on_error is deprecated and might be removed from future versions of glue. Use instance.onError() instead");var d={create:function(e){return t(e,Object.create(i))},update:t,create_event:"create",init_event:"started",exit_event:"stopped",update_event:"updated",id_field:function(e){return void 0!==e.Context&&void 0!==e.Context.guid?e.Context.guid:e.Id},callbacks:{agmReady:function(e){var n=Object.keys(e.AgmServers)[0];this.agm=convert_agm_instance(e.AgmServers[n])},error:function(e){this.error=e},windowAdded:function(e){this.main_window=e,this.windows=this.windows||[],this.windows.push(e)},windowRemoved:function(){this.main_window=void 0,this.windows=[]}}};return d.callbacks.agm_ready=deprecate(d.callbacks.agmReady,"instance.agm_ready is deprecated and might be removed from future versions of glue. Use instance.agmReady() instead"),d.callbacks.window_added=deprecate(d.callbacks.windowAdded,"instance.window_added is deprecated and might be removed from future versions of glue. Use instance.windowAdded() instead"),d.callbacks.window_removed=deprecate(d.callbacks.windowRemoved,"instance.window_removed is deprecated and might be removed from future versions of glue. Use instance.windowRemoved() instead"),event_manager(d)};
},{"./event_manager":60,"./helpers":61,"util-deprecate":106}],63:[function(require,module,exports){
module.exports={"_args":[["tick42-app-manager@2.5.0","C:\\work\\stash\\GLUE-dev\\js-glue"]],"_from":"tick42-app-manager@2.5.0","_id":"tick42-app-manager@2.5.0","_inCache":true,"_installable":true,"_location":"/tick42-app-manager","_nodeVersion":"6.3.0","_npmUser":{},"_npmVersion":"3.8.5","_phantomChildren":{},"_requested":{"name":"tick42-app-manager","raw":"tick42-app-manager@2.5.0","rawSpec":"2.5.0","scope":null,"spec":"2.5.0","type":"version"},"_requiredBy":["/"],"_shasum":"db0206f1a681ab28fca166aca2725e1184fe6934","_shrinkwrap":null,"_spec":"tick42-app-manager@2.5.0","_where":"C:\\work\\stash\\GLUE-dev\\js-glue","author":{"name":"Tick42","url":"http://www.tick42.com"},"dependencies":{},"description":"App Manager API for JavaScript","devDependencies":{"blanket":"^1.1.6","bootstrap":"^3.3.4","browserify-versionify":"^1.0.4","grunt":"^0.4.5","grunt-browserify":"^3.3.0","grunt-cli":"^0.1.0","grunt-contrib-clean":"^0.6.0","grunt-contrib-connect":"^0.9.0","grunt-contrib-jshint":"^0.11.0","grunt-contrib-qunit":"^0.5.2","grunt-contrib-uglify":"^0.6.0","grunt-contrib-watch":"^0.6.1","grunt-exorcise":"^1.0.0","http-server":"^0.8.0","jquery":"^2.1.4","lodash":"^3.9.3","phantomjs":"^1.9.12","qunitjs":"^1.15.0","tick42-agm":"^1.3.0","uglifyify":"^3.0.1"},"directories":{"example":"examples"},"dist":{"shasum":"db0206f1a681ab28fca166aca2725e1184fe6934","tarball":"http://192.168.0.234:4873/tick42-app-manager/-/tick42-app-manager-2.5.0.tgz"},"gitHead":"ccfc9d9b58fe171da36d2633729ad75ad4681b30","license":"ISC","main":"library/app_manager.js","name":"tick42-app-manager","optionalDependencies":{},"readme":"ERROR: No README data found!","repository":{"type":"git","url":"https://ibaltadzhieva@stash.tick42.com/scm/ofgw/js-app-manager.git"},"scripts":{"prepublish":"grunt","test":"echo \"Error: no test specified\" && exit 1"},"version":"2.5.0"}
},{}],64:[function(require,module,exports){
var _=require("./util"),Model=require("./model"),helpers=require("./helpers"),events={connect:"connect",disconnect:"disconnect",update:"update",status:"status"},EventBus=function(){"use strict";var e,n=function(n,t,i,o){if(_.isFunction(i)){var c={type:n,once:t,callback:i,scope:o},u=e[n];return"undefined"==typeof u&&(u=e[n]=[]),c.id=u.push(c)-1,c}},t=function(){var n=[].slice.call(arguments),t=n.splice(0,1)[0],o=e[t];"undefined"==typeof o&&(o=e[t]=[]),o.forEach(function(e){if(e){try{e.callback.apply(e.scope,n)}catch(t){_.warn("Exception during execution of callback",e,n,t)}e.once&&i(e)}})},i=function(n){var t=e[n.type];"undefined"!=typeof t&&delete t[n.id]},o=function(t){if("undefined"==typeof t.id)return n(t.type,t.once,t.callback,t.scope);var i=e[t.type];return"undefined"==typeof i&&(i=e[t.type]=[]),i[t.id]=t,t},c=function(){"undefined"!=typeof e&&Object.keys(e).forEach(function(n){var t=e[n];"undefined"!=typeof t&&t.forEach(function(e){delete e.id})}),e={}};return c(),{on:n,emit:t,off:i,resume:o,reset:c}},AppConfig=function(){"use strict";var e,n,t,i,o=!0,c=new EventBus,u=new Model(c),r=require("./props")(u.root),f=this,a=function(){"undefined"!=typeof i&&clearInterval(i)};f.init=function(e){e=e||{};var t="object"==typeof e.identity&&Object.keys(e.identity).length>0;if(t&&(f.identity=e.identity),o=e.defaultListen||o,!f.identity)throw new TypeError("identity must be non empty object.");u.separator=e.defaultSeparator||u.separator,f.schema=e.schema||f.schema||"ApplicationConfiguration",n=_.isFunction(e.gateway)?e.gateway:function(){return"undefined"==typeof e.gateway&&(e.gateway={}),"undefined"==typeof e.gateway.instance&&(e.gateway.instance=_.uuid()),require("./gateway")(e.gateway)}},f.connect=function(r,s,d){a();var p;arguments.length>0&&(_.isFunction(r)&&(s=r,d=s,r=o),p=c.on(events.connect,!0,s,d));var y;if(f.identity)if(e||(e=n()),r){var l=!1;t=e.connect(f.schema,f.identity,!0,function(e,n,t){"undefined"!=typeof n&&u.applySnapshot(n),"undefined"!=typeof t&&u.applyUpdates(t),l||(l=!0,c.emit(events.connect,e))},function(n,o){var c=8;o.code===c&&(i=setInterval(function(){e.disconnect(t),t=e.connect(f.schema,f.identity,!1,function(e,n){u.applySnapshot(n,!1)})},2e3))})}else t=e.connect(f.schema,f.identity,!1,function(e,n){"undefined"==typeof e&&u.applySnapshot(n),c.emit(events.connect,e)},function(e,n){c.emit(events.status,e,n)});else y="identity is not specified. did you forget to call init()?";if(y)throw setTimeout(c.emit,0,events.connect,y),new Error(y);return p},f.props=function(e,n){return r.props(e,n)},f.modify=function(e,n,t){"object"==typeof e&&(e=[e]);var i=c.on(events.update,!0,n,t);return i},f.onConnect=function(e,n){return c.on(events.connect,!1,e,n)},f.onDisconnect=function(e,n){return c.on(events.disconnect,!1,e,n)},f.off=function(e){e&&c.off(e)},f.on=function(e){e&&c.resume(e)},f.disconnect=function(n,i){_.isFunction(n)&&c.on(events.disconnect,!0,n,i),a(),"undefined"!=typeof e?(e.disconnect(t,function(e){c.emit(events.disconnect,e)}),e=void 0):c.emit(events.disconnect,"not connected")}};AppConfig.prototype.identityEqual=helpers.identityEqual,AppConfig.prototype.identityToString=helpers.identityToString,module.exports=function(){"use strict";return new AppConfig};
},{"./gateway":65,"./helpers":66,"./model":67,"./props":68,"./util":69}],65:[function(require,module,exports){
var gatewayConnection=require("tick42-gateway-connection"),helpers=require("./helpers"),identityToString=helpers.identityToString,PRODUCT="appconfig",GatewayTransport=function(e){"use strict";function n(e){var n=s[e.instance];n&&n(e.error,e.status)}function t(e){var n=e.schema,t=o[n];if("undefined"!=typeof t){var i=identityToString(e.identity,!0),a=t[i];"undefined"!=typeof a&&a.forEach(function(n){n&&n(e.error,e.snapshot,e.updates)})}}function i(){"undefined"==typeof a&&(a="undefined"!=typeof e.connection?e.connection:gatewayConnection(e.settings,e.custom_connection))}var a,o={},s={};e=e||{};var r,d,c=function(c,f,y,p,u){i();var T=o[c];"undefined"==typeof T&&(T=o[c]={});var g=identityToString(f,!0),h=T[g];"undefined"==typeof h&&(h=T[g]=[]);var l,v;l=y?p:function(e,n,t){p(e,n,t),delete h[v]},v=h.push(l)-1,"undefined"==typeof r&&(r=a.on(PRODUCT,GatewayTransport.MessageType.DATA,function(e){t(e)}));var C=e.instance;s[C]=u,"undefined"==typeof d&&(d=a.on(PRODUCT,GatewayTransport.MessageType.STATUS,function(e){n(e)}));var O={schema:c,identity:f,instance:C,listen:y};return a.send(PRODUCT,GatewayTransport.MessageType.CONNECT,O),{schema:c,identity:f,listen:y,handler:p,index:v}},f=function(e,n,t){i(),a.send(PRODUCT,GatewayTransport.MessageType.MODIFY,t)},y=function(n){var t=o[n.schema];if("undefined"!=typeof t){var i=identityToString(n.identity,!0),c=t[i];if("undefined"!=typeof c){var f=c[n.index];if("undefined"!=typeof f){var y={schema:n.schema,identity:n.identity,instance:e.instance};a.send(GatewayTransport.MessageType.DISCONNECT,y),delete c[n.index]}0===c.length&&delete t[i]}0===Object.keys(t).length&&delete o[n.schema]}0===Object.keys(o).length&&"undefined"!=typeof r&&a.off(r),delete s[n.instance],0===Object.keys(s).length&&"undefined"!=typeof d&&a.off(d)};return{connect:c,modify:f,disconnect:y}};GatewayTransport.MessageType={CONNECT:"connect",DISCONNECT:"disconnect",MODIFY:"modify",DATA:"data",STATUS:"status"},module.exports=GatewayTransport;
},{"./helpers":66,"tick42-gateway-connection":75}],66:[function(require,module,exports){
function escapeIdentityText(t){"use strict";return"string"==typeof t?t.replace(/[\\]/g,"\\\\").replace(/[:]/g,"\\:"):t}function identityToString(t,e,n,i){"use strict";if("undefined"==typeof t)return null;n=n||"/";var r=Object.keys(t);return"function"==typeof i?r.sort(i):r.sort(),r.map(function(n){return e?escapeIdentityText(n)+":"+escapeIdentityText(t[n]):t[n]}).join(n)}function identityEqual(t,e){"use strict";return identityToString(t,!0)===identityToString(e,!0)}function flatten(t,e,n){"use strict";e=e||".";var i=n?n+e:"",r={};return Object.keys(t).forEach(function(n){if(0===n.indexOf(i)){var u,a=n.substring(i.length),l=r,o=a.split(e);for(u=0;u<o.length-1;u++)l[o[u]]||(l[o[u]]={}),l=l[o[u]];l[o[u]]=t[n].value}}),r}function propEqual(t,e){"use strict";if(t.value!==e.value)return!1;for(var n=0;n<t.underlying.length;n++){var i=t.underlying[n],r=e.underlying[n]||{};if(i.value!==r.value||!identityEqual(i.parent,r.parent))return!1}return!0}module.exports={flatten:flatten,propEqual:propEqual,identityToString:identityToString,identityEqual:identityEqual};
},{}],67:[function(require,module,exports){
function updateTypeForPath(e){"use strict";var t="update";return""!==e&&(t=t+"|"+e),t}function cloneUpdateForPath(e,t){"use strict";var o={type:e.type,name:e.name.substring(t.length)};switch(e.type){case UpdateType.Changed:o.oldValue=e.oldValue,o.value=e.value;break;case UpdateType.Added:o.value=e.value;break;case UpdateType.Removed:}return o}function applyUpdatesAndEmitEvents(e,t,o){"use strict";var p=Object.keys(e.views),a={"":t};p.length>0&&(p.length>1&&p.sort(),t.forEach(function(e){for(var t,o=0;o<p.length;p++)if(0===e.name.indexOf(p[o])){t=p[o];break}"undefined"!=typeof t&&a[t].push(cloneUpdateForPath(e,t))}));var r=Object.keys(a);r.length>1&&r.sort(),r.forEach(function(t){var p=""===t?e.root:e.views[t].model;o&&(p.props={}),a[t].forEach(function(e){switch(e.type){case UpdateType.Added:case UpdateType.Changed:p.props[e.name]=e.value;break;case UpdateType.Removed:delete p.props[e.name]}})}),r.forEach(function(p){var a=updateTypeForPath(p);e.bus.emit(a,o,t)})}function toUpdates(e,t){"use strict";t=t||{};var o=[],p=Object.keys(e);return Object.keys(t).forEach(function(a){var r={};if("undefined"==typeof e[a])r.type=UpdateType.Added;else{propEqual(e[a],t[a])||(r.type=UpdateType.Changed,r.oldValue=e[a]);var s;for(s=0;s<p.length&&p[s]!==a;p++);"undefined"!=typeof p[s]&&p.splice(s,1)}r.type&&(r.value=t[a],r.name=a,o.push(r))}),p.forEach(function(e){o.push({type:UpdateType.Removed,name:e})}),o}var propEqual=require("./helpers").propEqual,UpdateType={Added:"Added",Changed:"Changed",Removed:"Removed"},Model=function(e,t){"use strict";this.bus=e,this.root=new ViewModel(this,"",t||"."),this.views={}},ViewModel=function(e,t,o){"use strict";var p=this;p.model=e,p.props={},p.separator=o||e.separator,p.path=t};ViewModel.prototype.getViewModel=function(e,t){"use strict";var o=this.path+e+(t?t:"."),p=this.model;if(""===o)return p.root;if(!p.views[o]){var a="";Object.keys(p.views).forEach(function(e){if(0===o.indexOf(e)){a.length<e.length&&(a=e);for(var t=p.views[e].subviews,r=0;r<t.length;r++)if(t[r].indexOf(o))return void t.splice(r,0,o);t.push(o)}});var r=new ViewModel(p,o,t),s=""===a?p.root.props:p.views[a].model.props;Object.keys(s).forEach(function(e){var t=s[e];if(0===t.name.indexOf(o)){var p=t.name.substring(o.length);r.props[p]=t}}),p.views[o]={subviews:[],model:r}}return p.views[o].model},ViewModel.prototype.on=function(e,t){"use strict";return this.model.on(this.path,e,t)},Model.prototype.on=function(e,t,o){"use strict";var p=updateTypeForPath(e);return this.bus.on(p,!1,t,o)},Model.prototype.applySnapshot=function(e,t){"use strict";t="undefined"==typeof t||t;var o=toUpdates(t?{}:this.root.props,e.props);applyUpdatesAndEmitEvents(this,o,t)},Model.prototype.applyUpdates=function(e){"use strict";applyUpdatesAndEmitEvents(this,e,!1)},module.exports=Model;
},{"./helpers":66}],68:[function(require,module,exports){
var flatten=require("./helpers").flatten,Props=function(r){"use strict";var e=function(e){return r.props[e]},o=function(e){return"undefined"==typeof e||"undefined"==typeof r.props[e]?flatten(r.props,r.separator,e):r.props[e].value},n=function(e,o){return e=e||"",""===e?s:(o=o||r.separator,new Props(r.getViewModel(e,o)))},t=function(e,o){Object.keys(r.props).forEach(function(n){e.call(o,r.props[n])})},p=function(e,o){r.on(e,o)},s={prop:e,val:o,props:n,forEach:t,onUpdate:p};return s};module.exports=Props;
},{"./helpers":66}],69:[function(require,module,exports){
var uuid=function(){"use strict";return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var i=16*Math.random()|0,t="x"===n?i:3&i|8;return t.toString(16)})},isFunction=function(n){"use strict";return void 0!==n&&null!==n&&"function"==typeof n},isString=function(n){"use strict";return"string"==typeof n},levels={debug:"debug",info:"info",warn:"warn",error:"error"},log=function(n,i){"use strict";if(console){var t=console[n];if(isFunction(t)){var e=new Date;[].splice.call(i,0,0,e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()),t.apply(console,i)}}},info=function(){"use strict";log(levels.info,arguments)},warn=function(){"use strict";log(levels.warn,arguments)},debug=function(){"use strict";log(levels.debug,arguments)};module.exports={uuid:uuid,isFunction:isFunction,isString:isString,log:log,warn:warn,info:info,debug:debug};
},{}],70:[function(require,module,exports){
function createBridge(){"use strict";return{}}module.exports=createBridge;
},{}],71:[function(require,module,exports){
function createBridge(){"use strict";function e(){var e=s.all();return e&&e.keys?e.keys:[]}function t(e,t){return s.update(e,t)}function r(e,t){s.set(e,t)}function n(e,t){return s.subscribe(e,t)}function u(e){s.unsubscribe(e)}var s=htmlContainer.sharedContextFacade;return{all:e,update:t,set:r,subscribe:n,unsubscribe:u}}module.exports=createBridge;
},{}],72:[function(require,module,exports){
function contexts(e){"use strict";function r(e){return"undefined"!=typeof htmlContainer?htmlContainer.sharedContextFacade?hcBridge(e):"Your version of HtmlContainer does not support contexts. Get version 1.46.0.0 or later to have that feature.":gwBridge(e)}function n(){return u.all()}function t(e,r){return u.update(e,r)}function o(e,r){return u.set(e,r)}function s(e,r){return u.subscribe(e,r)}function i(e){u.unsubscribe(e)}var u=r(e);return"string"==typeof u?{error:u,version:PackageJson.version}:{all:n,update:t,set:o,subscribe:s,unsubscribe:i,version:PackageJson.version}}var PackageJson=require("../package.json"),hcBridge=require("./bridges/hc.js"),gwBridge=require("./bridges/gw.js");module.exports=contexts;
},{"../package.json":73,"./bridges/gw.js":70,"./bridges/hc.js":71}],73:[function(require,module,exports){
module.exports={"_args":[["tick42-contexts@0.0.2","C:\\work\\stash\\GLUE-dev\\js-glue"]],"_from":"tick42-contexts@0.0.2","_id":"tick42-contexts@0.0.2","_inCache":true,"_installable":true,"_location":"/tick42-contexts","_nodeVersion":"5.3.0","_npmUser":{},"_npmVersion":"3.3.12","_phantomChildren":{},"_requested":{"name":"tick42-contexts","raw":"tick42-contexts@0.0.2","rawSpec":"0.0.2","scope":null,"spec":"0.0.2","type":"version"},"_requiredBy":["/"],"_resolved":"http://192.168.0.234:4873/tick42-contexts/-/tick42-contexts-0.0.2.tgz","_shasum":"af038bb59ec4309129f392e763b4b55274ceee5e","_shrinkwrap":null,"_spec":"tick42-contexts@0.0.2","_where":"C:\\work\\stash\\GLUE-dev\\js-glue","author":{"name":"Tick42"},"bin":{"build":"./bin/build.js","clean":"./bin/clean.js","file-versionify":"./bin/file-versionify.js","minify":"./bin/minify.js"},"dependencies":{"tick42-gateway-connection":">=1.1.9"},"description":"A library for shared contexts","devDependencies":{"browserify":"^13.0.0","browserify-replacify":"^0.0.4","browserify-versionify":"^1.0.4","eslint":"^3.1.1","eslint-config-standard":"^5.3.5","eslint-config-tick42":"^1.0.0","eslint-plugin-promise":"^2.0.0","eslint-plugin-standard":"^2.0.0","minifyify":"^7.3.2","onchange":"^2.1.2"},"dist":{"shasum":"af038bb59ec4309129f392e763b4b55274ceee5e","tarball":"http://192.168.0.234:4873/tick42-contexts/-/tick42-contexts-0.0.2.tgz"},"gitHead":"ad0ff4156b209cdeb0b8553ff0b3daa33585f76d","license":"ISC","main":"library/main.js","name":"tick42-contexts","optionalDependencies":{},"readme":"ERROR: No README data found!","repository":{"type":"git","url":"https://kpopov@stash.tick42.com/scm/tg/js-contexts.git"},"scripts":{"build":"npm run eslint && node bin/clean.js && node bin/build.js && node bin/minify && node bin/file-versionify","eslint":"eslint library","eslint:fix":"eslint library --fix","prepublish":"npm update & npm run build","watch":"onchange \"./library/*.js\" -iv -e \"./bin\" -- npm run build"},"version":"0.0.2"}
},{}],74:[function(require,module,exports){
var callbackRegistry=require("callback-registry"),packageJson=require("../package.json");module.exports=function(e){"use strict";var n={},o=0,t=callbackRegistry();return{_connected:!1,_createMessage:function(e,n,o){throw new Error("Not implemented - you should extend the connection with protocol "+e+n+o)},_processMessage:function(e){throw new Error("Not implemented - you should extend the connection with protocol "+e)},_distributeMessage:function(e,o){var t=n[o.toLowerCase()];void 0!==t&&Object.keys(t).forEach(function(n){var o=t[n];void 0!==o&&o(e)})},_triggerConnectionChanged:function(e){this._connected=e,e?t.execute("connected"):t.execute("disconnected")},on:function(e,t,c){t=t.toLowerCase(),void 0===n[t]&&(n[t]={});var r=o++;return n[t][r]=c,{type:t,id:r}},off:function(e){delete n[e.type.toLowerCase()][e.id]},connected:function(n){this._connected&&n(e.ws||e.http),t.add("connected",n)},disconnected:function(e){t.add("disconnected",e)},login:function(){return!0},logout:function(){return!0},init:function(){return!0},protocolVersion:e.protocolVersion||1,version:packageJson.version}};
},{"../package.json":83,"callback-registry":5}],75:[function(require,module,exports){
(function (global){
var baseConnection=require("./connection"),connection=function(o,r){"use strict";o=o||{};var e=baseConnection(o);if(void 0!==global.htmlContainer)return e=require("./protocols/gw1")(e,o),require("./transports/hc")(e,o);if(e=3===o.protocolVersion?require("./protocols/gw3")(e,o):2===o.protocolVersion?require("./protocols/gw2")(e,o):require("./protocols/gw1")(e,o),void 0!==o.ws)return require("./transports/ws")(e,o);if(void 0!==o.http)return require("./transports/http")(e,o);if(void 0!==r)return require("./transports/mock")(e,r,o);throw new Error("No connection. Make sure you are running the application from Tick42 HtmlContainer or fill the 'connection.websocket_url' property.")};void 0===global.tick42&&(global.tick42={}),global.tick42.connection=connection,module.exports=connection;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./connection":74,"./protocols/gw1":76,"./protocols/gw2":77,"./protocols/gw3":78,"./transports/hc":79,"./transports/http":80,"./transports/mock":81,"./transports/ws":82}],76:[function(require,module,exports){
var Promise=require("es6-promise").Promise;module.exports=function(e){"use strict";return e._processMessage=function(s){s=JSON.parse(s),e._distributeMessage(s.message,s.type)},e._createMessage=function(e,s,r){return JSON.stringify({type:e,message:s,id:r})},e.login=function(){return new Promise(function(e){e()})},e};
},{"es6-promise":8}],77:[function(require,module,exports){
var Promise=require("es6-promise").Promise;module.exports=function(e){"use strict";var s;return e._processMessage=function(s){s=JSON.parse(s);var r=s.type;"SEND"===r?(s=s.data,e._distributeMessage(s.message,s.type)):e._distributeMessage(s,s.type)},e._createMessage=function(e,r,t){return"LOGIN"===e?JSON.stringify(r):"LOGOUT"===e?JSON.stringify({type:"LOGOUT"}):JSON.stringify({type:"SEND",sessionCookie:s,data:{type:e,message:r,id:t}})},e.login=function(r){return new Promise(function(t,i){var n;if(r.token)n={token:r.token,type:"LOGIN_TOKEN"};else{if(!r.username)throw new Error("invalid auth message"+JSON.stringify(r));n={user:r.username,password:r.password,type:"LOGIN"}}var o=e.on("","LOGIN_RESPONSE",function(r){e.off(o),r&&!r.errorMessage?(s=r.sessionCookie,t(r)):i(r)});e.send("","LOGIN",n)})},e.logout=function(){e.send("","LOGOUT")},e};
},{"es6-promise":8}],78:[function(require,module,exports){
var cuid=require("cuid"),Promise=require("es6-promise").Promise,URLSearchParams=require("url-search-params");module.exports=function(e,n){"use strict";function t(){if(n.gwTokenProvider)return n.gwTokenProvider.get();if(location&&location.search){var e=new URLSearchParams(location.search.slice(1));return e.get("t42gwtoken")}return null}var r="#T42_DATE_",i=r.length,o=i+1,s=r[0];return e.instance=cuid(),e._processMessage=function(n){n=JSON.parse(n,function(e,n){if("string"!=typeof e)return n;if(e[0]!==s)return n;if(n.length<o)return n;var t=parseInt(n.substring(i,n.length),10);return isNaN(t)?n:new Date(t)}),e._distributeMessage(n,n.type)},e._createMessage=function(e,n){return JSON.stringify(n,function(e,n){return null===n||"object"!=typeof n?n:n.getTime&&n instanceof Date?r+n.getTime():n})},e.login=function(r){return new Promise(function(i,o){var s={},a=t();if(a)s.method="gateway-token",s.token=a;else if(r.token)s.method="access-token",s.token=r.token;else{if(!r.username)throw new Error("invalid auth message"+JSON.stringify(r));s.method="secret",s.user=r.username,s.secret=r.password}var u=cuid(),c={request_id:u,type:"hello",identity:{application:n.application,instance:e.instance},authentication:s},f=e.on("","welcome",function(n){n.request_id===u&&(e.off(f),e.off(l),e.peerId=n.peer_id,e.gwToken=a,i(n))}),l=e.on("","error",function(n){n.request_id===u&&(e.off(l),e.off(f),o(n))});e.send("","LOGIN",c)})},e.logout=function(){e.send("","LOGOUT")},e};
},{"cuid":6,"es6-promise":8,"url-search-params":105}],79:[function(require,module,exports){
(function (global){
module.exports=function(n){"use strict";var o=Math.floor(1e10*Math.random()).toString();return n.send=function(n,a,e){"metrics"===n?global.htmlContainer.metricsFacade.send(a,JSON.stringify(e)):"log"===n?global.htmlContainer.loggingFacade.send(a,JSON.stringify(e)):"appconfig"===n&&global.htmlContainer.appConfigFacade.send(a,JSON.stringify(e),o)},void 0!==global.htmlContainer.appConfigFacade&&global.htmlContainer.appConfigFacade.initConnection(o,function(o){return n._handle_message(JSON.parse(o))}),global.connections=global.connections||{},global.connections["connection"+o]=n._handle_message,n};
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],80:[function(require,module,exports){
(function (global){
module.exports=function(e,n){"use strict";function t(e){void 0===global.console||n.debug!==!0&&n.trace!==!0||console.log(e)}function o(e){void 0!==global.console&&n.trace===!0&&console.log(e)}function a(e,n,i,s){var c=e;0!==i&&(c=e+"?sequence="+i+"&no-cache="+(new Date).getTime());var u=r("GET",c,function(){0===i&&t("Connected to Gateway on "+e),o("Response from '"+c+"' is "+u.responseText);var r=JSON.parse(u.responseText),l=r.nextSequence;s(r.data),setTimeout(function(){a(e,n,l,s)},n)});u.onerror=function(t){console.log("Error polling data from http server '"+c+"' - "+t),setTimeout(function(){a(e,n,i,s)},n)},o("Sending GET to '"+c+"'"),u.send()}function i(e,n){var t=r("POST",e);o("Sending POST to '"+e+"' : "+n),t.send(n)}function r(e,n,t){var o=new XMLHttpRequest;return"withCredentials"in o?(o.open(e,n,!0),"undefined"!=typeof t&&(o.onreadystatechange=function(){4===o.readyState&&200===o.status&&t()})):"undefined"!=typeof XDomainRequest?(o=new XDomainRequest,o.open(e,n),"undefined"!=typeof t&&(o.onload=t)):o=null,o}var s=n.http,c=n.http_interval_ms;return c||(c=1e3),t("Attemping to connect to Gateway via HTTP with url '"+s+"' and polling interval "+c+" ms"),e.init=function(){a(s,c,0,function(n){for(var t=0;t<n.length;t++)e._processMessage(n[t])})},e.send=function(n,t,o,a){var r=e._createMessage(t,o,a);i(s,r)},e};
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],81:[function(require,module,exports){
module.exports=function(e,s){"use strict";return e.send=function(e,n,t){s.publish({type:n,message:t})},s.subscribe(e._handle_message),e};
},{}],82:[function(require,module,exports){
(function (global){
module.exports=function(e,n){"use strict";function t(){var t=new r(n.ws);return t.onclose=function(){e._triggerConnectionChanged(!1)},t.onopen=function(){e._triggerConnectionChanged(!0)},t.onmessage=function(n){e._processMessage(n.data)},t}function o(e){if(e){if(1===c.readyState)return e();c.readyState>1&&(c=t()),setTimeout(function(){o(e)},50)}}var r=require("detect-node")?require("ws"):global.WebSocket,c=t();return e.send=function(n,t,r,i){o(function(){var n=e._createMessage(t,r,i);n&&c.send(n)})},e.websocket_url=function(e){n.websocket_url=e,c.close(),c=t()},e};
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"detect-node":7,"ws":107}],83:[function(require,module,exports){
module.exports={"_args":[["tick42-gateway-connection@^2.0.3","C:\\work\\stash\\GLUE-dev\\js-glue"]],"_from":"tick42-gateway-connection@>=2.0.3 <3.0.0","_id":"tick42-gateway-connection@2.1.2","_inCache":true,"_installable":true,"_location":"/tick42-gateway-connection","_nodeVersion":"6.3.0","_npmUser":{},"_npmVersion":"3.8.5","_phantomChildren":{},"_requested":{"name":"tick42-gateway-connection","raw":"tick42-gateway-connection@^2.0.3","rawSpec":"^2.0.3","scope":null,"spec":">=2.0.3 <3.0.0","type":"range"},"_requiredBy":["/","/tick42-agm","/tick42-appconfig","/tick42-contexts","/tick42-logger","/tick42-metrics"],"_shasum":"4db28853edd5f88c12fec471ad0b74198c512d57","_shrinkwrap":null,"_spec":"tick42-gateway-connection@^2.0.3","_where":"C:\\work\\stash\\GLUE-dev\\js-glue","bin":{"build":"./bin/build.js","clean":"./bin/clean.js","file-versionify":"./bin/file-versionify.js","minify":"./bin/minify.js"},"dependencies":{"browserify-versionify":"^1.0.4","callback-registry":"^1.0.1","cuid":"^1.3.8","detect-node":"^2.0.3","es6-promise":"^3.2.1","url-search-params":"^0.5.0","ws":"^0.7.2"},"description":"Tick42 Gateway Connection.","devDependencies":{"blanket":"^1.1.6","browserify":"^13.0.0","browserify-replacify":"^0.0.4","browserify-versionify":"^1.0.4","eslint":"^3.1.1","eslint-config-standard":"^5.3.5","eslint-config-tick42":"^1.0.0","eslint-plugin-promise":"^2.0.0","eslint-plugin-standard":"^2.0.0","fs":"0.0.2","jsdom":"^8.1.0","minifyify":"^7.3.2","onchange":"^2.1.2","phantomjs":"^1.9.12","qunitjs":"^1.15.0","shelljs":"^0.6.0"},"dist":{"shasum":"4db28853edd5f88c12fec471ad0b74198c512d57","tarball":"http://192.168.0.234:4873/tick42-gateway-connection/-/tick42-gateway-connection-2.1.2.tgz"},"gitHead":"3ea3546a8c79909f47ec26677ea8e12e89dcc29f","main":"library/main.js","name":"tick42-gateway-connection","optionalDependencies":{},"readme":"ERROR: No README data found!","readmeFilename":"readme.md","scripts":{"build":"npm run eslint && node bin/clean.js && node bin/build.js && node bin/minify && node bin/file-versionify","eslint":"eslint library","eslint:fix":"eslint library --fix ","prepublish":"npm update & npm run build","test":"npm run eslint && mocha --require ./test/test_helper \"test/**/*.js\"","watch":"onchange \"./library/*.js\" -iv -e \"./bin\" -- npm run build"},"version":"2.1.2"}
},{}],84:[function(require,module,exports){
function serializePath(e){"use strict";return 0===e.length?"":e.join(".")}function getLevel(e,n){"use strict";return void 0!==e[n]?e[n]:void 0!==e.parent?getLevel(e.parent,n):void 0}function messageToTable(e,n){"use strict";var t=getAllKeys(n),i=n.map(function(e){return t.map(function(n){return e[n]})}),o=asciiTable.factory({title:e,heading:t,rows:i});return o.toString()}function getAllKeys(e){"use strict";var n=[];return e.forEach(function(e){Object.keys(e).forEach(function(e){n.indexOf(e)===-1&&n.push(e)})}),n}function logger(e){"use strict";function n(e,n,i){var o=Object.create(s);return o.name=e,o.path=n,o.subloggers=[],o.parent=i,void 0!==i&&(i.subloggers.push(o),i[o.name]=o,void 0!==i.metricSystem&&o.metricsLevel("warn",i.metricSystem.subSystem(o.name))),levels.forEach(function(e){o[e]=function(n){t(o,e,n)}}),o.off=function(){},o.version=PackageJson.version,o}function t(e,n,t){var o=l(e);if("error"===n){var s=new Error;s.stack&&(t=t+"\n"+s.stack.split("\n").slice(3).join("\n"))}if(c(getLevel(e,"_consoleLevel"),n)){if(!console[n])return;console[n](o+": "+t)}c(getLevel(e,"_publishLevel"),n)&&i.send("log","LogMessage",{instance:r,level:levels.indexOf(n),logger:o,message:t}),c(getLevel(e,"_metricLevel"),n)&&void 0!==e.metricSystem&&(e.metricSystem.objectMetric("LogMessage",{Time:new Date,Logger:o,Level:n,Message:t}),"error"===n&&e.metricSystem.setState(100,t))}"object"!=typeof e.connection&&(e.connection={}),e.connection.debug=e.debug;var i=isConnection(e.connection)?e.connection:tick42Connection(e.connection),o=["system","service","instance"],r=o.map(function(n){var t=e.identity[n];if("string"!=typeof t)throw new Error('Please specify "'+n+'" in your identity');return t}).join("/"),s={subLogger:function(e){var t=this.subloggers.filter(function(n){return n.name===e})[0];if(void 0!==t)return t;Object.keys(this).forEach(function(n){if(n===e)throw new Error("This sub logger name is not allowed.")}),Object.keys(s).forEach(function(n){if(n===e)throw new Error("This sub logger name is not allowed.")});var i=this.path.slice(0);return i.push(this.name),n(e,i,this)},publishLevel:function(e){return null!==e&&void 0!==e&&(this._publishLevel=e),getLevel(this,"_publishLevel")},consoleLevel:function(e){return null!==e&&void 0!==e&&(this._consoleLevel=e),getLevel(this,"_consoleLevel")},metricsLevel:function(e,n){if(null!==e&&void 0!==e&&(this._metricLevel=e),void 0!==n){if("object"!=typeof n||"function"!=typeof n.objectMetric)throw new Error("Please specify metric system ");this.metricSystem=n}},table:function(e){if(!Array.isArray(e))throw new Error("The message must be in an array");var n=l(this);c(getLevel(this,"_consoleLevel"),"info")&&(console.info(n+":"),console.table(e)),c(getLevel(this,"_publishLevel"),"info")&&i.send("log","LogMessage",{instance:r,level:levels.indexOf("info"),logger:n,message:messageToTable(n,e)})},log:function(e,n){t(this,n||"info",e)}},c=function(e,n){return!e||levels.indexOf(e)<=levels.indexOf(n)},l=function(e){var n=e.path.slice();return n.push(e.name),"["+serializePath(n)+"]"},a=n("main",[],void 0);return a.publishLevel("warn"),a.consoleLevel("info"),a.metricsLevel("warn"),a}var asciiTable=require("ascii-table"),tick42Connection=require("tick42-gateway-connection"),PackageJson=require("../package.json"),levels=["trace","debug","info","warn","error","off"],isConnection=function(e){"use strict";return"object"==typeof e&&"function"==typeof e.send&&"function"==typeof e.on};"undefined"!=typeof window&&(window.tick42=window.tick42||{},window.tick42.log=logger),module.exports=logger;
},{"../package.json":85,"ascii-table":4,"tick42-gateway-connection":75}],85:[function(require,module,exports){
module.exports={"_args":[["tick42-logger@2.0.6","C:\\work\\stash\\GLUE-dev\\js-glue"]],"_from":"tick42-logger@2.0.6","_id":"tick42-logger@2.0.6","_inCache":true,"_installable":true,"_location":"/tick42-logger","_nodeVersion":"6.3.0","_npmUser":{},"_npmVersion":"3.8.5","_phantomChildren":{},"_requested":{"name":"tick42-logger","raw":"tick42-logger@2.0.6","rawSpec":"2.0.6","scope":null,"spec":"2.0.6","type":"version"},"_requiredBy":["/"],"_shasum":"04124763b30d2bbe199e38aac715e308e425c023","_shrinkwrap":null,"_spec":"tick42-logger@2.0.6","_where":"C:\\work\\stash\\GLUE-dev\\js-glue","author":{"name":"Tick42"},"bin":{"build":"./bin/build.js","clean":"./bin/clean.js","file-versionify":"./bin/file-versionify.js","minify":"./bin/minify.js"},"dependencies":{"ascii-table":"0.0.8","tick42-gateway-connection":">=1.1.9"},"description":"A library for logging","devDependencies":{"blanket":"^1.1.6","browserify":"^13.0.0","browserify-replacify":"^0.0.4","browserify-versionify":"^1.0.4","eslint":"^3.1.1","eslint-config-standard":"^5.3.5","eslint-config-tick42":"^1.0.0","eslint-plugin-promise":"^2.0.0","eslint-plugin-standard":"^2.0.0","fs":"0.0.2","jsdom":"^8.1.0","minifyify":"^7.3.2","onchange":"^2.1.2","phantomjs":"^1.9.12","qunitjs":"^1.15.0","shelljs":"^0.6.0"},"dist":{"shasum":"04124763b30d2bbe199e38aac715e308e425c023","tarball":"http://192.168.0.234:4873/tick42-logger/-/tick42-logger-2.0.6.tgz"},"gitHead":"34be3019b237911937638a6f4abf1e820f6d1829","license":"ISC","main":"library/logger","name":"tick42-logger","optionalDependencies":{},"readme":"ERROR: No README data found!","repository":{"type":"git","url":"https://stash.tick42.com:8443/scm/ofgw/js-logger.git"},"scripts":{"build":"npm run eslint && node bin/clean.js && node bin/build.js && node bin/minify && node bin/file-versionify","eslint":"eslint library","eslint:fix":"eslint library --fix","prepublish":"npm update & npm run build","test":"npm run eslint && mocha --require ./test/test_helper \"test/**/*.js\"","watch":"onchange \"./library/*.js\" -iv -e \"./bin\" -- npm run build"},"version":"2.0.6"}
},{}],86:[function(require,module,exports){
"use strict";var objectMetric_1=require("../metrics/objectMetric"),stringMetric_1=require("../metrics/stringMetric"),numberMetric_1=require("../metrics/numberMetric"),timestampMetric_1=require("../metrics/timestampMetric"),MetricSerializer=function(){function e(){}return e.metricToMessage=function(t){var r=e._getMetricDefinition(t.name,t.value,t.path,t.type,t.description,t.period,t.resolution);return{id:t.id,instance:t.repo.instance,definition:r,value:e._serializeValue(t.value,t)}},e._getMetricDefinition=function(t,r,i,n,c,u,a){var s={name:t,description:c,type:n?n:e._getTypeFromValue(r),path:i,resolution:u,period:a};return s.type===objectMetric_1.ObjectMetric.type&&(s.Composite=Object.keys(r).reduce(function(t,n){var c=r[n];return t.push(e._getMetricDefinition(n,c,i)),t},[])),s},e._serializeValue=function(t,r){if(t&&t.constructor===Date)return{value:{type:this._valueTypes.indexOf("date"),value:t.valueOf(),isArray:!1}};if("object"==typeof t)return{CompositeValue:Object.keys(t).reduce(function(r,i){var n=e._serializeValue(t[i]);return n.InnerMetricName=i,r.push(n),r},[])};var i=r?r.getValueType():void 0;return i|=this._valueTypes.indexOf(typeof t),{value:{type:i,value:t,isArray:!1}}},e._getTypeFromValue=function(e){var t=e.constructor===Date?"timestamp":typeof e;switch(t){case"string":return stringMetric_1.StringMetric.type;case"number":return numberMetric_1.NumberMetric.type;case"timestamp":return timestampMetric_1.TimestampMetric.type;case"object":return objectMetric_1.ObjectMetric.type}return 0},e._valueTypes=["boolean","int","number","long","string","date","object"],e}();exports.MetricSerializer=MetricSerializer;
},{"../metrics/numberMetric":91,"../metrics/objectMetric":92,"../metrics/stringMetric":95,"../metrics/timestampMetric":97}],87:[function(require,module,exports){
"use strict";var metricSerializer_1=require("./metricSerializer"),MetricsBridge=function(){function e(e,t){var i=this;this._repo=e,this._connection=t,t.on("metrics","MetricsSnapshotRequest",function(t){t.Instance===e.instance&&i.sendFull(i._repo)})}return e.prototype.sendFull=function(e){var t=e.root;t&&0!=t.subSystems.length&&this.sendFullSystem(t)},e.prototype.sendFullSystem=function(e){var t=this;this.createSystem(e),e.subSystems.forEach(function(e){t.sendFullSystem(e)}),e.metrics.forEach(function(e){t.createMetric(e)})},e.prototype.createMetric=function(e){this._send("CreateMetric",metricSerializer_1.MetricSerializer.metricToMessage(e))},e.prototype.updateMetric=function(e){this._send("UpdateMetric",metricSerializer_1.MetricSerializer.metricToMessage(e))},e.prototype.createSystem=function(e){void 0!==e.parent&&this._send("CreateMetricSystem",{id:e.id,instance:e.repo.instance,definition:{name:e.name,description:e.description,path:e.path}})},e.prototype.updateSystem=function(e,t){this._send("UpdateMetricSystem",{id:e.id,instance:e.repo.instance,state:t})},e.prototype.heartbeat=function(e,t){this._send("HeartbeatMetrics",{publishingInterval:t,instance:e.instance})},e.prototype._send=function(e,t){this._connection.send("metrics",e,t)},e}();exports.MetricsBridge=MetricsBridge;
},{"./metricSerializer":86}],88:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},metric_1=require("./metric"),AddressMetric=function(t){function e(r,i,s,c){t.call(this,r,i,s,e.type,c||"")}return __extends(e,t),e.type=8,e}(metric_1.Metric);exports.AddressMetric=AddressMetric;
},{"./metric":90}],89:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},metric_1=require("./metric"),CountMetric=function(t){function e(n,r,o,i){t.call(this,n,r,o,e.type,i||0)}return __extends(e,t),e.prototype.increment=function(){this.incrementBy(1)},e.prototype.decrement=function(){this.decrementBy(1)},e.prototype.incrementBy=function(t){this.update((this.value||0)+t)},e.prototype.decrementBy=function(t){this.update((this.value||0)-t)},e.prototype.getValueType=function(){return 3},e.type=3,e}(metric_1.Metric);exports.CountMetric=CountMetric;
},{"./metric":90}],90:[function(require,module,exports){
"use strict";var Metric=function(){function t(t,i,e,s,r){this.name=t.name,this.description=t.description,this.period=t.period,this.resolution=t.resolution,this.system=i,this.repo=i.repo,this.id=i.path+"/"+this.name,this.value=r,this.type=s,this.path=i.path.slice(0),this.path.push(i.name),this._transport=e,this._transport.createMetric(this)}return t.prototype.update=function(t){this.value=t,this._transport.updateMetric(this)},t.prototype.getValueType=function(){},t.type=0,t}();exports.Metric=Metric;
},{}],91:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},metric_1=require("./metric"),NumberMetric=function(t){function e(r,n,i,c){t.call(this,r,n,i,e.type,c||0)}return __extends(e,t),e.prototype.increment=function(){this.incrementBy(1)},e.prototype.decrement=function(){this.decrementBy(1)},e.prototype.incrementBy=function(t){this.update((this.value||0)+t)},e.prototype.decrementBy=function(t){this.update((this.value||0)-t)},e.type=2,e}(metric_1.Metric);exports.NumberMetric=NumberMetric;
},{"./metric":90}],92:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var c in e)e.hasOwnProperty(c)&&(t[c]=e[c]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},metric_1=require("./metric"),ObjectMetric=function(t){function e(r,c,i,o){t.call(this,r,c,i,e.type,o)}return __extends(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e)},e.type=11,e}(metric_1.Metric);exports.ObjectMetric=ObjectMetric;
},{"./metric":90}],93:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},metric_1=require("./metric"),RateMetric=function(t){function e(r,i,c,n){t.call(this,r,i,c,e.type,n||0)}return __extends(e,t),e.type=4,e}(metric_1.Metric);exports.RateMetric=RateMetric;
},{"./metric":90}],94:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},metric_1=require("./metric"),StatisticsMetric=function(t){function e(i,r,c,s){t.call(this,i,r,c,e.type,s||0)}return __extends(e,t),e.type=6,e}(metric_1.Metric);exports.StatisticsMetric=StatisticsMetric;
},{"./metric":90}],95:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},metric_1=require("./metric"),StringMetric=function(t){function e(r,i,n,c){t.call(this,r,i,n,e.type,c||"")}return __extends(e,t),e.type=1,e}(metric_1.Metric);exports.StringMetric=StringMetric;
},{"./metric":90}],96:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},metric_1=require("./metric"),TimespanMetric=function(t){function e(r,i,n,o){t.call(this,r,i,n,e.type,o||!1)}return __extends(e,t),e.prototype.start=function(){this.update(!0)},e.prototype.stop=function(){this.update(!1)},e.type=10,e}(metric_1.Metric);exports.TimespanMetric=TimespanMetric;
},{"./metric":90}],97:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},metric_1=require("./metric"),TimestampMetric=function(t){function e(r,i,n,o){t.call(this,r,i,n,e.type,o||new Date)}return __extends(e,t),e.prototype.now=function(){this.update(new Date)},e.type=7,e}(metric_1.Metric);exports.TimestampMetric=TimestampMetric;
},{"./metric":90}],98:[function(require,module,exports){
"use strict";var system_1=require("./system"),transport_1=require("./bridge/transport"),Repository=function(){function t(t){this._config=t,this._transport=new transport_1.MetricsBridge(this,t.connection),this.instance=t.identity.system+"/"+t.identity.service+"/"+t.identity.instance,this.identity=t.identity,this._startHeartbeating(),this.root=new system_1.System("",this,this._transport),this._initSystemMetrics(this.root,t.clickStream||void 0===t.clickStream)}return t.prototype._startHeartbeating=function(){var t=this;this._transport.heartbeat(this,this._config.settings.heartbeatInterval),setInterval(function(){t._transport.heartbeat(t,t._config.settings.heartbeatInterval)},this._config.settings.heartbeatInterval)},t.prototype._initSystemMetrics=function(t,e){if("undefined"!=typeof navigator&&t.stringMetric("UserAgent",navigator.userAgent),e&&"undefined"!=typeof document){var i=t.subSystem("ClickStream"),r=function(t){t.target&&i.objectMetric("LastBrowserEvent",{type:"click",timestamp:new Date,target:{className:t.target?t.target.className:"",id:t.target.id,type:"<"+t.target.tagName.toLowerCase()+">",href:t.target.href||""}})};i.objectMetric("Page",{title:document.title,page:window.location.href}),document.addEventListener?document.addEventListener("click",r):document.attachEvent("onclick",r)}},t}();exports.Repository=Repository;
},{"./bridge/transport":87,"./system":99}],99:[function(require,module,exports){
"use strict";var numberMetric_1=require("./metrics/numberMetric"),timespanMetric_1=require("./metrics/timespanMetric"),stringMetric_1=require("./metrics/stringMetric"),addressMetric_1=require("./metrics/addressMetric"),objectMetric_1=require("./metrics/objectMetric"),timestampMetric_1=require("./metrics/timestampMetric"),countMetric_1=require("./metrics/countMetric"),statisticsMetric_1=require("./metrics/statisticsMetric"),rateMetric_1=require("./metrics/rateMetric"),System=function(){function t(t,e,r,i,n){this.metrics=[],this.subSystems=[],this.name=t,this.description=n||"",this.repo=e,this.parent=i,this._transport=r,this.path=this._buildPath(this.parent),this.id=(this.path.length>0?this.path.join("/")+"/":"")+this.name,this.identity=e.identity,this.root=e.root,this._transport.createSystem(this)}return t.prototype.subSystem=function(e,r){if(!e||0===e.length)throw new Error("name is required");var i=this.subSystems.filter(function(t){return t.name===e});if(i.length>0)return i[0];var n=new t(e,this.repo,this._transport,this,r);return this.subSystems.push(n),n},t.prototype.setState=function(t,e){this._transport.updateSystem(this,{state:t,description:e})},t.prototype.stringMetric=function(t,e){var r=this;return this._getOrCreateMetric(t,stringMetric_1.StringMetric.type,e,function(t){return new stringMetric_1.StringMetric(t,r,r._transport,e)})},t.prototype.numberMetric=function(t,e){var r=this;return this._getOrCreateMetric(t,numberMetric_1.NumberMetric.type,e,function(t){return new numberMetric_1.NumberMetric(t,r,r._transport,e)})},t.prototype.countMetric=function(t,e){var r=this;return this._getOrCreateMetric(t,countMetric_1.CountMetric.type,e,function(t){return new countMetric_1.CountMetric(t,r,r._transport,e)})},t.prototype.addressMetric=function(t,e){var r=this;return this._getOrCreateMetric(t,addressMetric_1.AddressMetric.type,e,function(t){return new addressMetric_1.AddressMetric(t,r,r._transport,e)})},t.prototype.objectMetric=function(t,e){var r=this;return this._getOrCreateMetric(t,objectMetric_1.ObjectMetric.type,e,function(t){return new objectMetric_1.ObjectMetric(t,r,r._transport,e)})},t.prototype.timespanMetric=function(t,e){var r=this;return this._getOrCreateMetric(t,timespanMetric_1.TimespanMetric.type,e,function(t){return new timespanMetric_1.TimespanMetric(t,r,r._transport,e)})},t.prototype.timestampMetric=function(t,e){var r=this;return this._getOrCreateMetric(t,timestampMetric_1.TimestampMetric.type,e,function(t){return new timestampMetric_1.TimestampMetric(t,r,r._transport,e)})},t.prototype.rateMetric=function(t,e){var r=this;return this._getOrCreateMetric(t,rateMetric_1.RateMetric.type,e,function(t){return new rateMetric_1.RateMetric(t,r,r._transport,e)})},t.prototype.statiticsMetric=function(t,e){var r=this;return this._getOrCreateMetric(t,statisticsMetric_1.StatisticsMetric.type,e,function(t){return new statisticsMetric_1.StatisticsMetric(t,r,r._transport,e)})},t.prototype._unionToMetricDef=function(t){var e;if(e="string"==typeof t?{name:t}:t,void 0===e.name)throw new Error("Metric name is required.");return e},t.prototype._getOrCreateMetric=function(t,e,r,i){var n=this._unionToMetricDef(t),s=this.metrics.filter(function(t){return t.name===n.name});if(s.length>0){var c=s[0];if(c.type!==e)throw new Error("A metric named "+n.name+" is already defined with different type");return"undefined"!=typeof r&&c.update(r),c}var o=i(n);return this.metrics.push(o),o},t.prototype._buildPath=function(t){if(!t||!t.parent)return[];var e=this._buildPath(t.parent);return e.push(t.name),e},t}();exports.System=System;
},{"./metrics/addressMetric":88,"./metrics/countMetric":89,"./metrics/numberMetric":91,"./metrics/objectMetric":92,"./metrics/rateMetric":93,"./metrics/statisticsMetric":94,"./metrics/stringMetric":95,"./metrics/timespanMetric":96,"./metrics/timestampMetric":97}],100:[function(require,module,exports){
"use strict";var repository_1=require("./core/repository"),tick42_gateway_connection_1=require("tick42-gateway-connection"),windowAsAny="undefined"==typeof window?new Object:window;windowAsAny.tick42=windowAsAny.tick42||{},windowAsAny.tick42.metrics=windowAsAny.tick42.metrics||function(n){if(!n.identity)throw new Error("Identity missing from metrics configuration");if(!n.identity.service||"string"!=typeof n.identity.service)throw new Error("Service missing or invalid in metrics identity configuration");if(!n.identity.system||"string"!=typeof n.identity.system)throw new Error("System missing or invalid in metrics identity configuration");if(!n.identity.instance||"string"!=typeof n.identity.instance)throw new Error("Instancemissing or invalid in metrics identity configuration");n.settings=n.settings||{},n.settings.heartbeatInterval=n.settings.heartbeatInterval||15e3,"object"!=typeof n.connection&&(n.connection={}),"object"==typeof n.connection&&"function"==typeof n.connection.send&&"function"==typeof n.connection.on||(n.connection=tick42_gateway_connection_1.connection(n.connection));var i=new repository_1.Repository(n);return i.version=i.root.version="2.0.15",i.root},module.exports=windowAsAny.tick42.metrics;
},{"./core/repository":98,"tick42-gateway-connection":75}],101:[function(require,module,exports){
var helpers=module.exports={};helpers.invokeAgmSuccessCallback=function(e,s){"use strict";"function"==typeof e&&e(s)},helpers.invokeAgmErrorCallback=function(e,s){"use strict";"function"==typeof e&&e(s.message)},helpers.execCallbacks=function(e,s){"use strict";void 0!==e&&e.forEach(function(e){e(s)})},helpers.vals=function(e){"use strict";return Object.keys(e).reduce(function(s,t){return s.push(e[t]),s},[])};
},{}],102:[function(require,module,exports){
function setWindowStyleAttributes(e){"use strict";return void 0!==e&&"object"!=typeof e?JSON.parse(e):void 0!==e&&"object"==typeof e?e:{}}function init(e){"use strict";agm=e}function createWindow(e,n,t,i,o,r,d){"use strict";function a(e,n){var t=N._callbacks;void 0===t[e]?t[e]=[n]:t[e].push(n)}function s(e,n,t,o){function r(e){void 0!==e.returned&&(a.id=e.returned.id),helpers.invokeAgmSuccessCallback(t,a)}function d(e){"function"==typeof o&&o(e)}var a=this;e=e||{},n=n||{};var s=n.isSticky;delete n.isSticky;var l=n.stickyGroup;delete n.stickyGroup,delete n.hasMoveAreaThickness,delete n.hasSizeAreaThickness;var u=i.getAgmTarget();return agm.invoke("T42.Html.CreateWindow",{windowName:a.name,url:a.url,top:e.top,left:e.left,width:e.width,height:e.height,isSticky:s,stickyGroup:l,windowStyleAttributes:JSON.stringify(n)},u,{},r,d),a}function l(e,n,t){return I("T42.Wnd.SetWindowStyle",n,t,{windowStyleAttributes:JSON.stringify(e)})}function u(){return void 0!==N.id}function c(){void 0!==N.id&&(helpers.execCallbacks(N._callbacks.onClose),N.id=void 0,N._callbacks={})}function f(){return I("T42.Wnd.Close",function(e){console.log('"'+e.name+'" window was closed.')},function(e){console.log('"'+N.name+'" window was NOT closed due following error: ',e)})}function m(e,n,t){return I("T42.Html.OpenUrl",n,t,{url:e})}function w(e,n,t){return I("T42.Wnd.SetWindowTitle",n,t,{title:e})}function g(e,n){function t(n){helpers.invokeAgmSuccessCallback(e,n.returned[r])}function o(e){helpers.invokeAgmErrorCallback(n,e)}var r=N.id;agm.invoke("T42.Wnd.FindById",{windowId:N.id},i.getAgmTarget(),{},t,o)}function v(e,n,t){return I("T42.Wnd.ResizeAndMove",n,t,e)}function p(e,n,t){function o(){var t=e.buttonId;N.buttons[t]={id:t,info:e},helpers.invokeAgmSuccessCallback(n,this)}function r(e){helpers.invokeAgmErrorCallback(t,e)}if("undefined"==typeof e){if("function"!=typeof t)return;t("No button info")}if(void 0===e.buttonId){if("function"!=typeof t)return;t("No buttonId")}if(void 0===e.imageBase64){if("function"!=typeof t)return;t("No imageBase64")}agm.invoke("T42.Wnd.AddButton",{windowId:N.id,buttonInfo:e},i.getAgmTarget(),{},o.bind(this),r.bind(this))}function b(e){e(N.title),a("onTitleChanged",e)}function h(e){return N.opened()&&e(this),a("onAvailable",e)}function k(e){a("onClose",e)}function T(e){a("onUrlChanged",e)}function y(e){a("onTabButton",e)}function C(e,n){return I("T42.Wnd.Activate",e,n)}function _(e,n){return I("T42.Wnd.MaximizeOrRestoreDown",e,n)}function A(e,n){return I("T42.Wnd.Maximize",e,n)}function S(e,n){return I("T42.Wnd.Restore",e,n)}function W(e,n){return I("T42.Wnd.Minimize",e,n)}function z(e,n){return I("T42.Wnd.Collapse",e,n)}function x(e){N.title=e,helpers.execCallbacks(N._callbacks.onTitleChanged,e)}function U(e){N.url=e,helpers.execCallbacks(N._callbacks.onUrlChanged,e)}function I(e,n,t,o){function r(){helpers.invokeAgmSuccessCallback(n,N)}return void 0===N.url?void("function"==typeof t&&t("Cannot execute a command on a closed window.")):(o=o||{},o.windowId=N.id,void agm.invoke(e,o,i.getAgmTarget(),{},r,t))}if(!i)throw new Error("containerObj can not be undefined");var N;return N={_internalId:n,_callbacks:{},name:t,container:i.name,url:o,id:e,application:i.name+"."+t,title:r,buttons:{},windowStyleAttributes:setWindowStyleAttributes(d),onAvailable:h,onClose:k,onUrlChanged:T,onTitleChanged:b,onTabButton:y,maximize:A,restore:S,minimize:W,maximizeRestore:_,collapse:z,focus:C,open:s,opened:u,getDetails:g,moveResize:v,setTitle:w,setStyle:l,navigate:m,addTabButton:p,close:f,handleWindowClose:c,titleChanged:x,urlChanged:U,set_style:deprecate(l,"window.set_style() is deprecated and might be removed from future versions of glue. Use window.setStyle() instead"),on_available:deprecate(h,"window.on_available() is deprecated and might be removed from future versions of glue. Use window.onAvailable() instead"),on_close:deprecate(k,"window.on_close() is deprecated and might be removed from future versions of glue. Use window.onClose() instead"),on_url_changed:deprecate(T,"window.on_url_changed() is deprecated and might be removed from future versions of glue. Use window.onUrlChanged() instead"),set_title:deprecate(w,"window.set_title() is deprecated and might be removed from future versions of glue. Use window.setTitle() instead"),get_details:deprecate(g,"window.get_details() is deprecated and might be removed from future versions of glue. Use window.getDetails() instead"),move_resize:deprecate(v,"window.move_resize() is deprecated and might be removed from future versions of glue. Use window.moveResize() instead"),maximize_restore:deprecate(_,"window.maximize_restore() is deprecated and might be removed from future versions of glue. Use window.maximizeRestore() instead")}}var deprecate=require("util-deprecate"),helpers=require("./helpers");module.exports.init=init,module.exports.create=createWindow;var agm;
},{"./helpers":101,"util-deprecate":106}],103:[function(require,module,exports){
(function (global){
var PackageJson=require("../package.json"),deprecate=require("util-deprecate"),windowFactory=require("./window"),helpers=require("./helpers"),windows=function(n){"use strict";function e(n,e,o){var i=t(n);return i?void e(i):void setTimeout(function(){var i=t(n);i?e(i):o()},2e3)}function t(n){return n?g.filter(function(e){return e.shortName===n||e.name===n||e.agmApplication===n})[0]:g[0]}function o(n){var e=n.split(".");2===e.length&&e.splice(0,0,"HtmlContainer");var t=e[0]+"."+e[1]+"."+e[2];return{shortName:e[2],name:e[1]+"."+e[2],agmApplication:t,getAgmTarget:function(){return{application:t}}}}function i(n,e){0===n.filter(function(n){return n.shortName===e.shortName&&n.name===e.name&&n.agmApplication===e.agmApplication}).length&&n.push(e)}function a(n,e){return void 0!==n.containersCallbacks[e]?n.allContainersCallbacks.concat(n.containersCallbacks[e]):n.allContainersCallbacks}function r(n,e,t){void 0===t?n.allContainersCallbacks.push(e):void 0===n.containersCallbacks[t]?n.containersCallbacks[t]=[e]:n.containersCallbacks[t].push(e)}function d(n,e){var t=s(n.windowName,e,n.url,n.windowId,n.windowStyleAttributes,n.windowTitle);if(void 0===t.id&&(t.id=n.windowId,helpers.execCallbacks(t._callbacks.onAvailable,t)),"TitleChanged"===n.state&&t.titleChanged(n.windowTitle),"UrlChanged"===n.state&&t.urlChanged(n.url),"Created"===n.state&&helpers.execCallbacks(a(y,e),t),"Closed"===n.state&&(helpers.execCallbacks(a(_,e),t),delete k[t._internalId],t.handleWindowClose()),"ButtonClicked"===n.state&&void 0!==t.buttons&&0!==Object.keys(t.buttons).length){if(void 0===t._callbacks.onTabButton)return;helpers.execCallbacks(t._callbacks.onTabButton,n.buttonId,t.buttons[n.buttonId].info),t._callbacks.onTabButton.forEach(function(e){e(n.buttonId,t.buttons[n.buttonId].info)})}}function c(n,e){return e.agmApplication+"."+n}function l(n,e,t,o,i,a){var r=c(n,e),d=windowFactory.create(o,r,n,e,t,a,i);return k[r]=d,d}function s(n,e,t,o,i,a){var r=c(n,e),d=k[r];return void 0!==d?d:l(n,e,t,o,i,a)}function u(){var n;return"undefined"!=typeof window&&(n=window.htmlContainer),void 0===n?void 0:s(n.browserWindowName,t(n.containerName),window.location.href,n.windowId,n.windowStyleAttributes,document.title)}function w(n,t,o,i,a,r,d){o=o||"Internal",e(o,function(e){return s(n,e,t,void 0,a).open(i,a,r,d)},function(){d("can not find container")})}function f(n,e,o){e=t(e);var i=Object.keys(k).reduce(function(t,o){var i=k[o];return i.container===e.name&&i.name===n&&t.push(i),t},[]);return"function"!=typeof o?i[0]:void o(i[0])}function m(n,e){n=t(n);var o=Object.keys(k).reduce(function(e,t){var o=k[t];return o.container===n.name&&e.push(o),e},[]);return"function"!=typeof e?o:void e(o)}function v(n,e){r(y,n,e)}function p(n,e){r(_,n,e)}function b(e){n.serverAdded(function(n){n.application.indexOf("HtmlContainer.")!==-1&&helpers.invokeAgmSuccessCallback(e,n.application)})}function h(e){n.serverRemoved(function(n){n.application.indexOf("HtmlContainer.")!==-1&&helpers.invokeAgmSuccessCallback(e,n.application)})}function C(e){n.invoke("T42.Wnd.ListWindows",{},"best",{},function(n){Object.keys(n.returned).forEach(function(t){var o=n.returned[t],i=s(o.windowName,e,o.url,o.windowId,o.windowStyleAttributes,o.windowTitle);helpers.execCallbacks(a(y,e.name),i)})},function(n){console.log("Unable to load existing windows. "+n)})}windowFactory.init(n),global.htmlContainer&&n.subscribe&&(n.serverMethodAdded(function(e){e.server.application.indexOf("HtmlContainer.")!==-1&&e.server.application.indexOf(".Internal")!==-1&&e.method.name.indexOf("T42.Wnd.WindowStateChanged")!==-1&&n.subscribe("T42.Wnd.WindowStateChanged",{target:"all"}).then(function(n){n.onData(function(n){d(n.data,t(n.server.application))})})}),n.serverAdded(function(n){if(n.application.indexOf("HtmlContainer.")!==-1){var e=o(n.application);i(g,e),C(e)}}));var k={},g=[];if(global.htmlContainer){var A=o(htmlContainer.containerName);i(g,A),l(htmlContainer.browserWindowName,A,window.location.href,htmlContainer.windowId,htmlContainer.windowStyleAttributes)}var y={containersCallbacks:{},allContainersCallbacks:[]},_={containersCallbacks:{},allContainersCallbacks:[]},x={my:u,open:w,find:f,list:m,windowAdded:v,windowRemoved:p,containerAdded:b,containerRemoved:h,_from_event:function(n,e,o,i,a,r){return e=t(e),s(n,e,o,i,a,r)}};return x.window_added=deprecate(x.windowAdded,"window.window_added() is deprecated and might be removed from future versions of glue. Use window.windowAdded() instead"),x.window_removed=deprecate(x.windowRemoved,"window.window_removed() is deprecated and might be removed from future versions of glue. Use window.windowRemoved() instead"),x.container_added=deprecate(x.containerAdded,"window.container_added() is deprecated and might be removed from future versions of glue. Use window.containerAdded() instead"),x.container_removed=deprecate(x.containerRemoved,"window.container_removed() is deprecated and might be removed from future versions of glue. Use window.containerRemoved() instead"),x.version=PackageJson.version,x};"undefined"!=typeof window&&(window.tick42=window.tick42||{},window.tick42.windows=windows),module.exports=windows;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../package.json":104,"./helpers":101,"./window":102,"util-deprecate":106}],104:[function(require,module,exports){
module.exports={"_args":[["tick42-windows@2.2.6","C:\\work\\stash\\GLUE-dev\\js-glue"]],"_from":"tick42-windows@2.2.6","_id":"tick42-windows@2.2.6","_inCache":true,"_installable":true,"_location":"/tick42-windows","_nodeVersion":"5.3.0","_npmUser":{},"_npmVersion":"3.3.12","_phantomChildren":{},"_requested":{"name":"tick42-windows","raw":"tick42-windows@2.2.6","rawSpec":"2.2.6","scope":null,"spec":"2.2.6","type":"version"},"_requiredBy":["/"],"_resolved":"http://192.168.0.234:4873/tick42-windows/-/tick42-windows-2.2.6.tgz","_shasum":"5116922a0825e87ec1a728f9937e594449abb47e","_shrinkwrap":null,"_spec":"tick42-windows@2.2.6","_where":"C:\\work\\stash\\GLUE-dev\\js-glue","author":{"name":"Tick42"},"bin":{"build":"./bin/build.js","clean":"./bin/clean.js","file-versionify":"./bin/file-versionify.js","minify":"./bin/minify.js"},"dependencies":{"es6-promise":"^3.0.2","util-deprecate":"^1.0.2"},"description":"A windowing API for the Tick42 HTML Container","devDependencies":{"blanket":"^1.1.6","browserify":"^13.0.0","browserify-replacify":"^0.0.4","browserify-versionify":"^1.0.4","eslint":"^3.1.1","eslint-config-standard":"^5.3.5","eslint-config-tick42":"^1.0.0","eslint-plugin-promise":"^2.0.0","eslint-plugin-standard":"^2.0.0","fs":"0.0.2","jscs":"^3.0.7","jsdom":"^8.1.0","jshint":"^2.9.1","minifyify":"^7.3.2","onchange":"^2.1.2","phantomjs":"^1.9.12","qunitjs":"^1.15.0","shelljs":"^0.6.0"},"directories":{"test":"tests"},"dist":{"shasum":"5116922a0825e87ec1a728f9937e594449abb47e","tarball":"http://192.168.0.234:4873/tick42-windows/-/tick42-windows-2.2.6.tgz"},"gitHead":"56db8ebd39e135d6023485ef187445d4082de8d2","license":"ISC","main":"library/windows.js","name":"tick42-windows","optionalDependencies":{},"readme":"ERROR: No README data found!","repository":{"type":"git","url":"https://stash.tick42.com:8443/scm/ofgw/js-windows.git"},"scripts":{"build":"npm run eslint && node bin/clean.js && node bin/build.js && node bin/minify && node bin/file-versionify","eslint":"eslint library","eslint:fix":"eslint library --fix","prepublish":"npm update & npm run build","test":"npm run eslint && mocha --require ./test/test_helper \"test/**/*.js\"","watch":"onchange \"./library/*.js\" -iv -e \"./bin\" -- npm run build"},"version":"2.2.6"}
},{}],105:[function(require,module,exports){
(function (global){
"use strict";function encode(r){return encodeURIComponent(r).replace(find,replacer)}function decode(r){return decodeURIComponent(r.replace(plus," "))}function URLSearchParams(r){if(this[secret]=Object.create(null),r)for(var e,t,a=(r||"").split("&"),n=0,o=a.length;n<o;n++)t=a[n],e=t.indexOf("="),-1<e&&this.append(decode(t.slice(0,e)),decode(t.slice(e+1)))}function isIterable(){try{return!!Symbol.iterator}catch(r){return!1}}var URLSearchParamsProto=URLSearchParams.prototype,find=/[!'\(\)~]|%20|%00/g,plus=/\+/g,replace={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"},replacer=function(r){return replace[r]},iterable=isIterable(),secret="__URLSearchParams__:"+Math.random();URLSearchParamsProto.append=function(r,e){var t=this[secret];r in t?t[r].push(""+e):t[r]=[""+e]},URLSearchParamsProto.delete=function(r){delete this[secret][r]},URLSearchParamsProto.get=function(r){var e=this[secret];return r in e?e[r][0]:null},URLSearchParamsProto.getAll=function(r){var e=this[secret];return r in e?e[r].slice(0):[]},URLSearchParamsProto.has=function(r){return r in this[secret]},URLSearchParamsProto.set=function(r,e){this[secret][r]=[""+e]},URLSearchParamsProto.forEach=function(r,e){var t=this[secret];Object.getOwnPropertyNames(t).forEach(function(a){t[a].forEach(function(t){r.call(e,t,a,this)},this)},this)},URLSearchParamsProto.keys=function(){var r=[];this.forEach(function(e,t){r.push(t)});var e={next:function(){var e=r.shift();return{done:void 0===e,value:e}}};return iterable&&(e[Symbol.iterator]=function(){return e}),e},URLSearchParamsProto.values=function(){var r=[];this.forEach(function(e){r.push(e)});var e={next:function(){var e=r.shift();return{done:void 0===e,value:e}}};return iterable&&(e[Symbol.iterator]=function(){return e}),e},URLSearchParamsProto.entries=function(){var r=[];this.forEach(function(e,t){r.push([t,e])});var e={next:function(){var e=r.shift();return{done:void 0===e,value:e}}};return iterable&&(e[Symbol.iterator]=function(){return e}),e},iterable&&(URLSearchParamsProto[Symbol.iterator]=URLSearchParamsProto.entries),URLSearchParamsProto.toJSON=function(){return{}},URLSearchParamsProto.toString=function(){var r,e,t,a,n=this[secret],o=[];for(e in n)for(t=encode(e),r=0,a=n[e];r<a.length;r++)o.push(t+"="+encode(a[r]));return o.join("&")},module.exports=global.URLSearchParams||URLSearchParams;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],106:[function(require,module,exports){
(function (global){
function deprecate(r,e){function o(){if(!t){if(config("throwDeprecation"))throw new Error(e);config("traceDeprecation")?console.trace(e):console.warn(e),t=!0}return r.apply(this,arguments)}if(config("noDeprecation"))return r;var t=!1;return o}function config(r){try{if(!global.localStorage)return!1}catch(r){return!1}var e=global.localStorage[r];return null!=e&&"true"===String(e).toLowerCase()}module.exports=deprecate;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],107:[function(require,module,exports){
function ws(e,o,t){var b;return b=o?new WebSocket(e,o):new WebSocket(e)}var global=function(){return this}(),WebSocket=global.WebSocket||global.MozWebSocket;module.exports=WebSocket?ws:null,WebSocket&&(ws.prototype=WebSocket.prototype);
},{}],108:[function(require,module,exports){
module.exports={"name":"tick42-glue","version":"3.0.0-beta.3","description":"A JavaScript library which provides support for Tick42 GLUE.","main":"./library/main.js","bin":{"init-dev-mode":"bin/init-dev-mode.js","remove-installed-dependencies":"bin/remove-installed-dependencies.js","remove-development-dependencies":"bin/remove-development-dependencies.js","build":"./bin/build.js","clean":"./bin/clean.js","file-versionify":"bin/file-versionify.js","minify":"./bin/minify.js"},"scripts":{"eslint":"eslint library","eslint:fix":"eslint library --fix","test":"npm run eslint && mocha --require ./test/test_helper \"test/**/*.js\"","build":"npm run eslint && node bin/clean.js && node bin/build.js && node bin/minify && node bin/file-versionify","build:dev":"npm run eslint:fix && node bin/clean && node bin/build","prepublish":"npm update && npm run build","init:develop":"node bin/init-dev-mode","clear:develop":"node bin/remove-development-dependencies","watch":"onchange \"./library/*.js\" \"./node_modules/tick42-*/library/*.js\"  \"./node_modules/tick42-*/library_js/*.js\" \"../node_modules/tick42-*/library/**.js\"  \"../node_modules/tick42-*/library_js/*.js\" -iv -e \"./bin\" -- npm run build:dev","watch:develop":"node bin/remove-installed-dependencies && npm run watch","watch:prod":"npm install && npm run watch"},"repository":{"type":"git","url":"https://bmarinov@stash.tick42.com:8443/scm/ofgw/js-glue.git"},"author":{"name":"Tick42","url":"http://www.tick42.com"},"license":"ISC","dependencies":{"cuid":"^1.3.8","detect-node":"^2.0.3","es5-shim":"^4.1.14","object-assign":"^4.1.0","tick42-activity":"^2.2.1","tick42-agm":"^3.2.0","tick42-app-manager":"^2.3.6","tick42-appconfig":"^0.1.2","tick42-contexts":"^0.0.2","tick42-gateway-connection":"^2.0.3","tick42-logger":"^2.0.5","tick42-metrics":"^2.0.15","tick42-windows":"^2.2.3"},"devDependencies":{"eslint":"^3.1.1","eslint-config-standard":"^5.3.5","eslint-config-tick42":"^1.0.0","eslint-plugin-promise":"^2.0.0","eslint-plugin-standard":"^2.0.0","browserify":"^13.0.0","browserify-replacify":"^0.0.4","browserify-versionify":"^1.0.4","chai":"^3.5.0","fs":"0.0.2","jsdom":"^8.1.0","jshint":"^2.9.1","minifyify":"^7.3.2","mocha":"^2.4.5","onchange":"^2.1.2","shelljs":"^0.6.0"}}
},{}]},{},[2])


//# sourceMappingURL=tick42-glue-dev.min.js.map